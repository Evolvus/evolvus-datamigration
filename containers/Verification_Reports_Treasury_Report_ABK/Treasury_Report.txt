 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
com_loan_flows_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
com_loan_flows_report.sql 

--ALL CASH FLOWS
select 
DEALNO OPICS_DEALNO,deal_identifier FIN_DEAL_IDENTIFIER,CASE WHEN DEALNO = deal_identifier THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
deal_num FIN_DEAL_NUM,
SCHDSEQ OPICS_SCHEDULE_SEQ,SIDE_SEQUENCE FIN_SCHEDULE_SEQ,CASE WHEN TO_NUMBER(SCHDSEQ) = SIDE_SEQUENCE THEN 'TRUE' ELSE 'FALSE' END MATCH_SEQUENCE,
CCY OPICS_CCY,NOTIONAL_AMOUNT_CCY FIN_CCY,CASE WHEN CCY = NOTIONAL_AMOUNT_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
INTSTRTDTE OPICS_START_DATE ,fin_flow.START_DATE FIN_START_DATE ,CASE WHEN INTSTRTDTE = fin_flow.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
INTENDDTE OPICS_END_DATE,fin_flow.END_DATE FIN_END_DATE,CASE WHEN INTENDDTE = fin_flow.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
RATECODE OPICS_RATECODE,RATE_CODE FIN_RATECODE,CASE WHEN nvl(RATECODE,' ') = nvl(RATE_CODE,' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE_CODE,
INTRATE_8 OPICS_INTRATE,NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) FIN_INTRATE,CASE WHEN to_number(INTRATE_8) = NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) THEN 'TRUE' ELSE 'FALSE' END MATCH_INTRATE,
SPREAD_8 OPICS_SPREAD_RATE ,fin_flow.SPREAD_RATE*100 FIN_SPREAD_RATE,CASE WHEN to_number(SPREAD_8) = NVL(fin_flow.SPREAD_RATE*100,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPREAD_RATE
 from schd
left join tt_com_loan@ftmig on deal_identifier = dealno 
left join (select reset_date,REFERENCE_RATE_FBO_ID_NUM,CASH_FLOW_TYPE,parent_fbo_id_num,BASIS_CODE,START_DATE,END_DATE,NOTIONAL_AMOUNT_CCY,NOTIONAL_AMOUNT_VALUE,SPREAD_RATE,MARGIN,FIX_RATE,SIDE_SEQUENCE,PARENT_FBO_ID_VER from  TT_CMLOAN_CASH_FLOWS@ftmig) fin_flow on PARENT_FBO_ID_NUM  = deal_num and PARENT_FBO_ID_VER='999999' and SIDE_SEQUENCE = to_number(SCHDSEQ)
LEFT JOIN (
SELECT  A.REF_RATE_FBO_ID_NUM,RATE_CODE,RATE_CCY,RATE_VALUE,EFFECTIVE_DATE FROM SD_REF_RATE_VALUE@FTMIG A
LEFT JOIN SD_REF_RATE@FTMIG B ON B.FBO_ID_NUM = A.REF_RATE_FBO_ID_NUM
) REF_RATE ON REF_RATE.REF_RATE_FBO_ID_NUM = REFERENCE_RATE_FBO_ID_NUM AND reset_date = EFFECTIVE_DATE
where TRIM(DEALNO) IN(SELECT TRIM(DEAL_IDENTIFIER) FROM COM_LOAN_O_TABLE)
order by DEALNO,to_number(SCHDSEQ);

select 
DEALNO OPICS_DEALNO,deal_identifier FIN_DEAL_IDENTIFIER,CASE WHEN DEALNO = deal_identifier THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
deal_num FIN_DEAL_NUM,
SCHDSEQ OPICS_SCHEDULE_SEQ,SIDE_SEQUENCE+1 FIN_SCHEDULE_SEQ,CASE WHEN TO_NUMBER(SCHDSEQ) = SIDE_SEQUENCE+1 THEN 'TRUE' ELSE 'FALSE' END MATCH_SEQUENCE,
CCY OPICS_CCY,NOTIONAL_AMOUNT_CCY FIN_CCY,CASE WHEN CCY = NOTIONAL_AMOUNT_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
INTSTRTDTE OPICS_START_DATE ,fin_flow.START_DATE FIN_START_DATE ,CASE WHEN INTSTRTDTE = fin_flow.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
INTENDDTE OPICS_END_DATE,fin_flow.END_DATE FIN_END_DATE,CASE WHEN INTENDDTE = fin_flow.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
RATECODE OPICS_RATECODE,RATE_CODE FIN_RATECODE,CASE WHEN nvl(case when RATECODE like 'LI%' then RATECODE end,' ') = nvl(RATE_CODE,' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE_CODE,
INTRATE_8 OPICS_INTRATE,NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) FIN_INTRATE,CASE WHEN round(to_number(INTRATE_8),12) = round(nvl(NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100),0),12) THEN 'TRUE' ELSE 'FALSE' END MATCH_INTRATE,
SPREAD_8 OPICS_SPREAD_RATE ,fin_flow.SPREAD_RATE*100 FIN_SPREAD_RATE,CASE WHEN to_number(SPREAD_8) = NVL(fin_flow.SPREAD_RATE*100,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPREAD_RATE
 from schd
left join tt_com_loan@ftmig on deal_identifier = dealno 
left join (select reset_date,REFERENCE_RATE_FBO_ID_NUM,CASH_FLOW_TYPE,parent_fbo_id_num,BASIS_CODE,START_DATE,END_DATE,NOTIONAL_AMOUNT_CCY,NOTIONAL_AMOUNT_VALUE,SPREAD_RATE,MARGIN,FIX_RATE,SIDE_SEQUENCE,PARENT_FBO_ID_VER from  TT_CMLOAN_CASH_FLOWS@ftmig where SUBTYPE='MAIN' ) fin_flow on PARENT_FBO_ID_NUM  = deal_num and PARENT_FBO_ID_VER='999999' and SIDE_SEQUENCE+1 = to_number(SCHDSEQ)
LEFT JOIN (
SELECT  A.REF_RATE_FBO_ID_NUM,RATE_CODE,RATE_CCY,RATE_VALUE,EFFECTIVE_DATE FROM SD_REF_RATE_VALUE@FTMIG A
LEFT JOIN SD_REF_RATE@FTMIG B ON B.FBO_ID_NUM = A.REF_RATE_FBO_ID_NUM
) REF_RATE ON REF_RATE.REF_RATE_FBO_ID_NUM = REFERENCE_RATE_FBO_ID_NUM AND reset_date = EFFECTIVE_DATE
where TRIM(DEALNO) IN(SELECT TRIM(DEAL_IDENTIFIER) FROM COM_LOAN_O_TABLE)
and SCHDTYPE!='V'
and dealno not in(SELECT DEALNO FROM SCHD WHERE  TRIM(DEALNO) IN(SELECT TRIM(DEAL_IDENTIFIER) FROM COM_LOAN_O_TABLE) group by DEALNO having count(*) > 2)
order by DEALNO,to_number(SCHDSEQ);


select * from schd where dealno in(SELECT DEALNO FROM SCHD WHERE  TRIM(DEALNO) IN(SELECT TRIM(DEAL_IDENTIFIER) FROM COM_LOAN_O_TABLE) group by DEALNO having count(*) > 2)

select deal_identifier,TT_CMLOAN_CASH_FLOWS.* from  TT_CMLOAN_CASH_FLOWS@ftmig
inner join (
select distinct deal_num,deal_identifier from schd 
left join tt_com_loan@ftmig on deal_identifier = dealno 
where dealno in(SELECT DEALNO FROM SCHD WHERE  TRIM(DEALNO) IN(SELECT TRIM(DEAL_IDENTIFIER) FROM COM_LOAN_O_TABLE) group by DEALNO having count(*) > 2)) on PARENT_FBO_ID_NUM = deal_num
 where   PARENT_FBO_ID_VER='999999' 

-------------------------------------------------------------------------------------------------------------------------------------------
--CURRENT CASH FLOWS
select 
DEALNO OPICS_DEALNO,deal_identifier FIN_DEAL_IDENTIFIER,CASE WHEN DEALNO = deal_identifier THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
deal_num FIN_DEAL_NUM,
SCHDSEQ OPICS_SCHEDULE_SEQ,SIDE_SEQUENCE FIN_SCHEDULE_SEQ,CASE WHEN TO_NUMBER(SCHDSEQ) = SIDE_SEQUENCE THEN 'TRUE' ELSE 'FALSE' END MATCH_SEQUENCE,
CCY OPICS_CCY,NOTIONAL_AMOUNT_CCY FIN_CCY,CASE WHEN CCY = NOTIONAL_AMOUNT_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
INTSTRTDTE OPICS_START_DATE ,fin_flow.START_DATE FIN_START_DATE ,CASE WHEN INTSTRTDTE = fin_flow.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
INTENDDTE OPICS_END_DATE,fin_flow.END_DATE FIN_END_DATE,CASE WHEN INTENDDTE = fin_flow.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
RATECODE OPICS_RATECODE,RATE_CODE FIN_RATECODE,CASE WHEN nvl(RATECODE,' ') = nvl(RATE_CODE,' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE_CODE,
INTRATE_8 OPICS_INTRATE,NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) FIN_INTRATE,CASE WHEN to_number(INTRATE_8) = NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) THEN 'TRUE' ELSE 'FALSE' END MATCH_INTRATE,
SPREAD_8 OPICS_SPREAD_RATE ,fin_flow.SPREAD_RATE*100 FIN_SPREAD_RATE,CASE WHEN to_number(SPREAD_8) = NVL(fin_flow.SPREAD_RATE*100,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPREAD_RATE
 from schd
left join tt_com_loan@ftmig on deal_identifier = dealno 
left join (select reset_date,REFERENCE_RATE_FBO_ID_NUM,CASH_FLOW_TYPE,parent_fbo_id_num,BASIS_CODE,START_DATE,END_DATE,NOTIONAL_AMOUNT_CCY,NOTIONAL_AMOUNT_VALUE,SPREAD_RATE,MARGIN,FIX_RATE,SIDE_SEQUENCE,PARENT_FBO_ID_VER from  TT_CMLOAN_CASH_FLOWS@ftmig) fin_flow on PARENT_FBO_ID_NUM  = deal_num and PARENT_FBO_ID_VER='999999' and SIDE_SEQUENCE = to_number(SCHDSEQ)
LEFT JOIN (
SELECT  A.REF_RATE_FBO_ID_NUM,RATE_CODE,RATE_CCY,RATE_VALUE,EFFECTIVE_DATE FROM SD_REF_RATE_VALUE@FTMIG A
LEFT JOIN SD_REF_RATE@FTMIG B ON B.FBO_ID_NUM = A.REF_RATE_FBO_ID_NUM
) REF_RATE ON REF_RATE.REF_RATE_FBO_ID_NUM = REFERENCE_RATE_FBO_ID_NUM AND reset_date = EFFECTIVE_DATE
where TRIM(DEALNO) IN(SELECT TRIM(DEAL_IDENTIFIER) FROM COM_LOAN_O_TABLE)
AND INTSTRTDTE <= TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND  INTENDDTE > TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY')
order by DEALNO,to_number(SCHDSEQ);


select 
DEALNO OPICS_DEALNO,deal_identifier FIN_DEAL_IDENTIFIER,CASE WHEN DEALNO = deal_identifier THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
deal_num FIN_DEAL_NUM,
SCHDSEQ OPICS_SCHEDULE_SEQ,SIDE_SEQUENCE+1 FIN_SCHEDULE_SEQ,CASE WHEN TO_NUMBER(SCHDSEQ) = SIDE_SEQUENCE+1 THEN 'TRUE' ELSE 'FALSE' END MATCH_SEQUENCE,
CCY OPICS_CCY,NOTIONAL_AMOUNT_CCY FIN_CCY,CASE WHEN CCY = NOTIONAL_AMOUNT_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
INTSTRTDTE OPICS_START_DATE ,fin_flow.START_DATE FIN_START_DATE ,CASE WHEN INTSTRTDTE = fin_flow.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
INTENDDTE OPICS_END_DATE,fin_flow.END_DATE FIN_END_DATE,CASE WHEN INTENDDTE = fin_flow.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
RATECODE OPICS_RATECODE,RATE_CODE FIN_RATECODE,CASE WHEN nvl(case when RATECODE like 'LI%' then RATECODE end,' ') = nvl(RATE_CODE,' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE_CODE,
INTRATE_8 OPICS_INTRATE,NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) FIN_INTRATE,CASE WHEN to_number(INTRATE_8) = nvl(NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100),0) THEN 'TRUE' ELSE 'FALSE' END MATCH_INTRATE,
SPREAD_8 OPICS_SPREAD_RATE ,fin_flow.SPREAD_RATE*100 FIN_SPREAD_RATE,CASE WHEN to_number(SPREAD_8) = NVL(fin_flow.SPREAD_RATE*100,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPREAD_RATE
 from schd
left join tt_com_loan@ftmig on deal_identifier = dealno 
left join (select reset_date,REFERENCE_RATE_FBO_ID_NUM,CASH_FLOW_TYPE,parent_fbo_id_num,BASIS_CODE,START_DATE,END_DATE,NOTIONAL_AMOUNT_CCY,NOTIONAL_AMOUNT_VALUE,SPREAD_RATE,MARGIN,FIX_RATE,SIDE_SEQUENCE,PARENT_FBO_ID_VER from  TT_CMLOAN_CASH_FLOWS@ftmig where SUBTYPE='MAIN' ) fin_flow on PARENT_FBO_ID_NUM  = deal_num and PARENT_FBO_ID_VER='999999' and SIDE_SEQUENCE+1 = to_number(SCHDSEQ)
LEFT JOIN (
SELECT  A.REF_RATE_FBO_ID_NUM,RATE_CODE,RATE_CCY,RATE_VALUE,EFFECTIVE_DATE FROM SD_REF_RATE_VALUE@FTMIG A
LEFT JOIN SD_REF_RATE@FTMIG B ON B.FBO_ID_NUM = A.REF_RATE_FBO_ID_NUM
) REF_RATE ON REF_RATE.REF_RATE_FBO_ID_NUM = REFERENCE_RATE_FBO_ID_NUM AND reset_date = EFFECTIVE_DATE
where TRIM(DEALNO) IN(SELECT TRIM(DEAL_IDENTIFIER) FROM COM_LOAN_O_TABLE)
and SCHDTYPE!='V'
AND INTSTRTDTE <= TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND  INTENDDTE > TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY')
and dealno not in(SELECT DEALNO FROM SCHD WHERE  TRIM(DEALNO) IN(SELECT TRIM(DEAL_IDENTIFIER) FROM COM_LOAN_O_TABLE) group by DEALNO having count(*) > 2)
order by DEALNO,to_number(SCHDSEQ); 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
com_loan_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
com_loan_report.sql 

select DISTINCT 
D.DEALNO OPICS_DEALNO, FIN_COM_LOAN.DEAL_IDENTIFIER FINACLE_DEAL_IDENTIFIER, CASE WHEN TRIM(D.DEALNO) = TRIM(FIN_COM_LOAN.DEAL_IDENTIFIER) THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
D.PORT OPICS_PORT,SDTRBK.NAME FINACLE_TRADING_BOOK,CASE WHEN CASE WHEN trim(D.PORT)='PORT' THEN 'CORPORATE' ELSE 'INTERBANK' END like  SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK,
D.BR OPICS_BR,SDENT.NAME FINACLE_ENTITY_NAME,CASE WHEN CASE WHEN TRIM(D.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END like  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY_NAME,
--D.PORT OPICS_PORT,SDSBTY.NAME FINACLE_SUBTYPE,
C.CMNE OPICS_CMNE,SDCP.NAME FINACLE_COUNTERPARTY_STRING,CASE WHEN TRIM(C.CMNE) = TRIM(SDCP.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_COUNTERPARTY_STRING,
D.DEALDATE OPICS_DEALDATE,FIN_COM_LOAN.DEAL_DATE FINACLE_DEAL_DATE ,CASE WHEN D.DEALDATE = FIN_COM_LOAN.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALDATE,
D.VDATE OPICS_VDATE , FIN_COM_LOAN.START_DATE FINACLE_START_DATE,CASE WHEN D.VDATE =  FIN_COM_LOAN.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
D.MDATE OPICS_MDATE,FIN_COM_LOAN.END_DATE FINACLE_END_DATE,CASE WHEN D.MDATE = FIN_COM_LOAN.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
D.AL OPICS_AL , LONG_OR_SHORT FINACLE_LONG_OR_SHORT,CASE WHEN CASE WHEN D.AL='L' THEN 'S' ELSE 'L' END=LONG_OR_SHORT THEN 'TRUE' ELSE 'FALSE' END MATCH_LONG_OR_SHORT,
--D.AL OPICS_AL,D.RATECODE OPICS_RATECODE,TYPE_STRING FINACLE_TYPE_STRING ,--***
D.CCY OPICS_CCY,FIN_COM_LOAN.CURRENCY_LIST FINACLE_CURRENCY_LIST,CASE WHEN D.CCY=FIN_COM_LOAN.CURRENCY_LIST THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
D.CCYAMT OPICS_CCYAMT,TTCMFL.NOTIONAL_AMOUNT_VALUE FINACLE_NOTIONAL_AMOUNT_VALUE,CASE WHEN D.CCYAMT=TTCMFL.NOTIONAL_AMOUNT_VALUE THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYAMT,
D.BASIS OPICS_BASIS,TTCMFL.BASIS_CODE OPICS_BASIS_CODE,CASE WHEN SUBSTR(D.BASIS,1,1)||'/'||SUBSTR(D.BASIS,2,3)=TTCMFL.BASIS_CODE THEN 'TRUE' ELSE 'FALSE' END MATCH_BASIS,
to_number(D.INTRATE) OPICS_INTRATE,TTCMFL.SETTLEMENT_RATE*100 FINACLE_SETTLEMENT_RATE,CASE WHEN D.INTRATE=TTCMFL.SETTLEMENT_RATE*100 THEN 'TRUE' ELSE 'FALSE' END MATCH_INTRATE,
D.SPREAD_8 OPICS_SPREAD_8,TTCMFL.SPREAD_RATE*100 FINACLE_SPREAD_RATE,CASE WHEN D.SPREAD_8=TTCMFL.SPREAD_RATE*100 THEN 'TRUE' ELSE 'FALSE' END MATCH_SPREAD_RATE
,D.RATECODE OPICS_RATECODE,TTCMFL.CASH_FLOW_TYPE FINACLE_CASH_FLOW_TYPE,CASE WHEN CASE WHEN D.RATECODE LIKE 'LI%' THEN 'FLOAT' ELSE 'FIXED'  END=TTCMFL.CASH_FLOW_TYPE  THEN 'TRUE' ELSE 'FALSE' END MATCH_SPREAD_RATE
--C.BIC OPICS_BIC, FIN_COM_LOAN.CONFIRM_METHOD FINACLE_CONFIRM_METHOD
FROM DLDT D 
INNER JOIN CUST C ON TRIM(D.CNO)=TRIM(C.CNO)
LEFT JOIN SCHD S ON TRIM(D.DEALNO)=TRIM(S.DEALNO) AND S.SCHDSEQ='001' AND D.BR=S.BR 
LEFT JOIN TT_COM_LOAN@ftuat FIN_COM_LOAN ON TRIM(D.DEALNO)=TRIM(FIN_COM_LOAN.DEAL_IDENTIFIER) AND FIN_COM_LOAN.SUBTYPE_FBO_ID_NUM NOT IN (SELECT FBO_ID_NUM FROM SD_SUBTYPE@ftuat WHERE TRIM(DESCRIPTION) IN ('REPO deal with Banks','REPO deal with Central Banks'))
LEFT JOIN SD_TRADING_BOOK@ftuat SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_COM_LOAN.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftuat SDENT ON SDENT.FBO_ID_NUM = FIN_COM_LOAN.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftuat SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_COM_LOAN.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftuat SDCP ON SDCP.FBO_ID_NUM= FIN_COM_LOAN.CPTY_FBO_ID_NUM
LEFT JOIN TT_CMLOAN_CASH_FLOWS@ftuat TTCMFL ON TRIM(TTCMFL.PARENT_FBO_ID_NUM) = TRIM(FIN_COM_LOAN.DEAL_NUM) and SIDE_SEQUENCE='1' and TTCMFL.SETTLEMENT_RATE is not null
--AND TRIM(TTCMFL.CASH_FLOW_LABEL) IS not NULL and  TRIM(TTCMFL.REFERENCE_RATE_VALUE) IS not  NULL 
WHERE D.MDATE>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND TRIM(D.REVDATE) IS NULL;



select DISTINCT 
TRIM(D.DEALNO)||'-'||D.PORT||'-'||D.BR||'-'||TRIM(C.CMNE)||'-'||D.DEALDATE||'-'||D.VDATE ||'-'||D.MDATE||'-'||D.AL ||'-'||D.CCY||'-'||D.CCYAMT||'-'||
D.BASIS||'-'||to_number(D.INTRATE)||'-'||D.SPREAD_8 ||'-'||D.RATECODE OPICS_DATA,
TRIM(D.DEALNO)||'-'||CASE WHEN trim(D.PORT)='PORT' THEN 'CORPORATE' ELSE 'INTERBANK' END||'-'||CASE WHEN TRIM(D.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END
||'-'||TRIM(C.CMNE)||'-'||D.DEALDATE||'-'||D.VDATE ||'-'||D.MDATE||'-'||CASE WHEN D.AL='L' THEN 'S' ELSE 'L' END ||'-'||D.CCY||'-'||D.CCYAMT||'-'||
SUBSTR(D.BASIS,1,1)||'/'||SUBSTR(D.BASIS,2,3)||'-'||to_number(D.INTRATE)||'-'||D.SPREAD_8 ||'-'||CASE WHEN D.RATECODE LIKE 'LI%' THEN 'FLOAT' ELSE 'FIXED'  END OPICS_CONV_DATA,
FIN_COM_LOAN.DEAL_IDENTIFIER||'-'||TRIM(SDTRBK.NAME)||'-'||TRIM(SDENT.NAME)||'-'||TRIM(SDCP.NAME)||'-'||FIN_COM_LOAN.DEAL_DATE||'-'||FIN_COM_LOAN.START_DATE||'-'||FIN_COM_LOAN.END_DATE ||'-'||
LONG_OR_SHORT ||'-'||FIN_COM_LOAN.CURRENCY_LIST||'-'||TTCMFL.NOTIONAL_AMOUNT_VALUE||'-'||TTCMFL.BASIS_CODE||'-'||TTCMFL.SETTLEMENT_RATE*100||'-'||TTCMFL.SPREAD_RATE*100||'-'||TTCMFL.CASH_FLOW_TYPE FIN_DATA,
CASE WHEN TRIM(D.DEALNO)||'-'||CASE WHEN trim(D.PORT)='PORT' THEN 'CORPORATE' ELSE 'INTERBANK' END||'-'||CASE WHEN TRIM(D.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END
||'-'||TRIM(C.CMNE)||'-'||D.DEALDATE||'-'||D.VDATE ||'-'||D.MDATE||'-'||CASE WHEN D.AL='L' THEN 'S' ELSE 'L' END ||'-'||D.CCY||'-'||D.CCYAMT||'-'||
SUBSTR(D.BASIS,1,1)||'/'||SUBSTR(D.BASIS,2,3)||'-'||to_number(D.INTRATE)||'-'||D.SPREAD_8 ||'-'||CASE WHEN D.RATECODE LIKE 'LI%' THEN 'FLOAT' ELSE 'FIXED'  END = FIN_COM_LOAN.DEAL_IDENTIFIER||'-'||TRIM(SDTRBK.NAME)||'-'||TRIM(SDENT.NAME)||'-'||TRIM(SDCP.NAME)||'-'||FIN_COM_LOAN.DEAL_DATE||'-'||FIN_COM_LOAN.START_DATE||'-'||FIN_COM_LOAN.END_DATE ||'-'||
LONG_OR_SHORT ||'-'||FIN_COM_LOAN.CURRENCY_LIST||'-'||TTCMFL.NOTIONAL_AMOUNT_VALUE||'-'||TTCMFL.BASIS_CODE||'-'||TTCMFL.SETTLEMENT_RATE*100||'-'||TTCMFL.SPREAD_RATE*100||'-'||TTCMFL.CASH_FLOW_TYPE THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM DLDT D 
INNER JOIN CUST C ON TRIM(D.CNO)=TRIM(C.CNO)
LEFT JOIN SCHD S ON TRIM(D.DEALNO)=TRIM(S.DEALNO) AND S.SCHDSEQ='001' AND D.BR=S.BR 
LEFT JOIN TT_COM_LOAN@FTMIG FIN_COM_LOAN ON TRIM(D.DEALNO)=TRIM(FIN_COM_LOAN.DEAL_IDENTIFIER) AND FIN_COM_LOAN.SUBTYPE_FBO_ID_NUM NOT IN (SELECT FBO_ID_NUM FROM SD_SUBTYPE@FTMIG WHERE TRIM(DESCRIPTION) IN ('REPO deal with Banks','REPO deal with Central Banks'))
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_COM_LOAN.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_COM_LOAN.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_COM_LOAN.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_COM_LOAN.CPTY_FBO_ID_NUM
LEFT JOIN TT_CMLOAN_CASH_FLOWS@FTMIG TTCMFL ON TRIM(TTCMFL.PARENT_FBO_ID_NUM) = TRIM(FIN_COM_LOAN.DEAL_NUM) and SIDE_SEQUENCE='1' --and TTCMFL.SETTLEMENT_RATE is not null
--AND TRIM(TTCMFL.CASH_FLOW_LABEL) IS not NULL and  TRIM(TTCMFL.REFERENCE_RATE_VALUE) IS not  NULL 
WHERE D.MDATE>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND TRIM(D.REVDATE) IS NULL

SELECT DISTINCT 
TRIM(D.DEALNO) OPICS_DEALNO,TRIM(FIN_COM_LOAN.DEAL_IDENTIFIER) FIN_DEALNO, CASE WHEN TRIM(D.DEALNO) = TRIM(FIN_COM_LOAN.DEAL_IDENTIFIER) THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
D.BR OPICS_BR, CASE WHEN TRIM(D.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END MAPPED_ENTITY, SDENT.NAME FIN_ENTITY, CASE WHEN CASE WHEN TRIM(D.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END =  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
D.PORT OPICS_PORT ,CASE WHEN TRIM(D.PORT)='PORT' THEN 'CORPORATE' ELSE 'INTERBANK' END MAPPED_TRADING_BOOK,TRIM(SDTRBK.NAME) FIN_TRADING_BOOK, CASE WHEN CASE WHEN TRIM(D.PORT)='PORT' THEN 'CORPORATE' ELSE 'INTERBANK' END = TRIM(SDTRBK.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK,
D.PRODTYPE OPICS_PRODTYPE ,CASE when trim(C.CMNE)='CENTRALKWT' then 'CBKPLA' WHEN TRIM(C.CMNE)= 'ABKDXB' THEN 'INTGRP' WHEN D.BR='01' AND TRIM(D.PRODTYPE) IN ('LC','BC') THEN 'CORP' WHEN D.BR='01' AND TRIM(D.PRODTYPE) IN ('BB','LB') THEN 'BANK'
     WHEN D.BR='01' THEN 'ISLAMC'  WHEN D.BR='51' THEN CASE WHEN TRIM(D.PRODTYPE) IN ('LC','BC') THEN 'CORP' ELSE 'BANK' END END  MAPPED_SUBTYPE,TRIM(SDSBTY.NAME) FIN_SUBTYPE, 
CASE WHEN CASE when trim(C.CMNE)='CENTRALKWT' then 'CBKPLA' WHEN TRIM(C.CMNE)= 'ABKDXB' THEN 'INTGRP' WHEN D.BR='01' AND TRIM(D.PRODTYPE) IN ('LC','BC') THEN 'CORP' WHEN D.BR='01' AND TRIM(D.PRODTYPE) IN ('BB','LB') THEN 'BANK'
     WHEN D.BR='01' THEN 'ISLAMC'  WHEN D.BR='51' THEN CASE WHEN TRIM(D.PRODTYPE) IN ('LC','BC') THEN 'CORP' ELSE 'BANK' END END = TRIM(SDSBTY.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
D.DEALDATE OPICS_DEAL_DATE,FIN_COM_LOAN.DEAL_DATE,CASE WHEN D.DEALDATE  = FIN_COM_LOAN.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
D.VDATE OPICS_START_DATE,FIN_COM_LOAN.START_DATE FIN_START_DATE,CASE WHEN D.VDATE = FIN_COM_LOAN.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
D.MDATE OPICS_END_DATE,FIN_COM_LOAN.END_DATE FIN_END_DATE ,CASE WHEN D.MDATE = FIN_COM_LOAN.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
D.BASIS OPICS_BASIS,SUBSTR(D.BASIS,1,1)||'/'||SUBSTR(D.BASIS,2,3) MAPPED_BASIS,TTCMFL.BASIS_CODE FIN_BASIS,CASE WHEN SUBSTR(D.BASIS,1,1)||'/'||SUBSTR(D.BASIS,2,3) = TTCMFL.BASIS_CODE THEN 'TRUE' ELSE 'FALSE' END MATCH_BASIS,
D.CCY OPICS_CCY,FIN_COM_LOAN.CURRENCY_LIST FIN_CCY ,CASE WHEN D.CCY = FIN_COM_LOAN.CURRENCY_LIST THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
D.AL OPICS_AL,CASE WHEN D.AL='L' THEN 'SHORT' ELSE 'LONG' END MAPPED_LONG_SHORT,CASE WHEN LONG_OR_SHORT='S' THEN 'SHORT' ELSE 'LONG' END FIN_LONG_SHORT ,CASE WHEN CASE WHEN D.AL='L' THEN 'SHORT' ELSE 'LONG' END  = CASE WHEN LONG_OR_SHORT='S' THEN 'SHORT' ELSE 'LONG' END THEN 'TRUE' ELSE 'FALSE' END MATCH_LONG_SHORT,
D.RATECODE OPICS_RATECODE,CASE WHEN D.AL='L' AND SUBSTR(D.RATECODE,1,2)='FI' THEN 'FIX/DEPO'
     WHEN D.AL='L' AND SUBSTR(D.RATECODE,1,2)!='FI' THEN 'FLT/DEPO'
     WHEN D.AL='A' AND SUBSTR(D.RATECODE,1,2)='FI' THEN 'FIX/LOAN'
     WHEN D.AL='A' AND SUBSTR(D.RATECODE,1,2)!='FI' THEN 'FLT/LOAN'
END  MAPPED_TYPE_STRING ,TYPE_STRING FIN_TYPE_STRING, CASE WHEN CASE WHEN D.AL='L' AND SUBSTR(D.RATECODE,1,2)='FI' THEN 'FIX/DEPO'
     WHEN D.AL='L' AND SUBSTR(D.RATECODE,1,2)!='FI' THEN 'FLT/DEPO'
     WHEN D.AL='A' AND SUBSTR(D.RATECODE,1,2)='FI' THEN 'FIX/LOAN'
     WHEN D.AL='A' AND SUBSTR(D.RATECODE,1,2)!='FI' THEN 'FLT/LOAN'
END= TYPE_STRING THEN 'TRUE' ELSE 'FALSE' END MATCH_TYPE_STRING,
D.CCYAMT OPICS_AMOUNT,TTCMFL.NOTIONAL_AMOUNT_VALUE FIN_AMOUNT,CASE WHEN ROUND(D.CCYAMT,3) = ROUND(TTCMFL.NOTIONAL_AMOUNT_VALUE,3) THEN 'TRUE' ELSE 'FALSE' END MATCH_AMOUNT,
CASE WHEN TRIM(D.RATECODE) like 'FIX%' THEN D.INTRATE END OPICS_RATE,CASE WHEN TRIM(D.RATECODE)like 'FIX%' THEN TTCMFL.SETTLEMENT_RATE*100 END  FIN_RATE,CASE WHEN ROUND(TRIM(CASE WHEN TRIM(D.RATECODE)like 'FIX%'THEN TO_NUMBER(D.INTRATE) ELSE 0 END ),8) =ROUND(CASE WHEN TRIM(D.RATECODE) like 'FIX%' THEN TTCMFL.SETTLEMENT_RATE*100 ELSE 0 END ,8) THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE,
CASE WHEN TRIM(S.SMEANS)='BRDGE' THEN 'BRIDGE_'||D.CCY||CASE WHEN TRIM(D.BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE TO_CHAR(S.SACCT) END OPICS_PAY_NOSTRO,NOS.pay_nos,CASE WHEN nvl(CASE WHEN TRIM(S.SMEANS)='BRDGE' THEN 'BRIDGE_'||D.CCY||CASE WHEN TRIM(D.BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE TO_CHAR(S.SACCT) END,' ') = nvl(NOS.pay_nos,' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_NOSTRO,
CASE WHEN TRIM(S.SMEANS)='BRDGE' THEN 'BRIDGE_'||D.CCY||CASE WHEN TRIM(D.BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE TO_CHAR(S.SACCT) END OPICS_RECIEVE_NOSTRO,NOS.rec_nos,CASE WHEN nvl(CASE WHEN TRIM(S.SMEANS)='BRDGE' THEN 'BRIDGE_'||D.CCY||CASE WHEN TRIM(D.BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE TO_CHAR(S.SACCT) END,' ') = nvl(NOS.REC_nos,' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_REC_NOSTRO,
TRIM(D.DEALNO)||'-'||CASE WHEN TRIM(D.PORT)='PORT' THEN 'CORPORATE' ELSE 'INTERBANK' END||'-'||CASE WHEN TRIM(D.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END
||'-'||TRIM(C.CMNE)||'-'||D.DEALDATE||'-'||D.VDATE ||'-'||D.MDATE||'-'||CASE WHEN D.AL='L' THEN 'S' ELSE 'L' END ||'-'||D.CCY||'-'||D.CCYAMT||'-'||
SUBSTR(D.BASIS,1,1)||'/'||SUBSTR(D.BASIS,2,3)||'-'||TO_NUMBER(D.INTRATE)||'-'||D.SPREAD_8 ||'-'||CASE WHEN D.RATECODE LIKE 'LI%' THEN 'FLOAT' ELSE 'FIXED'  END OPICS_CONV_DATA,
FIN_COM_LOAN.DEAL_IDENTIFIER||'-'||TRIM(SDTRBK.NAME)||'-'||TRIM(SDENT.NAME)||'-'||TRIM(SDCP.NAME)||'-'||FIN_COM_LOAN.DEAL_DATE||'-'||FIN_COM_LOAN.START_DATE||'-'||FIN_COM_LOAN.END_DATE ||'-'||
LONG_OR_SHORT ||'-'||FIN_COM_LOAN.CURRENCY_LIST||'-'||TTCMFL.NOTIONAL_AMOUNT_VALUE||'-'||TTCMFL.BASIS_CODE||'-'||TTCMFL.SETTLEMENT_RATE*100||'-'||TTCMFL.SPREAD_RATE*100||'-'||TTCMFL.CASH_FLOW_TYPE FIN_DATA,
CASE WHEN TRIM(D.DEALNO)||'-'||CASE WHEN TRIM(D.PORT)='PORT' THEN 'CORPORATE' ELSE 'INTERBANK' END||'-'||CASE WHEN TRIM(D.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END
||'-'||TRIM(C.CMNE)||'-'||D.DEALDATE||'-'||D.VDATE ||'-'||D.MDATE||'-'||CASE WHEN D.AL='L' THEN 'S' ELSE 'L' END ||'-'||D.CCY||'-'||D.CCYAMT||'-'||
SUBSTR(D.BASIS,1,1)||'/'||SUBSTR(D.BASIS,2,3)||'-'||TO_NUMBER(D.INTRATE)||'-'||D.SPREAD_8 ||'-'||CASE WHEN D.RATECODE LIKE 'LI%' THEN 'FLOAT' ELSE 'FIXED'  END = FIN_COM_LOAN.DEAL_IDENTIFIER||'-'||TRIM(SDTRBK.NAME)||'-'||TRIM(SDENT.NAME)||'-'||TRIM(SDCP.NAME)||'-'||FIN_COM_LOAN.DEAL_DATE||'-'||FIN_COM_LOAN.START_DATE||'-'||FIN_COM_LOAN.END_DATE ||'-'||
LONG_OR_SHORT ||'-'||FIN_COM_LOAN.CURRENCY_LIST||'-'||TTCMFL.NOTIONAL_AMOUNT_VALUE||'-'||TTCMFL.BASIS_CODE||'-'||TTCMFL.SETTLEMENT_RATE*100||'-'||TTCMFL.SPREAD_RATE*100||'-'||TTCMFL.CASH_FLOW_TYPE THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM DLDT D 
INNER JOIN CUST C ON TRIM(D.CNO)=TRIM(C.CNO)
LEFT JOIN SCHD S ON TRIM(D.DEALNO)=TRIM(S.DEALNO) AND S.SCHDSEQ='001' AND D.BR=S.BR 
LEFT JOIN TT_COM_LOAN@FTMIG FIN_COM_LOAN ON TRIM(D.DEALNO)=TRIM(FIN_COM_LOAN.DEAL_IDENTIFIER) AND FIN_COM_LOAN.SUBTYPE_FBO_ID_NUM NOT IN (SELECT FBO_ID_NUM FROM SD_SUBTYPE@FTMIG WHERE TRIM(DESCRIPTION) IN ('REPO deal with Banks','REPO deal with Central Banks'))
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_COM_LOAN.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_COM_LOAN.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_COM_LOAN.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_COM_LOAN.CPTY_FBO_ID_NUM
LEFT JOIN TT_CMLOAN_CASH_FLOWS@FTMIG TTCMFL ON TRIM(TTCMFL.PARENT_FBO_ID_NUM) = TRIM(FIN_COM_LOAN.DEAL_NUM) AND SIDE_SEQUENCE='1' --and TTCMFL.SETTLEMENT_RATE is not null
--AND TRIM(TTCMFL.CASH_FLOW_LABEL) IS not NULL and  TRIM(TTCMFL.REFERENCE_RATE_VALUE) IS not  NULL 
LEFT JOIN (SELECT * FROM (
  SELECT distinct a.PARENT_FBO_ID_NUM,a.PARENT_FBO_ID_TYPE,A.IQ_CURRENCY PAY_CCY,a.NAME pay_nos ,B.IQ_CURRENCY REC_CCY,b.NAME rec_nos  FROM (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT') A
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT') B ON A.PARENT_FBO_ID_TYPE = B.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM
  )) NOS ON NOS.PARENT_FBO_ID_NUM = FIN_COM_LOAN.DEAL_NUM AND NOS.PARENT_FBO_ID_TYPE = FIN_COM_LOAN.DEAL_TYPE
WHERE D.MDATE>TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND TRIM(D.REVDATE) IS NULL 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
equity_deal.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
equity_deal.sql 

SELECT EQ_DEAL.DEAL_IDENTIFIER ||'-'||EQ_DEAL.EQUITY_MF_DEFN_NAME ||'-'||TRIM(ENTITY_NAME) ||'-'||EQ_DEAL.SUBTYPE ||'-'||TRIM(EQ_DEAL.COUNTERPARTY_STRING) ||'-'||TO_DATE(EQ_DEAL.DEAL_DATE,'DD-MM-YYYY') ||'-'||EQ_DEAL.BUY_OR_SELL ||'-'||
EQ_DEAL.CURRENCY_STRING ||'-'||ROUND(EQ_DEAL.PRICE_STRING,5) ||'-'||EQ_DEAL.QTY_TRADED OPICS_DATA,
EQDL.DEAL_IDENTIFIER ||'-'||trim(EQDEF.NAME) ||'-'||trim(SDENT.NAME) ||'-'||trim(SDSBTY.NAME) ||'-'||trim(SDCP.NAME) ||'-'||EQDL.DEAL_DATE||'-'||CASE WHEN EQDL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END||'-'||EQDL.SETTLEMENT_CCY ||'-'||
ROUND(REPLACE(EQDL.PRICE_STRING,',',''),5) ||'-'||EQDL.QTY_TRADED FIN_DATA,
CASE WHEN trim(
EQ_DEAL.DEAL_IDENTIFIER ||'-'||trim(substr(EQ_DEAL.EQUITY_MF_DEFN_NAME,1,15)) ||'-'||TRIM(ENTITY_NAME) ||'-'||EQ_DEAL.SUBTYPE ||'-'||TRIM(EQ_DEAL.COUNTERPARTY_STRING) ||'-'||TO_DATE(EQ_DEAL.DEAL_DATE,'DD-MM-YYYY') ||'-'||
EQ_DEAL.BUY_OR_SELL ||'-'||EQ_DEAL.CURRENCY_STRING ||'-'||ROUND(EQ_DEAL.PRICE_STRING,5) ||'-'||EQ_DEAL.QTY_TRADED
) 
=
trim(
EQDL.DEAL_IDENTIFIER ||'-'||trim(EQDEF.NAME) ||'-'||trim(SDENT.NAME) ||'-'||trim(SDSBTY.NAME) ||'-'||trim(SDCP.NAME) ||'-'||EQDL.DEAL_DATE||'-'||CASE WHEN EQDL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END||'-'||EQDL.SETTLEMENT_CCY ||'-'||
ROUND(REPLACE(EQDL.PRICE_STRING,',',''),5) ||'-'||EQDL.QTY_TRADED
)
 THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM EQUITY_MF_O_TABLE EQ_DEAL
LEFT JOIN TT_EQUITY_MF@FTMIG EQDL ON TRIM(EQ_DEAL.DEAL_IDENTIFIER) = TRIM(EQDL.DEAL_IDENTIFIER)
LEFT JOIN SD_EQUITY_MF_DEFN@FTMIG EQDEF ON EQUITY_MF_DEFN_FBO_ID_NUM = FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftmig SDENT ON SDENT.FBO_ID_NUM = EQDL.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftmig SDSBTY ON SDSBTY.FBO_ID_NUM = EQDL.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftmig SDCP ON SDCP.FBO_ID_NUM= EQDL.CPTY_FBO_ID_NUM


SELECT 
EQ_DEAL.DEAL_IDENTIFIER MAPPED_DEALNO,EQDL.DEAL_IDENTIFIER FIN_DEALNO, CASE WHEN EQ_DEAL.DEAL_IDENTIFIER = EQDL.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
EQ_DEAL.EQUITY_MF_DEFN_NAME OPICS_SECID,trim(EQDEF.NAME) FIN_SECID, CASE WHEN EQ_DEAL.EQUITY_MF_DEFN_NAME  = trim(EQDEF.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SECID,
CASE WHEN TRIM(ENTITY_NAME)='ABKKWT' THEN '51' ELSE '01' END OPICS_ENTITY,TRIM(SDENT.NAME) MAPPED_ENTITY, TRIM(SDENT.NAME) FIN_ENTITY, CASE WHEN  TRIM(ENTITY_NAME) = TRIM(SDENT.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
PORT OPICS_PORT,EQ_DEAL.SUBTYPE MAPPED_SUBTYPE,trim(SDSBTY.NAME) FIN_SUBTYPE ,CASE WHEN  TRIM(EQ_DEAL.SUBTYPE) = trim(SDSBTY.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
COUNTERPARTY_STRING OPICS_COUNTERPARTY,trim(SDCP.NAME) FIN_COUNTERPARTY,CASE WHEN  TRIM(COUNTERPARTY_STRING) = trim(SDCP.NAME)  THEN 'TRUE' ELSE 'FALSE' END MATCH_COUNTERPARTY,
TO_DATE(EQ_DEAL.DEAL_DATE,'DD-MM-YYYY') MAPPED_DEAL_DATE,EQDL.DEAL_DATE FIN_DEAL_DATE,CASE WHEN TO_DATE(EQ_DEAL.DEAL_DATE,'DD-MM-YYYY')  = EQDL.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
EQ_DEAL.BUY_OR_SELL OPICS_BUY_OR_SELL,CASE WHEN EQDL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END FIN_BUY_OR_SELL ,CASE WHEN EQ_DEAL.BUY_OR_SELL  =CASE WHEN EQDL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END THEN 'TRUE' ELSE 'FALSE' END MATCH_BUY_OR_SELL,
ROUND(EQ_DEAL.PRICE_STRING,5) OPICS_AVG_PRICE,ROUND(REPLACE(EQDL.PRICE_STRING,',',''),5) FIN_PRICE,CASE WHEN ROUND(EQ_DEAL.PRICE_STRING,5)  = ROUND(REPLACE(EQDL.PRICE_STRING,',',''),5) THEN 'TRUE' ELSE 'FALSE' END MATCH_PRICE,
EQ_DEAL.QTY_TRADED OPICS_QTY, EQDL.QTY_TRADED FIN_QTY,CASE WHEN  EQ_DEAL.QTY_TRADED =  EQDL.QTY_TRADED  THEN 'TRUE' ELSE 'FALSE' END MATCH_QTY,
EQ_DEAL.DEAL_IDENTIFIER ||'-'||EQ_DEAL.EQUITY_MF_DEFN_NAME ||'-'||TRIM(ENTITY_NAME) ||'-'||EQ_DEAL.SUBTYPE ||'-'||TRIM(EQ_DEAL.COUNTERPARTY_STRING) ||'-'||TO_DATE(EQ_DEAL.DEAL_DATE,'DD-MM-YYYY') ||'-'||EQ_DEAL.BUY_OR_SELL ||'-'||
EQ_DEAL.CURRENCY_STRING ||'-'||ROUND(EQ_DEAL.PRICE_STRING,5) ||'-'||EQ_DEAL.QTY_TRADED OPICS_DATA,
EQDL.DEAL_IDENTIFIER ||'-'||trim(EQDEF.NAME) ||'-'||trim(SDENT.NAME) ||'-'||trim(SDSBTY.NAME) ||'-'||trim(SDCP.NAME) ||'-'||EQDL.DEAL_DATE||'-'||CASE WHEN EQDL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END||'-'||EQDL.SETTLEMENT_CCY ||'-'||
ROUND(REPLACE(EQDL.PRICE_STRING,',',''),5) ||'-'||EQDL.QTY_TRADED FIN_DATA,
CASE WHEN trim(
EQ_DEAL.DEAL_IDENTIFIER ||'-'||trim(substr(EQ_DEAL.EQUITY_MF_DEFN_NAME,1,15)) ||'-'||TRIM(ENTITY_NAME) ||'-'||EQ_DEAL.SUBTYPE ||'-'||TRIM(EQ_DEAL.COUNTERPARTY_STRING) ||'-'||TO_DATE(EQ_DEAL.DEAL_DATE,'DD-MM-YYYY') ||'-'||
EQ_DEAL.BUY_OR_SELL ||'-'||EQ_DEAL.CURRENCY_STRING ||'-'||ROUND(EQ_DEAL.PRICE_STRING,5) ||'-'||EQ_DEAL.QTY_TRADED
) 
=
trim(
EQDL.DEAL_IDENTIFIER ||'-'||trim(EQDEF.NAME) ||'-'||trim(SDENT.NAME) ||'-'||trim(SDSBTY.NAME) ||'-'||trim(SDCP.NAME) ||'-'||EQDL.DEAL_DATE||'-'||CASE WHEN EQDL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END||'-'||EQDL.SETTLEMENT_CCY ||'-'||
ROUND(REPLACE(EQDL.PRICE_STRING,',',''),5) ||'-'||EQDL.QTY_TRADED
)
 THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM EQUITY_MF_O_TABLE EQ_DEAL
LEFT JOIN TT_EQUITY_MF@FTMIG EQDL ON TRIM(EQ_DEAL.DEAL_IDENTIFIER) = TRIM(EQDL.DEAL_IDENTIFIER)
LEFT JOIN SD_EQUITY_MF_DEFN@FTMIG EQDEF ON EQUITY_MF_DEFN_FBO_ID_NUM = FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftmig SDENT ON SDENT.FBO_ID_NUM = EQDL.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftmig SDSBTY ON SDSBTY.FBO_ID_NUM = EQDL.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftmig SDCP ON SDCP.FBO_ID_NUM= EQDL.CPTY_FBO_ID_NUM
LEFT JOIN(SELECT * FROM TR_EQU_AND_SEC_OUTSTANDING WHERE TRIM(TYPE)='Investments' AND TRIM(NETQTY) != 0 AND TRIM(NETQTY) IS NOT NULL AND CASE WHEN TRIM(SECID)='ABK TREASURY' 
AND TRIM(PORT) !='TS' THEN 0 ELSE 1  END = 1) E ON TRIM(E.SECID) =  TRIM(EQ_DEAL.EQUITY_MF_DEFN_NAME)


SELECT 
EQ_DEAL.DEAL_IDENTIFIER MAPPED_DEALNO,EQDL.DEAL_IDENTIFIER FIN_DEALNO, CASE WHEN EQ_DEAL.DEAL_IDENTIFIER = EQDL.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
EQ_DEAL.EQUITY_MF_DEFN_NAME OPICS_SECID,trim(EQDEF.NAME) FIN_SECID, CASE WHEN EQ_DEAL.EQUITY_MF_DEFN_NAME  = trim(EQDEF.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SECID,
CASE WHEN TRIM(ENTITY_NAME)='ABKKWT' THEN '51' ELSE '01' END OPICS_ENTITY,TRIM(SDENT.NAME) MAPPED_ENTITY, TRIM(SDENT.NAME) FIN_ENTITY, CASE WHEN  TRIM(ENTITY_NAME) = TRIM(SDENT.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
PORT OPICS_PORT,EQ_DEAL.SUBTYPE MAPPED_SUBTYPE,trim(SDSBTY.NAME) FIN_SUBTYPE ,CASE WHEN  TRIM(EQ_DEAL.SUBTYPE) = trim(SDSBTY.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
COUNTERPARTY_STRING OPICS_COUNTERPARTY,trim(SDCP.NAME) FIN_COUNTERPARTY,CASE WHEN  TRIM(COUNTERPARTY_STRING) = trim(SDCP.NAME)  THEN 'TRUE' ELSE 'FALSE' END MATCH_COUNTERPARTY,
TO_DATE(EQ_DEAL.DEAL_DATE,'DD-MM-YYYY') MAPPED_DEAL_DATE,EQDL.DEAL_DATE FIN_DEAL_DATE,CASE WHEN TO_DATE(EQ_DEAL.DEAL_DATE,'DD-MM-YYYY')  = EQDL.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
EQ_DEAL.BUY_OR_SELL OPICS_BUY_OR_SELL,CASE WHEN EQDL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END FIN_BUY_OR_SELL ,CASE WHEN EQ_DEAL.BUY_OR_SELL  =CASE WHEN EQDL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END THEN 'TRUE' ELSE 'FALSE' END MATCH_BUY_OR_SELL,
ROUND(EQ_DEAL.PRICE_STRING,5) OPICS_AVG_PRICE,ROUND(REPLACE(EQDL.PRICE_STRING,',',''),5) FIN_PRICE,CASE WHEN ROUND(EQ_DEAL.PRICE_STRING,5)  = ROUND(REPLACE(EQDL.PRICE_STRING,',',''),5) THEN 'TRUE' ELSE 'FALSE' END MATCH_PRICE,
nvl(EQ_DEAL.QTY_TRADED,round(EQ_DEAL.SETTLEMENT/EQ_DEAL.PRICE_STRING,0)) OPICS_QTY, EQDL.QTY_TRADED FIN_QTY,CASE WHEN  nvl(EQ_DEAL.QTY_TRADED,round(EQ_DEAL.SETTLEMENT/EQ_DEAL.PRICE_STRING,0)) =  EQDL.QTY_TRADED  THEN 'TRUE' ELSE 'FALSE' END MATCH_QTY,
EQ_DEAL.DEAL_IDENTIFIER ||'-'||EQ_DEAL.EQUITY_MF_DEFN_NAME ||'-'||TRIM(ENTITY_NAME) ||'-'||EQ_DEAL.SUBTYPE ||'-'||TRIM(EQ_DEAL.COUNTERPARTY_STRING) ||'-'||TO_DATE(EQ_DEAL.DEAL_DATE,'DD-MM-YYYY') ||'-'||EQ_DEAL.BUY_OR_SELL ||'-'||
EQ_DEAL.CURRENCY_STRING ||'-'||ROUND(EQ_DEAL.PRICE_STRING,5) ||'-'||nvl(EQ_DEAL.QTY_TRADED,round(EQ_DEAL.SETTLEMENT/EQ_DEAL.PRICE_STRING,0)) OPICS_DATA,
EQDL.DEAL_IDENTIFIER ||'-'||trim(EQDEF.NAME) ||'-'||trim(SDENT.NAME) ||'-'||trim(SDSBTY.NAME) ||'-'||trim(SDCP.NAME) ||'-'||EQDL.DEAL_DATE||'-'||CASE WHEN EQDL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END||'-'||EQDL.SETTLEMENT_CCY ||'-'||
ROUND(REPLACE(EQDL.PRICE_STRING,',',''),5) ||'-'||EQDL.QTY_TRADED FIN_DATA,
CASE WHEN trim(
EQ_DEAL.DEAL_IDENTIFIER ||'-'||trim(substr(EQ_DEAL.EQUITY_MF_DEFN_NAME,1,15)) ||'-'||TRIM(ENTITY_NAME) ||'-'||EQ_DEAL.SUBTYPE ||'-'||TRIM(EQ_DEAL.COUNTERPARTY_STRING) ||'-'||TO_DATE(EQ_DEAL.DEAL_DATE,'DD-MM-YYYY') ||'-'||
EQ_DEAL.BUY_OR_SELL ||'-'||EQ_DEAL.CURRENCY_STRING ||'-'||ROUND(EQ_DEAL.PRICE_STRING,5) ||'-'||nvl(EQ_DEAL.QTY_TRADED,round(EQ_DEAL.SETTLEMENT/EQ_DEAL.PRICE_STRING,0))
) 
=
trim(
EQDL.DEAL_IDENTIFIER ||'-'||trim(EQDEF.NAME) ||'-'||trim(SDENT.NAME) ||'-'||trim(SDSBTY.NAME) ||'-'||trim(SDCP.NAME) ||'-'||EQDL.DEAL_DATE||'-'||CASE WHEN EQDL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END||'-'||EQDL.SETTLEMENT_CCY ||'-'||
ROUND(REPLACE(EQDL.PRICE_STRING,',',''),5) ||'-'||EQDL.QTY_TRADED
)
 THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM EQUITY_MF_O_TABLE EQ_DEAL
LEFT JOIN TT_EQUITY_MF@FTMIG EQDL ON  TRIM(EQDL.DEAL_IDENTIFIER) like TRIM(EQ_DEAL.DEAL_IDENTIFIER) ||'%'  
LEFT JOIN SD_EQUITY_MF_DEFN@FTMIG EQDEF ON EQUITY_MF_DEFN_FBO_ID_NUM = FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftmig SDENT ON SDENT.FBO_ID_NUM = EQDL.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftmig SDSBTY ON SDSBTY.FBO_ID_NUM = EQDL.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftmig SDCP ON SDCP.FBO_ID_NUM= EQDL.CPTY_FBO_ID_NUM
LEFT JOIN(SELECT * FROM TR_EQU_AND_SEC_OUTSTANDING WHERE TRIM(TYPE)='Investments' AND TRIM(NETQTY) != 0 AND TRIM(NETQTY) IS NOT NULL AND CASE WHEN TRIM(SECID)='ABK TREASURY' 
AND TRIM(PORT) !='TS' THEN 0 ELSE 1  END = 1) E ON TRIM(E.SECID) =  TRIM(EQ_DEAL.EQUITY_MF_DEFN_NAME) 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
equity_defn_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
equity_defn_report.sql 
SELECT 
SECID OPICS_NAME,EQDN.NAME FINACLE_NAME,CASE WHEN TRIM(SECID) = TRIM(EQDN.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SECID,
SECID OPICS_SECID,EQDN.INSTRUMENT_TYPE FINACLE_INSTRUMENT_TYPE,
SECID OPICS_SECID,EQDN.INSTRUMENT_SUBTYPE FINACLE_INSTRUMENT_SUBTYPE,
C.CMNE ISSUER_STRING,--@@@@@@@@
PRODTYPE ,SECID INSTRUMENT_CLASS_DATA_NAME,--
CCY OPICS_CCY,EQDN.ISSUE_CCY FINACLE_ISSUE_CCY,CASE WHEN CCY = EQDN.ISSUE_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
DESCR OPICS_DESCR,EQDN.DESCRIPTION FINACLE_DESCRIPTION,CASE WHEN TRIM(DESCR) = TRIM(EQDN.DESCRIPTION) THEN 'TRUE' ELSE 'FALSE' END MATCH_DESCR,
DENOM OPICS_DENOM,EQDN.MARKET_LOT FINACLE_MARKET_LOT,CASE WHEN TO_NUMBER(DENOM) = TO_NUMBER(EQDN.MARKET_LOT) THEN 'TRUE' ELSE 'FALSE' END MATCH_MARKET_LOT,
PARAMT OPICS_PARAMT,EQDN.FACE_VALUE FINACLE_FACE_VALUE,CASE WHEN TO_NUMBER(PARAMT) = TO_NUMBER(EQDN.FACE_VALUE) THEN 'TRUE' ELSE 'FALSE' END MATCH_FACE_VALUE,
MDATE  OPICS_MDATE,EQDN.DATE_TO_REALISE FINACLE_DATE_TO_REALISE,
C.UCCODE ,ISSUANCE_DATA_COI_FBO_ID_NUM--
FROM  SECM S
INNER JOIN CUST C ON TRIM(S.ISSUER)=TRIM(C.CNO)
LEFT JOIN FTABKBPD.SD_EQUITY_MF_DEFN@FTFC EQDN ON TRIM(S.SECID) = TRIM(EQDN.NAME)
WHERE S.PRODTYPE NOT IN ('F1','F2','FI','SB','TB','TL');




select TRIM(EQ_DEF.NAME) ||'-'||EQ_DEF.INSTRUMENT_TYPE ||'-'||TRIM(ISSUER_STRING) ||'-'||EQ_DEF.INSTRUMENT_SUBTYPE ||'-'||INSTRUMENT_CLASS_DATA_NAME ||'-'||
EQ_DEF.ISSUE_CCY ||'-'||EQ_DEF.FACE_VALUE OPICS_DATA,
EQDN.NAME ||'-'||EQDN.INSTRUMENT_TYPE ||'-'||SDCP.NAME ||'-'||EQDN.INSTRUMENT_SUBTYPE ||'-'||INCL.NAME ||'-'||
EQDN.ISSUE_CCY ||'-'||EQDN.FACE_VALUE FIN_DATA,
CASE WHEN TRIM(EQ_DEF.NAME) ||'-'||EQ_DEF.INSTRUMENT_TYPE ||'-'||TRIM(ISSUER_STRING) ||'-'||EQ_DEF.INSTRUMENT_SUBTYPE ||'-'||INSTRUMENT_CLASS_DATA_NAME ||'-'||
EQ_DEF.ISSUE_CCY ||'-'||EQ_DEF.FACE_VALUE = 
EQDN.NAME ||'-'||EQDN.INSTRUMENT_TYPE ||'-'||SDCP.NAME ||'-'||EQDN.INSTRUMENT_SUBTYPE ||'-'||INCL.NAME ||'-'||
EQDN.ISSUE_CCY ||'-'||EQDN.FACE_VALUE  THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
 from EQUITY_DEFN_O_TABLE EQ_DEF
LEFT JOIN SD_EQUITY_MF_DEFN@ftmig EQDN ON TRIM(EQ_DEF.NAME) LIKE TRIM(EQDN.NAME)||'%'
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= EQDN.ISSUER_FBO_ID_NUM
LEFT JOIN SD_INSTRUMENT_CLASS@FTMIG  INCL ON INCL.FBO_ID_NUM = INSTRUMENT_CLASS_FBO_ID_NUM



select distinct TRIM(EQ_DEF.NAME) ||'-'||EQ_DEF.INSTRUMENT_TYPE ||'-'||TRIM(ISSUER_STRING) ||'-'||EQ_DEF.INSTRUMENT_SUBTYPE ||'-'||INSTRUMENT_CLASS_DATA_NAME ||'-'||
EQ_DEF.ISSUE_CCY ||'-'||EQ_DEF.FACE_VALUE OPICS_DATA,
EQDN.NAME ||'-'||EQDN.INSTRUMENT_TYPE ||'-'||trim(SDCP.NAME) ||'-'||EQDN.INSTRUMENT_SUBTYPE ||'-'||INCL.NAME ||'-'||
EQDN.ISSUE_CCY ||'-'||EQDN.FACE_VALUE FIN_DATA,
CASE WHEN trim(
trim(substr(TRIM(EQ_DEF.NAME),1,15))  ||'-'||EQ_DEF.INSTRUMENT_TYPE ||'-'||TRIM(ISSUER_STRING) ||'-'||EQ_DEF.INSTRUMENT_SUBTYPE ||'-'||INSTRUMENT_CLASS_DATA_NAME ||'-'||
EQ_DEF.ISSUE_CCY ||'-'||EQ_DEF.FACE_VALUE
)
 = 
trim(
EQDN.NAME ||'-'||EQDN.INSTRUMENT_TYPE ||'-'||trim(SDCP.NAME) ||'-'||EQDN.INSTRUMENT_SUBTYPE ||'-'||INCL.NAME ||'-'||
EQDN.ISSUE_CCY ||'-'||EQDN.FACE_VALUE
)
  THEN 'TRUE' ELSE 'FALSE' END
 MATCH_DATA
 from EQUITY_DEFN_O_TABLE EQ_DEF
LEFT JOIN SD_EQUITY_MF_DEFN@ftmig EQDN ON replace(TRIM(EQ_DEF.DESCRIPTION),' ','') LIKE replace(TRIM(EQDN.DESCRIPTION),' ','')||'%'
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= EQDN.ISSUER_FBO_ID_NUM
LEFT JOIN SD_INSTRUMENT_CLASS@FTMIG  INCL ON INCL.FBO_ID_NUM = INSTRUMENT_CLASS_FBO_ID_NUM


select DISTINCT 
TRIM(EQ_DEF.NAME) OPICS_SECID ,EQDN.NAME FIN_SECID,CASE WHEN TRIM(EQ_DEF.NAME) = EQDN.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SECID,
TRIM(EQ_DEF.DESCRIPTION) OPICS_DESCRIPTION ,EQDN.DESCRIPTION FIN_DESCRIPTION,CASE WHEN TRIM(EQ_DEF.DESCRIPTION) = EQDN.DESCRIPTION THEN 'TRUE' ELSE 'FALSE' END MATCH_DESCRIPTION,
EQ_DEF.INSTRUMENT_TYPE MAPPED_INSTRUMENT_TYPE ,EQDN.INSTRUMENT_TYPE FIN_INSTRUMENT_TYPE,CASE WHEN EQ_DEF.INSTRUMENT_TYPE  = EQDN.INSTRUMENT_TYPE THEN 'TRUE' ELSE 'FALSE' END MATCH_INSTRUMENT_TYPE,
TRIM(ISSUER_STRING) OPICS_CPTY,trim(SDCP.NAME) FIN_CPTY,CASE WHEN TRIM(ISSUER_STRING) = trim(SDCP.NAME)THEN 'TRUE' ELSE 'FALSE' END MATCH_CPTY,
PORT OPICS_PORT,EQ_DEF.INSTRUMENT_SUBTYPE MAPPED_INSTRUMENT_SUBTYPEE,EQDN.INSTRUMENT_SUBTYPE FIN_INSTRUMENT_SUBTYPE,CASE WHEN EQ_DEF.INSTRUMENT_SUBTYPE = EQDN.INSTRUMENT_SUBTYPE THEN 'TRUE' ELSE 'FALSE' END MATCH_INSTRUMENT_SUBTYPE,
INSTRUMENT_CLASS_DATA_NAME MAPPED_NSTRUMENT_CLASS ,INCL.NAME FIN_NSTRUMENT_CLASS ,CASE WHEN INSTRUMENT_CLASS_DATA_NAME = INCL.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_NSTRUMENT_CLASS,
EQ_DEF.ISSUE_CCY OPICS_CCY,EQDN.ISSUE_CCY FIN_CCY,CASE WHEN EQ_DEF.ISSUE_CCY = EQDN.ISSUE_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
EQ_DEF.FACE_VALUE OPICS_QTY,EQDN.FACE_VALUE FIN_QTY,CASE WHEN EQ_DEF.FACE_VALUE = EQDN.FACE_VALUE THEN 'TRUE' ELSE 'FALSE' END MATCH_QTY,
TRIM(EQ_DEF.NAME) ||'-'||EQ_DEF.INSTRUMENT_TYPE ||'-'||TRIM(ISSUER_STRING) ||'-'||EQ_DEF.INSTRUMENT_SUBTYPE ||'-'||INSTRUMENT_CLASS_DATA_NAME ||'-'||
EQ_DEF.ISSUE_CCY ||'-'||EQ_DEF.FACE_VALUE OPICS_DATA,
EQDN.NAME ||'-'||EQDN.INSTRUMENT_TYPE ||'-'||trim(SDCP.NAME) ||'-'||EQDN.INSTRUMENT_SUBTYPE ||'-'||INCL.NAME ||'-'||
EQDN.ISSUE_CCY ||'-'||EQDN.FACE_VALUE FIN_DATA,
CASE WHEN trim(
trim(substr(TRIM(EQ_DEF.NAME),1,15))  ||'-'||EQ_DEF.INSTRUMENT_TYPE ||'-'||TRIM(ISSUER_STRING) ||'-'||EQ_DEF.INSTRUMENT_SUBTYPE ||'-'||INSTRUMENT_CLASS_DATA_NAME ||'-'||
EQ_DEF.ISSUE_CCY ||'-'||EQ_DEF.FACE_VALUE
)
 = 
trim(
EQDN.NAME ||'-'||EQDN.INSTRUMENT_TYPE ||'-'||trim(SDCP.NAME) ||'-'||EQDN.INSTRUMENT_SUBTYPE ||'-'||INCL.NAME ||'-'||
EQDN.ISSUE_CCY ||'-'||EQDN.FACE_VALUE
)
  THEN 'TRUE' ELSE 'FALSE' END
 MATCH_DATA
 from EQUITY_DEFN_O_TABLE EQ_DEF
LEFT JOIN SD_EQUITY_MF_DEFN@ftmig EQDN ON replace(TRIM(EQ_DEF.DESCRIPTION),' ','') LIKE replace(TRIM(EQDN.DESCRIPTION),' ','')||'%' and ACTION!='DLT'
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= EQDN.ISSUER_FBO_ID_NUM
LEFT JOIN SD_INSTRUMENT_CLASS@FTMIG  INCL ON INCL.FBO_ID_NUM = INSTRUMENT_CLASS_FBO_ID_NUM
LEFT JOIN(SELECT * FROM TR_EQU_AND_SEC_OUTSTANDING WHERE TRIM(TYPE)='Investments' AND TRIM(NETQTY) != 0 AND TRIM(NETQTY) IS NOT NULL AND CASE WHEN TRIM(SECID)='ABK TREASURY' 
AND TRIM(PORT) !='TS' THEN 0 ELSE 1  END = 1) E ON TRIM(E.SECID) =  TRIM(EQ_DEF.NAME) 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
equity_price_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
equity_price_report.sql 
select SECURITY OPICS_SECID,NAME FIN_SECID, CASE WHEN TRIM(SECURITY) =TRIM(NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SECID,
BID OPICS_TRADED_PRICE,TRADED_PRICE FIN_BID_RATE, CASE WHEN round(TRIM(BID),8) =round(TRIM(TRADED_PRICE),8) THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADED_PRICE,
TO_DATE(BASE_DATE,'dd-Mon-yyyy') OPICS_BASE_DATE,FIN_BASE_DATE , CASE WHEN TO_DATE(BASE_DATE,'dd-Mon-yyyy') =TRIM(FIN_BASE_DATE) THEN 'TRUE' ELSE 'FALSE' END MATCH_BASE_DATE
 from EQUITY_PRICES_O_TABLE a
left join(
select a.NAME,TRADED_PRICE,c.BASE_DATE FIN_BASE_DATE from SD_EQUITY_MF_DEFN@ftmig a
inner join MRS_EQUITY_MF_PRICES@ftmig b on a.FBO_ID_NUM = b.EQUITY_MF_DEFN_FBO_ID_NUM
inner join MRS_NAMES@ftmig c on c.NAME = b.NAME
) b on case when trim(a.SECURITY)='MUBADALA AAYAN CO 2' then 'MUBADALA AAYAN 2' else  trim(substr(trim(a.SECURITY),1,15)) end = trim(b.NAME)


select SECURITY OPICS_SECID,NAME FIN_SECID, CASE WHEN TRIM(SECURITY) =TRIM(NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SECID,
PRICE OPICS_TRADED_PRICE,TRADED_PRICE FIN_TRADED_PRICE, CASE WHEN round(TRIM(PRICE),8) =round(TRIM(TRADED_PRICE),8) THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADED_PRICE
 from EQUITY_PRICES_O_TABLE a
left join(
select a.NAME,TRADED_PRICE,c.BASE_DATE FIN_BASE_DATE from SD_EQUITY_MF_DEFN@ftmig a
inner join MRS_EQUITY_MF_PRICES@ftmig b on a.FBO_ID_NUM = b.EQUITY_MF_DEFN_FBO_ID_NUM
inner join MRS_NAMES@ftmig c on c.NAME = b.NAME
) b on case when trim(a.SECURITY)='MUBADALA AAYAN CO 2' then 'MUBADALA AAYAN2' else  trim(substr(trim(a.SECURITY),1,15)) end = trim(b.NAME) 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
fx_outright_deals_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
fx_outright_deals_report.sql 
select 
F.DEALDATE OPICS_DEALDATE,FIN_FX_OUTRIGHT.DEAL_DATE FINACLE_DEAL_DATE ,CASE WHEN TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD') = FIN_FX_OUTRIGHT.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALDATE,
F.DEALNO OPICS_DEALNO, FIN_FX_OUTRIGHT.DEAL_IDENTIFIER FINACLE_DEAL_IDENTIFIER, CASE WHEN TRIM(F.DEALNO) = TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER) THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
F.PORT OPICS_PORT,SDTRBK.NAME FINACLE_TRADING_BOOK, CASE WHEN CASE WHEN trim(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(PORT) IN('FXTR','PORT') THEN 'DEALER1' END = SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK, 
F.PORT OPICS_PORT,SDSBTY.NAME FINACLE_SUBTYPE, CASE WHEN CASE WHEN trim(PORT) = 'CORP' THEN 'CORP' WHEN trim(PORT) != 'CORP' THEN 'BANK' end = SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
F.BR OPICS_BR,SDENT.NAME FINACLE_ENTITY_NAME,CASE WHEN CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END like  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY_NAME,
C.CMNE OPICS_CMNE,SDCP.name FINACLE_MAIN_LEG_CPTY,CASE WHEN TRIM(C.CMNE) = TRIM(SDCP.name) THEN 'TRUE' ELSE 'FALSE' END MATCH_MAIN_LEG_CPTY,
F.CCYTERMS OPICS_CCYTERMS ,F.CCY OPICS_CCY,F.CTRCCY OPICS_CTRCCY,TTFXL.CCY_PAIR FINACLE_MAIN_LEG_CCY_PAIR,CASE when case when F.CCYTERMS='M' then F.CCY||'/'||F.CTRCCY else F.CTRCCY||'/'||F.CCY end = TTFXL.CCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR,
--F.DISAGGCCY OPICS_DISAGGCCY, FIN_FX_OUTRIGHT.DCO_CURRENCY,
--F.PS OPICS_PS,--F.CCYTERMS,FIN_FX_SPOT.MAIN_LEG_FX_BUY_SELL,--*****
F.CCYTERMS OPICS_CCYTERMS,F.CCYAMT OPICS_CCYAMT,case when F.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end  FIN_MAIN_LEG_CCY_ONE_AMOUNT,
    CASE WHEN abs(round(F.CCYAMT,2)) = round(case when F.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_AMOUNT,
F.CCYRATE_8 OPICS_CCYRATE_8,TTFXFL.RATE FIN_MAIN_LEG_MARKET_FWD_RATE,CASE WHEN F.CCYRATE_8 = TTFXFL.RATE THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYRATE,
F.CCYTERMS OPICS_CCYTERMS,F.CTRAMT OPICS_CCYAMT,case when F.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end  FIN_MAIN_LEG_CCY_TWO_AMOUNT,
    CASE WHEN abs(round(F.CTRAMT,2)) = round(case when F.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CTR_AMOUNT,
F.VDATE,TTFXFL.VALUE_DATE_ONE FIN_MAIN_LEG_VALUE_DATE_ONE,CASE WHEN TO_DATE(TRIM(F.VDATE),'YYYY-MM-DD') = TTFXFL.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END FIN_MAIN_LEG_VALUE_DATE_ONE
from FXDH F  
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(F.CUST)
LEFT JOIN TT_FXP_DEAL@ftuat FIN_FX_OUTRIGHT on  TRIM(f.DEALNO) = TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER) AND FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@ftuat SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftuat SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftuat SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftuat SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@ftuat TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM
LEFT JOIN (SELECT * FROM (
  SELECT * FROM  TT_FXP_LEG@ftuat A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@ftuat GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM)
  )) TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND TRIM(PRODCODE)!='CCS' AND TRIM(REVDATE) IS NULL AND TRIM(SWAPDEAL)='0' AND  SPOTFWDIND='F'
AND TRIM(C.CMNE)!='CCIRS' and trim(PORT)!='EQFX'
;



select distinct 
F.DEALDATE||'-'||F.DEALNO ||'-'||F.PORT||'-'||F.PORT||'-'||F.BR||'-'||C.CMNE||'-'||F.CCYTERMS ||'-'||F.CCY||'-'||F.CTRCCY||'-'||F.CCYTERMS||'-'||F.CCYAMT||'-'||F.CCYRATE_8||'-'||
F.CCYTERMS||'-'||F.CTRAMT||'-'||F.VDATE OPICS_DATA,
TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(F.DEALNO) ||'-'||CASE WHEN trim(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||
CASE WHEN trim(PORT) = 'CORP' THEN 'CORP' WHEN trim(PORT) != 'CORP' THEN 'BANK' end||'-'||CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||
TRIM(C.CMNE)||'-'||case when F.CCYTERMS='M' then F.CCY||'/'||F.CTRCCY else F.CTRCCY||'/'||F.CCY end||'-'||abs(round(F.CCYAMT,2))||'-'||ROUND(F.CCYRATE_8,3)||'-'||abs(round(F.CTRAMT,2))||'-'||TO_DATE(TRIM(F.VDATE),'YYYY-MM-DD') CONV_OPICS_DATA,
FIN_FX_OUTRIGHT.DEAL_DATE ||'-'||TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME ||'-'||TRIM(SDCP.name)||'-'||
TTFXL.CCY_PAIR ||'-'||ROUND(case when F.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end,2)||'-'|| ROUND(case when TTFXL.CCY_PAIR='JPY/KWD' THEN (TTFXL.MARKET_SPOT_RATE*100) ELSE TTFXL.MARKET_SPOT_RATE END,3)||'-'||
 ROUND(case when F.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end,2)||'-'|| TTFXFL.VALUE_DATE_ONE FIN_DATA,
 CASE WHEN TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(F.DEALNO) ||'-'||CASE WHEN trim(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||
CASE WHEN trim(PORT) = 'CORP' THEN 'CORP' WHEN trim(PORT) != 'CORP' THEN 'BANK' end||'-'||CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||
TRIM(C.CMNE)||'-'||case when F.CCYTERMS='M' then F.CCY||'/'||F.CTRCCY else F.CTRCCY||'/'||F.CCY end||'-'||abs(round(F.CCYAMT,2))||'-'||ROUND(F.CCYRATE_8,3)||'-'||abs(round(F.CTRAMT,2))||'-'||TO_DATE(TRIM(F.VDATE),'YYYY-MM-DD') = 
FIN_FX_OUTRIGHT.DEAL_DATE ||'-'||TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME ||'-'||TRIM(SDCP.name)||'-'||
TTFXL.CCY_PAIR ||'-'||ROUND(case when F.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end,2)||'-'|| ROUND(case when TTFXL.CCY_PAIR='JPY/KWD' THEN (TTFXL.MARKET_SPOT_RATE*100) ELSE TTFXL.MARKET_SPOT_RATE END,3) ||'-'||
 ROUND(case when F.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end,2)||'-'|| TTFXFL.VALUE_DATE_ONE
THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
from FXDH F  
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(F.CUST)
LEFT JOIN TT_FXP_DEAL@FTMIG FIN_FX_OUTRIGHT on  TRIM(f.DEALNO) = TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER) AND FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTMIG TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM and PARENT_FBO_ID_VER='1' and PARENT_FBO_MIN_VER='1'
LEFT JOIN (SELECT * FROM (
  SELECT * FROM  TT_FXP_LEG@FTMIG A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@FTMIG GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM)
  )) TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND TRIM(PRODCODE)!='CCS' AND TRIM(REVDATE) IS NULL AND TRIM(SWAPDEAL)='0' AND  SPOTFWDIND='F'
AND TRIM(C.CMNE)!='CCIRS' and trim(PORT)!='EQFX'
;


select distinct
F.DEALDATE||'-'||F.DEALNO ||'-'||F.PORT||'-'||F.PORT||'-'||F.BR||'-'||C.CMNE||'-'||F.CCYTERMS ||'-'||F.CCY||'-'||F.CTRCCY||'-'||F.CCYTERMS||'-'||F.CCYAMT||'-'||F.CCYRATE_8||'-'||
F.CCYTERMS||'-'||F.CTRAMT||'-'||F.VDATE OPICS_DATA,
TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(F.DEALNO) ||'-'||CASE WHEN trim(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||
CASE WHEN trim(PORT) = 'CORP' THEN 'CORP' WHEN trim(PORT) != 'CORP' THEN 'BANK' end||'-'||CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||
TRIM(C.CMNE)||'-'||case when F.CCYTERMS='M' then F.CCY||'/'||F.CTRCCY else F.CTRCCY||'/'||F.CCY end||'-'||abs(round(F.CCYAMT,2))||'-'||ROUND(F.CCYRATE_8,3)||'-'||abs(round(F.CTRAMT,2))||'-'||TO_DATE(TRIM(F.VDATE),'YYYY-MM-DD') CONV_OPICS_DATA,
FIN_FX_OUTRIGHT.DEAL_DATE ||'-'||TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME ||'-'||TRIM(SDCP.name)||'-'||
TTFXL.CCY_PAIR ||'-'||ROUND(case when F.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end,2)||'-'|| ROUND(case when TTFXL.CCY_PAIR='JPY/KWD' THEN (TTFXL.MARKET_SPOT_RATE) ELSE TTFXL.MARKET_SPOT_RATE END,3)||'-'||
 ROUND(case when F.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end,2)||'-'|| TTFXFL.VALUE_DATE_ONE FIN_DATA,
 CASE WHEN TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(F.DEALNO) ||'-'||CASE WHEN trim(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||
CASE WHEN trim(PORT) = 'CORP' THEN 'CORP' WHEN trim(PORT) != 'CORP' THEN 'BANK' end||'-'||CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||
TRIM(C.CMNE)||'-'||case when F.CCYTERMS='M' then F.CCY||'/'||F.CTRCCY else F.CTRCCY||'/'||F.CCY end||'-'||abs(round(F.CCYAMT,2))||'-'||ROUND(F.CCYRATE_8,3)||'-'||abs(round(F.CTRAMT,2))||'-'||TO_DATE(TRIM(F.VDATE),'YYYY-MM-DD') = 
FIN_FX_OUTRIGHT.DEAL_DATE ||'-'||TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME ||'-'||TRIM(SDCP.name)||'-'||
TTFXL.CCY_PAIR ||'-'||ROUND(case when F.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end,2)||'-'|| ROUND(case when TTFXL.CCY_PAIR='JPY/KWD' THEN (TTFXL.MARKET_SPOT_RATE) ELSE TTFXL.MARKET_SPOT_RATE END,3) ||'-'||
 ROUND(case when F.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end,2)||'-'|| TTFXFL.VALUE_DATE_ONE
THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
from FXDH F  
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(F.CUST)
LEFT JOIN TT_FXP_DEAL@FTMIG FIN_FX_OUTRIGHT on  TRIM(f.DEALNO) = TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER) AND FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTMIG TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM and PARENT_FBO_ID_VER='1' and PARENT_FBO_MIN_VER='1'
LEFT JOIN (SELECT * FROM (
  SELECT * FROM  TT_FXP_LEG@FTMIG A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@FTMIG GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM)
  )) TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND TRIM(PRODCODE)!='CCS' AND TRIM(REVDATE) IS NULL AND TRIM(SWAPDEAL)='0' AND  SPOTFWDIND='F'
AND TRIM(C.CMNE)!='CCIRS' and trim(PORT)!='EQFX'
;

SELECT DISTINCT 
F.DEALNO OPICS_DEALNO ,FIN_FX_OUTRIGHT.DEAL_IDENTIFIER FIN_DEAL_IDENTIFIER, CASE WHEN TRIM(F.DEALNO) = FIN_FX_OUTRIGHT.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,TO_CHAR(FIN_FX_OUTRIGHT.DEAL_NUM) FIN_DEAL_NUM,
F.BR OPICS_BR, CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END MAPPED_ENTITY, SDENT.NAME FIN_ENTITY, CASE WHEN CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END =  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD') OPICS_DEAL_DATE ,FIN_FX_OUTRIGHT.DEAL_DATE FIN_DEAL_DATE,CASE WHEN TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD') = FIN_FX_OUTRIGHT.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
F.PORT OPICS_PORT,CASE WHEN TRIM(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN TRIM(PORT) IN('FXTR','PORT') THEN 'DEALER1' END MAPPED_TRADING_BOOK,SDTRBK.NAME FIN_TRADING_BOOK,CASE WHEN CASE WHEN TRIM(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN TRIM(PORT) IN('FXTR','PORT') THEN 'DEALER1' END = SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK,
CASE WHEN TRIM(PORT) = 'CORP' THEN 'CORP' WHEN TRIM(PORT) != 'CORP' THEN 'BANK' END MAPPED_SUBTYPE ,SDSBTY.NAME FIN_SUBTYPE,CASE WHEN CASE WHEN TRIM(PORT) = 'CORP' THEN 'CORP' WHEN TRIM(PORT) != 'CORP' THEN 'BANK' END = SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
TRIM(C.CMNE) OPICS_CPTY ,TRIM(SDCP.NAME) FIN_CPTY ,CASE WHEN TRIM(C.CMNE) = TRIM(SDCP.NAME)THEN 'TRUE' ELSE 'FALSE' END MATCH_CPTY,
CCYTERMS OPICS_CCYTERMS, CCY OPICS_CCY,CTRCCY OPICS_CTRCCY, CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END MAPPED_CCY_PAIR, TTFXL.CCY_PAIR  FIN_CCY_PAIR ,CASE WHEN CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END = TTFXL.CCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR ,
TRIM(DISAGGCCY) OPICS_DCO_CURRENCY,DCO_CURRENCY FIN_DCO_CURRENCY,CASE WHEN NVL(TRIM(DISAGGCCY),' ') =NVL(DCO_CURRENCY,' ')  THEN 'TRUE' ELSE 'FALSE' END MATCH_DCO_CURRENCY,
PS OPICS_PS,CASE WHEN PS='P' AND CCYTERMS='M' THEN 'BUY'     WHEN PS='S' AND CCYTERMS='M' THEN 'SELL'     WHEN PS='P' AND CCYTERMS='D' THEN 'SELL'     WHEN PS='S' AND CCYTERMS='D' THEN 'BUY'     END MAPPED_BUY_SELL,
CASE WHEN FX_BUY_SELL='S' THEN 'SELL' ELSE 'BUY' END FIN_BUY_SELL,CASE WHEN CASE WHEN PS='P' AND CCYTERMS='M' THEN 'BUY' WHEN PS='S' AND CCYTERMS='M' THEN 'SELL' WHEN PS='P' AND CCYTERMS='D' THEN 'SELL' WHEN PS='S' AND CCYTERMS='D' THEN 'BUY'     END = CASE WHEN FX_BUY_SELL='S' THEN 'SELL' ELSE 'BUY' END THEN 'TRUE' ELSE 'FALSE' END MATCH_BUY_SELL,
ABS(ROUND(F.CCYAMT,2)) OPICS_CCY_AMT,  ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_ONE_AMOUNT_VALUE ELSE TTFXL.CCY_TWO_AMOUNT_VALUE END,2) FIN_CCY_AMT,CASE WHEN ABS(ROUND(F.CCYAMT,2)) =  ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_ONE_AMOUNT_VALUE ELSE TTFXL.CCY_TWO_AMOUNT_VALUE END,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_AMT,
ABS(ROUND(F.CTRAMT,2)) OPICS_CTR_AMT,ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_TWO_AMOUNT_VALUE ELSE TTFXL.CCY_ONE_AMOUNT_VALUE END,2) FIN_CTR_AMT,CASE WHEN ABS(ROUND(F.CTRAMT,2)) = ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_TWO_AMOUNT_VALUE ELSE TTFXL.CCY_ONE_AMOUNT_VALUE END,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CTR_AMT,
ROUND(CCYRATE_8,5) MAPPED_RATE,ROUND(CASE WHEN TTFXL.CCY_PAIR='JPY/KWD' THEN ((TTFXL.MARKET_SPOT_RATE+TTFXL.SPOT_MARGIN_POINTS)*100) ELSE TTFXL.MARKET_SPOT_RATE+TTFXL.SPOT_MARGIN_POINTS END,5) FIN_RATE, CASE WHEN ROUND(CCYRATE_8,5) = ROUND(CASE WHEN TTFXL.CCY_PAIR='JPY/KWD' THEN ((TTFXL.MARKET_SPOT_RATE+TTFXL.SPOT_MARGIN_POINTS)*100) ELSE TTFXL.MARKET_SPOT_RATE+TTFXL.SPOT_MARGIN_POINTS END,5) THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE,
CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
END OPICS_PAY_NOSTRO,pay_nos FIN_PAY_NOSTRO,CASE WHEN trim(CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
END) = trim(pay_nos) THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_NOSTRO,
CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
END OPICS_REC_NOSTRO,rec_nos FIN_REC_NOSTRO,CASE WHEN   trim(CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
END) = trim(rec_nos) THEN 'TRUE' ELSE 'FALSE' END MATCH_REC_NOSTRO,
TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(F.DEALNO) ||'-'||CASE WHEN TRIM(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN TRIM(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||
CASE WHEN TRIM(PORT) = 'CORP' THEN 'CORP' WHEN TRIM(PORT) != 'CORP' THEN 'BANK' END||'-'||CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||
TRIM(C.CMNE)||'-'||CASE WHEN F.CCYTERMS='M' THEN F.CCY||'/'||F.CTRCCY ELSE F.CTRCCY||'/'||F.CCY END||'-'||ABS(ROUND(F.CCYAMT,2))||'-'||ROUND(CCYRATE_8-CASE WHEN TRIM(F.PORT) ='CORP' THEN F.CORPSPREAD_8 ELSE 0 END,5)||'-'||ABS(ROUND(F.CTRAMT,2))||'-'||TO_DATE(TRIM(F.VDATE),'YYYY-MM-DD') CONV_OPICS_DATA, 
FIN_FX_OUTRIGHT.DEAL_DATE ||'-'||TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME ||'-'||TRIM(SDCP.NAME)||'-'||
TTFXL.CCY_PAIR ||'-'||ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_ONE_AMOUNT_VALUE ELSE TTFXL.CCY_TWO_AMOUNT_VALUE END,2)||'-'|| ROUND(CASE WHEN TTFXL.CCY_PAIR='JPY/KWD' THEN ((TTFXL.MARKET_SPOT_RATE-TTFXL.SPOT_MARGIN_POINTS)*100) ELSE TTFXL.MARKET_SPOT_RATE-TTFXL.SPOT_MARGIN_POINTS END,5)||'-'||
 ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_TWO_AMOUNT_VALUE ELSE TTFXL.CCY_ONE_AMOUNT_VALUE END,2)||'-'|| TTFXFL.VALUE_DATE_ONE FIN_DATA,
 CASE WHEN TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(F.DEALNO) ||'-'||CASE WHEN TRIM(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN TRIM(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||
CASE WHEN TRIM(PORT) = 'CORP' THEN 'CORP' WHEN TRIM(PORT) != 'CORP' THEN 'BANK' END||'-'||CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||
TRIM(C.CMNE)||'-'||CASE WHEN F.CCYTERMS='M' THEN F.CCY||'/'||F.CTRCCY ELSE F.CTRCCY||'/'||F.CCY END||'-'||ABS(ROUND(F.CCYAMT,2))||'-'||ROUND(CCYRATE_8-CASE WHEN TRIM(F.PORT) ='CORP' THEN F.CORPSPREAD_8 ELSE 0 END,5)||'-'||ABS(ROUND(F.CTRAMT,2))||'-'||TO_DATE(TRIM(F.VDATE),'YYYY-MM-DD')
=
FIN_FX_OUTRIGHT.DEAL_DATE ||'-'||TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME ||'-'||TRIM(SDCP.NAME)||'-'||
TTFXL.CCY_PAIR ||'-'||ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_ONE_AMOUNT_VALUE ELSE TTFXL.CCY_TWO_AMOUNT_VALUE END,2)||'-'|| ROUND(CASE WHEN TTFXL.CCY_PAIR='JPY/KWD' THEN ((TTFXL.MARKET_SPOT_RATE-TTFXL.SPOT_MARGIN_POINTS)*100) ELSE TTFXL.MARKET_SPOT_RATE-TTFXL.SPOT_MARGIN_POINTS END,5)||'-'||
 ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_TWO_AMOUNT_VALUE ELSE TTFXL.CCY_ONE_AMOUNT_VALUE END,2)||'-'|| TTFXFL.VALUE_DATE_ONE
THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM FXDH F  
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(F.CUST)
LEFT JOIN TT_FXP_DEAL@FTMIG FIN_FX_OUTRIGHT ON  TRIM(F.DEALNO) = TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER) AND FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTMIG TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND PARENT_FBO_ID_VER='1' AND PARENT_FBO_MIN_VER='1'
LEFT JOIN (SELECT * FROM (
  SELECT * FROM  TT_FXP_LEG@FTMIG A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@FTMIG GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM)
  )) TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
left join (
  SELECT distinct a.PARENT_FBO_ID_NUM,a.PARENT_FBO_ID_TYPE,A.IQ_CURRENCY PAY_CCY,a.NAME pay_nos ,B.IQ_CURRENCY REC_CCY,b.NAME rec_nos  FROM (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT') A
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT') B ON A.PARENT_FBO_ID_TYPE = B.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM
  ) NOS on NOS.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM  
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND TRIM(PRODCODE)!='CCS' AND TRIM(REVDATE) IS NULL AND TRIM(SWAPDEAL)='0' AND  SPOTFWDIND='F'
AND TRIM(C.CMNE)!='CCIRS' AND TRIM(PORT)!='EQFX'




SELECT DISTINCT 
F.DEALNO OPICS_DEALNO ,FIN_FX_OUTRIGHT.DEAL_IDENTIFIER FIN_DEAL_IDENTIFIER, CASE WHEN TRIM(F.DEALNO) = FIN_FX_OUTRIGHT.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,TO_CHAR(FIN_FX_OUTRIGHT.DEAL_NUM) FIN_DEAL_NUM,
F.BR OPICS_BR, CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END MAPPED_ENTITY, SDENT.NAME FIN_ENTITY, CASE WHEN CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END =  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD') OPICS_DEAL_DATE ,FIN_FX_OUTRIGHT.DEAL_DATE FIN_DEAL_DATE,CASE WHEN TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD') = FIN_FX_OUTRIGHT.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
F.PORT OPICS_PORT,CASE WHEN TRIM(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN TRIM(PORT) IN('FXTR','PORT') THEN 'DEALER1' END MAPPED_TRADING_BOOK,SDTRBK.NAME FIN_TRADING_BOOK,CASE WHEN CASE WHEN TRIM(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN TRIM(PORT) IN('FXTR','PORT') THEN 'DEALER1' END = SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK,
CASE WHEN TRIM(PORT) = 'CORP' THEN 'CORP' WHEN TRIM(PORT) != 'CORP' THEN 'BANK' END MAPPED_SUBTYPE ,SDSBTY.NAME FIN_SUBTYPE,CASE WHEN CASE WHEN TRIM(PORT) = 'CORP' THEN 'CORP' WHEN TRIM(PORT) != 'CORP' THEN 'BANK' END = SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
TRIM(C.CMNE) OPICS_CPTY ,TRIM(SDCP.NAME) FIN_CPTY ,CASE WHEN TRIM(C.CMNE) = TRIM(SDCP.NAME)THEN 'TRUE' ELSE 'FALSE' END MATCH_CPTY,
CCYTERMS OPICS_CCYTERMS, CCY OPICS_CCY,CTRCCY OPICS_CTRCCY, CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END MAPPED_CCY_PAIR, TTFXL.CCY_PAIR  FIN_CCY_PAIR ,CASE WHEN CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END = TTFXL.CCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR ,
TRIM(DISAGGCCY) OPICS_DCO_CURRENCY,DCO_CURRENCY FIN_DCO_CURRENCY,CASE WHEN NVL(TRIM(DISAGGCCY),' ') =NVL(DCO_CURRENCY,' ')  THEN 'TRUE' ELSE 'FALSE' END MATCH_DCO_CURRENCY,
PS OPICS_PS,CASE WHEN PS='P' AND CCYTERMS='M' THEN 'BUY'     WHEN PS='S' AND CCYTERMS='M' THEN 'SELL'     WHEN PS='P' AND CCYTERMS='D' THEN 'SELL'     WHEN PS='S' AND CCYTERMS='D' THEN 'BUY'     END MAPPED_BUY_SELL,
CASE WHEN FX_BUY_SELL='S' THEN 'SELL' ELSE 'BUY' END FIN_BUY_SELL,CASE WHEN CASE WHEN PS='P' AND CCYTERMS='M' THEN 'BUY' WHEN PS='S' AND CCYTERMS='M' THEN 'SELL' WHEN PS='P' AND CCYTERMS='D' THEN 'SELL' WHEN PS='S' AND CCYTERMS='D' THEN 'BUY'     END = CASE WHEN FX_BUY_SELL='S' THEN 'SELL' ELSE 'BUY' END THEN 'TRUE' ELSE 'FALSE' END MATCH_BUY_SELL,
ABS(ROUND(F.CCYAMT,2)) OPICS_CCY_AMT,  ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_ONE_AMOUNT_VALUE ELSE TTFXL.CCY_TWO_AMOUNT_VALUE END,2) FIN_CCY_AMT,CASE WHEN ABS(ROUND(F.CCYAMT,2)) =  ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_ONE_AMOUNT_VALUE ELSE TTFXL.CCY_TWO_AMOUNT_VALUE END,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_AMT,
ABS(ROUND(F.CTRAMT,2)) OPICS_CTR_AMT,ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_TWO_AMOUNT_VALUE ELSE TTFXL.CCY_ONE_AMOUNT_VALUE END,2) FIN_CTR_AMT,CASE WHEN ABS(ROUND(F.CTRAMT,2)) = ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_TWO_AMOUNT_VALUE ELSE TTFXL.CCY_ONE_AMOUNT_VALUE END,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CTR_AMT,
ROUND(CCYRATE_8,5) MAPPED_RATE,ROUND(CASE WHEN TTFXL.CCY_PAIR='JPY/KWD' THEN ((MARKET_FWD_RATE+FWD_MARGIN_POINTS)) ELSE MARKET_FWD_RATE+FWD_MARGIN_POINTS END,5) FIN_RATE, CASE WHEN ROUND(CCYRATE_8,5) = ROUND(CASE WHEN TTFXL.CCY_PAIR='JPY/KWD' THEN ((MARKET_FWD_RATE+FWD_MARGIN_POINTS)) ELSE MARKET_FWD_RATE+FWD_MARGIN_POINTS END,5) THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE,
CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
END OPICS_PAY_NOSTRO,pay_nos FIN_PAY_NOSTRO,CASE WHEN trim(CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
END) = trim(pay_nos) THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_NOSTRO,
CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
END OPICS_REC_NOSTRO,rec_nos FIN_REC_NOSTRO,CASE WHEN   trim(CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
END) = trim(rec_nos) THEN 'TRUE' ELSE 'FALSE' END MATCH_REC_NOSTRO,
TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(F.DEALNO) ||'-'||CASE WHEN TRIM(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN TRIM(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||
CASE WHEN TRIM(PORT) = 'CORP' THEN 'CORP' WHEN TRIM(PORT) != 'CORP' THEN 'BANK' END||'-'||CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||
TRIM(C.CMNE)||'-'||CASE WHEN F.CCYTERMS='M' THEN F.CCY||'/'||F.CTRCCY ELSE F.CTRCCY||'/'||F.CCY END||'-'||ABS(ROUND(F.CCYAMT,2))||'-'||ROUND(CCYRATE_8,5)||'-'||ABS(ROUND(F.CTRAMT,2))||'-'||TO_DATE(TRIM(F.VDATE),'YYYY-MM-DD') CONV_OPICS_DATA, 
FIN_FX_OUTRIGHT.DEAL_DATE ||'-'||TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME ||'-'||TRIM(SDCP.NAME)||'-'||
TTFXL.CCY_PAIR ||'-'||ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_ONE_AMOUNT_VALUE ELSE TTFXL.CCY_TWO_AMOUNT_VALUE END,2)||'-'|| ROUND(CASE WHEN TTFXL.CCY_PAIR='JPY/KWD' THEN ((MARKET_FWD_RATE+FWD_MARGIN_POINTS)) ELSE MARKET_FWD_RATE+FWD_MARGIN_POINTS END,5)||'-'||
 ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_TWO_AMOUNT_VALUE ELSE TTFXL.CCY_ONE_AMOUNT_VALUE END,2)||'-'|| TTFXFL.VALUE_DATE_ONE FIN_DATA,
 CASE WHEN TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(F.DEALNO) ||'-'||CASE WHEN TRIM(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN TRIM(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||
CASE WHEN TRIM(PORT) = 'CORP' THEN 'CORP' WHEN TRIM(PORT) != 'CORP' THEN 'BANK' END||'-'||CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||
TRIM(C.CMNE)||'-'||CASE WHEN F.CCYTERMS='M' THEN F.CCY||'/'||F.CTRCCY ELSE F.CTRCCY||'/'||F.CCY END||'-'||ABS(ROUND(F.CCYAMT,2))||'-'||ROUND(CCYRATE_8,5)||'-'||ABS(ROUND(F.CTRAMT,2))||'-'||TO_DATE(TRIM(F.VDATE),'YYYY-MM-DD')
=
FIN_FX_OUTRIGHT.DEAL_DATE ||'-'||TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME ||'-'||TRIM(SDCP.NAME)||'-'||
TTFXL.CCY_PAIR ||'-'||ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_ONE_AMOUNT_VALUE ELSE TTFXL.CCY_TWO_AMOUNT_VALUE END,2)||'-'|| ROUND(CASE WHEN TTFXL.CCY_PAIR='JPY/KWD' THEN ((MARKET_FWD_RATE+FWD_MARGIN_POINTS)) ELSE MARKET_FWD_RATE+FWD_MARGIN_POINTS END,5)||'-'||
 ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_TWO_AMOUNT_VALUE ELSE TTFXL.CCY_ONE_AMOUNT_VALUE END,2)||'-'|| TTFXFL.VALUE_DATE_ONE
THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM FXDH F  
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(F.CUST)
LEFT JOIN TT_FXP_DEAL@FTMIG FIN_FX_OUTRIGHT ON   TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER) like TRIM(F.DEALNO)||'%' AND FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTMIG TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND PARENT_FBO_ID_VER='1' AND PARENT_FBO_MIN_VER='1'
LEFT JOIN (SELECT * FROM (
  SELECT * FROM  TT_FXP_LEG@FTMIG A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@FTMIG GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM)
  )) TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
left join (
  SELECT distinct a.PARENT_FBO_ID_NUM,a.PARENT_FBO_ID_TYPE,A.IQ_CURRENCY PAY_CCY,a.NAME pay_nos ,B.IQ_CURRENCY REC_CCY,b.NAME rec_nos  FROM (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT') A
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT') B ON A.PARENT_FBO_ID_TYPE = B.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM
  ) NOS on NOS.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM  
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND TRIM(PRODCODE)!='CCS' AND TRIM(REVDATE) IS NULL AND TRIM(SWAPDEAL)='0' AND  SPOTFWDIND='F'
AND TRIM(C.CMNE)!='CCIRS' AND TRIM(PORT)!='EQFX'


SELECT DISTINCT 
F.DEALNO OPICS_DEALNO ,FIN_FX_OUTRIGHT.DEAL_IDENTIFIER FIN_DEAL_IDENTIFIER, CASE WHEN TRIM(F.DEALNO) = FIN_FX_OUTRIGHT.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,TO_CHAR(FIN_FX_OUTRIGHT.DEAL_NUM) FIN_DEAL_NUM,
F.BR OPICS_BR, CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END MAPPED_ENTITY, SDENT.NAME FIN_ENTITY, CASE WHEN CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END =  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD') OPICS_DEAL_DATE ,FIN_FX_OUTRIGHT.DEAL_DATE FIN_DEAL_DATE,CASE WHEN TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD') = FIN_FX_OUTRIGHT.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
TO_DATE(VDATE,'YYYY-MM-DD') OPICS_END_DATE,TTFXL.VALUE_DATE_ONE FIN_END_DATE,CASE WHEN TO_DATE(TRIM(VDATE),'YYYY-MM-DD') =TTFXL.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
F.PORT OPICS_PORT,CASE WHEN TRIM(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN TRIM(PORT) IN('FXTR','PORT') THEN 'DEALER1' END MAPPED_TRADING_BOOK,SDTRBK.NAME FIN_TRADING_BOOK,CASE WHEN CASE WHEN TRIM(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN TRIM(PORT) IN('FXTR','PORT') THEN 'DEALER1' END = SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK,
CASE WHEN TRIM(PORT) = 'CORP' THEN 'CORP' WHEN TRIM(PORT) != 'CORP' THEN 'BANK' END MAPPED_SUBTYPE ,SDSBTY.NAME FIN_SUBTYPE,CASE WHEN CASE WHEN TRIM(PORT) = 'CORP' THEN 'CORP' WHEN TRIM(PORT) != 'CORP' THEN 'BANK' END = SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
TRIM(C.CMNE) OPICS_CPTY ,TRIM(SDCP.NAME) FIN_CPTY ,CASE WHEN TRIM(C.CMNE) = TRIM(SDCP.NAME)THEN 'TRUE' ELSE 'FALSE' END MATCH_CPTY,
CCYTERMS OPICS_CCYTERMS, CCY OPICS_CCY,CTRCCY OPICS_CTRCCY, CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END MAPPED_CCY_PAIR, TTFXL.CCY_PAIR  FIN_CCY_PAIR ,CASE WHEN CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END = TTFXL.CCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR ,
TRIM(DISAGGCCY) OPICS_DCO_CURRENCY,DCO_CURRENCY FIN_DCO_CURRENCY,CASE WHEN NVL(TRIM(DISAGGCCY),' ') =NVL(DCO_CURRENCY,' ')  THEN 'TRUE' ELSE 'FALSE' END MATCH_DCO_CURRENCY,
PS OPICS_PS,CASE WHEN PS='P' AND CCYTERMS='M' THEN 'BUY'     WHEN PS='S' AND CCYTERMS='M' THEN 'SELL'     WHEN PS='P' AND CCYTERMS='D' THEN 'SELL'     WHEN PS='S' AND CCYTERMS='D' THEN 'BUY'     END MAPPED_BUY_SELL,
CASE WHEN FX_BUY_SELL='S' THEN 'SELL' ELSE 'BUY' END FIN_BUY_SELL,CASE WHEN CASE WHEN PS='P' AND CCYTERMS='M' THEN 'BUY' WHEN PS='S' AND CCYTERMS='M' THEN 'SELL' WHEN PS='P' AND CCYTERMS='D' THEN 'SELL' WHEN PS='S' AND CCYTERMS='D' THEN 'BUY'     END = CASE WHEN FX_BUY_SELL='S' THEN 'SELL' ELSE 'BUY' END THEN 'TRUE' ELSE 'FALSE' END MATCH_BUY_SELL,
ABS(ROUND(F.CCYAMT,2)) OPICS_CCY_AMT,  ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_ONE_AMOUNT_VALUE ELSE TTFXL.CCY_TWO_AMOUNT_VALUE END,2) FIN_CCY_AMT,CASE WHEN ABS(ROUND(F.CCYAMT,2)) =  ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_ONE_AMOUNT_VALUE ELSE TTFXL.CCY_TWO_AMOUNT_VALUE END,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_AMT,
ABS(ROUND(F.CTRAMT,2)) OPICS_CTR_AMT,ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_TWO_AMOUNT_VALUE ELSE TTFXL.CCY_ONE_AMOUNT_VALUE END,2) FIN_CTR_AMT,CASE WHEN ABS(ROUND(F.CTRAMT,2)) = ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_TWO_AMOUNT_VALUE ELSE TTFXL.CCY_ONE_AMOUNT_VALUE END,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CTR_AMT,
ROUND(CCYRATE_8,5) MAPPED_RATE,ROUND(CASE WHEN TTFXL.CCY_PAIR='JPY/KWD' THEN ((MARKET_FWD_RATE+FWD_MARGIN_POINTS)) ELSE MARKET_FWD_RATE+FWD_MARGIN_POINTS END,5) FIN_RATE, CASE WHEN ROUND(CCYRATE_8,5) = ROUND(CASE WHEN TTFXL.CCY_PAIR='JPY/KWD' THEN ((MARKET_FWD_RATE+FWD_MARGIN_POINTS)) ELSE MARKET_FWD_RATE+FWD_MARGIN_POINTS END,5) THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE,
CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
END OPICS_PAY_NOSTRO,pay_nos FIN_PAY_NOSTRO,CASE WHEN trim(CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
END) = trim(pay_nos) THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_NOSTRO,
CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
END OPICS_REC_NOSTRO,rec_nos FIN_REC_NOSTRO,CASE WHEN   trim(CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
END) = trim(rec_nos) THEN 'TRUE' ELSE 'FALSE' END MATCH_REC_NOSTRO,
TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(F.DEALNO) ||'-'||CASE WHEN TRIM(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN TRIM(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||
CASE WHEN TRIM(PORT) = 'CORP' THEN 'CORP' WHEN TRIM(PORT) != 'CORP' THEN 'BANK' END||'-'||CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||
TRIM(C.CMNE)||'-'||CASE WHEN F.CCYTERMS='M' THEN F.CCY||'/'||F.CTRCCY ELSE F.CTRCCY||'/'||F.CCY END||'-'||ABS(ROUND(F.CCYAMT,2))||'-'||ROUND(CCYRATE_8,5)||'-'||ABS(ROUND(F.CTRAMT,2))||'-'||TO_DATE(TRIM(F.VDATE),'YYYY-MM-DD') CONV_OPICS_DATA, 
FIN_FX_OUTRIGHT.DEAL_DATE ||'-'||TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME ||'-'||TRIM(SDCP.NAME)||'-'||
TTFXL.CCY_PAIR ||'-'||ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_ONE_AMOUNT_VALUE ELSE TTFXL.CCY_TWO_AMOUNT_VALUE END,2)||'-'|| ROUND(CASE WHEN TTFXL.CCY_PAIR='JPY/KWD' THEN ((MARKET_FWD_RATE+FWD_MARGIN_POINTS)) ELSE MARKET_FWD_RATE+FWD_MARGIN_POINTS END,5)||'-'||
 ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_TWO_AMOUNT_VALUE ELSE TTFXL.CCY_ONE_AMOUNT_VALUE END,2)||'-'|| TTFXFL.VALUE_DATE_ONE FIN_DATA,
 CASE WHEN TO_DATE(TRIM(F.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(F.DEALNO) ||'-'||CASE WHEN TRIM(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN TRIM(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||
CASE WHEN TRIM(PORT) = 'CORP' THEN 'CORP' WHEN TRIM(PORT) != 'CORP' THEN 'BANK' END||'-'||CASE WHEN TRIM(F.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||
TRIM(C.CMNE)||'-'||CASE WHEN F.CCYTERMS='M' THEN F.CCY||'/'||F.CTRCCY ELSE F.CTRCCY||'/'||F.CCY END||'-'||ABS(ROUND(F.CCYAMT,2))||'-'||ROUND(CCYRATE_8,5)||'-'||ABS(ROUND(F.CTRAMT,2))||'-'||TO_DATE(TRIM(F.VDATE),'YYYY-MM-DD')
=
FIN_FX_OUTRIGHT.DEAL_DATE ||'-'||TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME ||'-'||TRIM(SDCP.NAME)||'-'||
TTFXL.CCY_PAIR ||'-'||ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_ONE_AMOUNT_VALUE ELSE TTFXL.CCY_TWO_AMOUNT_VALUE END,2)||'-'|| ROUND(CASE WHEN TTFXL.CCY_PAIR='JPY/KWD' THEN ((MARKET_FWD_RATE+FWD_MARGIN_POINTS)) ELSE MARKET_FWD_RATE+FWD_MARGIN_POINTS END,5)||'-'||
 ROUND(CASE WHEN F.CCYTERMS='M' THEN TTFXL.CCY_TWO_AMOUNT_VALUE ELSE TTFXL.CCY_ONE_AMOUNT_VALUE END,2)||'-'|| TTFXFL.VALUE_DATE_ONE
THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM FXDH F  
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(F.CUST)
LEFT JOIN TT_FXP_DEAL@FTMIG FIN_FX_OUTRIGHT ON   TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER) like TRIM(F.DEALNO)||'%' AND FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTMIG TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND PARENT_FBO_ID_VER='1' AND PARENT_FBO_MIN_VER='1'
LEFT JOIN (SELECT * FROM (
  SELECT * FROM  TT_FXP_LEG@FTMIG A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@FTMIG where PARENT_FBO_ID_VER='999999' and LEG_IDENTIFIER='MNLG' GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM)
  )) TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
left join (
  SELECT distinct a.PARENT_FBO_ID_NUM,a.PARENT_FBO_ID_TYPE,A.IQ_CURRENCY PAY_CCY,a.NAME pay_nos ,B.IQ_CURRENCY REC_CCY,b.NAME rec_nos  FROM (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT') A
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT') B ON A.PARENT_FBO_ID_TYPE = B.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM
  ) NOS on NOS.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM 
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND TRIM(PRODCODE)!='CCS' AND TRIM(REVDATE) IS NULL AND TRIM(SWAPDEAL)='0' AND  SPOTFWDIND='F'
AND TRIM(C.CMNE)!='CCIRS' AND TRIM(PORT)!='EQFX' 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
fx_spot_deals_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
fx_spot_deals_report.sql 
SELECT 
B.DEALDATE OPICS_DEALDATE,FIN_FX_SPOT.DEAL_DATE FINACLE_DEAL_DATE ,CASE WHEN TO_DATE(TRIM(B.DEALDATE),'YYYY-MM-DD') = FIN_FX_SPOT.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALDATE,
B.DEALNO OPICS_DEALNO, FIN_FX_SPOT.DEAL_IDENTIFIER FINACLE_DEAL_IDENTIFIER, CASE WHEN TRIM(B.DEALNO) = TRIM(FIN_FX_SPOT.DEAL_IDENTIFIER) THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
B.PORT OPICS_PORT,SDTRBK.NAME FINACLE_TRADING_BOOK, CASE WHEN CASE WHEN trim(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(PORT) IN('FXTR','PORT') THEN 'DEALER1' END = SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK, 
B.PORT OPICS_PORT,SDSBTY.NAME FINACLE_SUBTYPE, CASE WHEN CASE WHEN trim(PORT) = 'CORP' THEN 'CORP' WHEN trim(PORT) != 'CORP' THEN 'BANK' end = SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
B.BR OPICS_BR,SDENT.NAME FINACLE_ENTITY_NAME,CASE WHEN CASE WHEN TRIM(B.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END like  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY_NAME,--CASE WHEN CASE WHEN TRIM(B.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END = TRIM(SDENT.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY_NAME,
C.CMNE OPICS_CMNE,SDCP.NAME FINACLE_MAIN_LEG_CPTY,CASE WHEN TRIM(C.CMNE) = TRIM(SDCP.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_MAIN_LEG_CPTY,
B.CCYTERMS OPICS_CCYTERMS ,B.CCY OPICS_CCY,B.CTRCCY OPICS_CTRCCY,TTFXL.CCY_PAIR FINACLE_MAIN_LEG_CCY_PAIR,CASE when case when B.CCYTERMS='M' then B.CCY||'/'||B.CTRCCY else B.CTRCCY||'/'||B.CCY end = TTFXL.CCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR,
B.CCYTERMS OPICS_CCYTERMS,B.CCYAMT OPICS_CCYAMT,case when B.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end  FIN_MAIN_LEG_CCY_ONE_AMOUNT,
    CASE WHEN abs(round(B.CCYAMT,2)) = round(case when B.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_AMOUNT,
B.CCYRATE_8 OPICS_CCYRATE_8,TTFXFL.RATE FIN_MAIN_LEG_MARKET_FWD_RATE,CASE WHEN B.CCYRATE_8 = TTFXFL.RATE THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYRATE,
B.CCYTERMS OPICS_CCYTERMS,B.CTRAMT OPICS_CCYAMT,case when B.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end  FIN_MAIN_LEG_CCY_TWO_AMOUNT,
    CASE WHEN abs(round(B.CTRAMT,2)) = round(case when B.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CTR_AMOUNT,
B.VDATE,TTFXFL.VALUE_DATE_ONE FIN_MAIN_LEG_VALUE_DATE_ONE,CASE WHEN TO_DATE(TRIM(B.VDATE),'YYYY-MM-DD') = TTFXFL.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END FIN_MAIN_LEG_VALUE_DATE_ONE
FROM FXDH B 
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(B.CUST)
LEFT JOIN  TT_FXP_DEAL@ftuat FIN_FX_SPOT ON trim(B.DEALNO) = trim(FIN_FX_SPOT.DEAL_IDENTIFIER) AND FIN_FX_SPOT.DEAL_TYPE='FXPLSP' AND FIN_FX_SPOT.DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@ftuat SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_SPOT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftuat SDENT ON SDENT.FBO_ID_NUM = FIN_FX_SPOT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftuat SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_SPOT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftuat SDCP ON FIN_FX_SPOT.CPTY_FBO_ID_NUM=SDCP.FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@ftuat TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_SPOT.DEAL_NUM
LEFT JOIN (SELECT * FROM (
  SELECT * FROM  TT_FXP_LEG@ftuat A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@ftuat GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM)
  )) TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_SPOT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_SPOT.DEAL_TYPE
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY')
AND SPOTFWDIND='S' AND TRIM(SWAPDEAL)='0' AND TRIM(REVDATE) IS NULL 
AND TRIM(C.CMNE)!='CCIRS' and trim(port) !='EQFX'
;

SELECT 
B.DEALDATE||'-'|| B.DEALNO ||'-'||B.PORT  ||'-'||B.PORT||'-'||B.BR ||'-'||C.CMNE ||'-'||B.CCYTERMS||'-'||B.CCY ||'-'||B.CTRCCY||'-'||B.CCYAMT||'-'||ROUND(B.CCYRATE_8,2) ||'-'||B.CTRAMT||'-'||B.VDATE OPICS_DATA,
TO_DATE(TRIM(B.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(B.DEALNO)||'-'||CASE WHEN trim(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||CASE WHEN trim(PORT) = 'CORP' THEN 'CORP' WHEN trim(PORT) != 'CORP' THEN 'BANK' end ||'-'||
CASE WHEN TRIM(B.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END ||'-'||TRIM(C.CMNE) ||'-'||case when B.CCYTERMS='M' then B.CCY||'/'||B.CTRCCY else B.CTRCCY||'/'||B.CCY end||'-'||abs(round(B.CCYAMT,2))||'-'||round(B.CCYRATE_8,5)||'-'||
abs(round(B.CTRAMT,2))||'-'||TO_DATE(TRIM(B.VDATE),'YYYY-MM-DD') CONV_OPICS_DATA,
FIN_FX_SPOT.DEAL_DATE||'-'||TRIM(FIN_FX_SPOT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME||'-'||TRIM(SDCP.NAME) ||'-'||TTFXL.CCY_PAIR||'-'||round(case when B.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end,2)||'-'|| 
ROUND(TTFXFL.RATE,5)||'-'|| round(case when B.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end,2) ||'-'|| TTFXFL.VALUE_DATE_ONE FIN_DATA,
CASE WHEN TO_DATE(TRIM(B.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(B.DEALNO)||'-'||CASE WHEN trim(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||CASE WHEN trim(PORT) = 'CORP' THEN 'CORP' WHEN trim(PORT) != 'CORP' THEN 'BANK' end ||'-'||
CASE WHEN TRIM(B.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END ||'-'||TRIM(C.CMNE) ||'-'||case when B.CCYTERMS='M' then B.CCY||'/'||B.CTRCCY else B.CTRCCY||'/'||B.CCY end||'-'||abs(round(B.CCYAMT,2))||'-'||ROUND(B.CCYRATE_8,5)||'-'||
abs(round(B.CTRAMT,2))||'-'||TO_DATE(TRIM(B.VDATE),'YYYY-MM-DD')=
FIN_FX_SPOT.DEAL_DATE||'-'||TRIM(FIN_FX_SPOT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME||'-'||TRIM(SDCP.NAME) ||'-'||TTFXL.CCY_PAIR||'-'||round(case when B.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end,2)||'-'|| 
ROUND(TTFXFL.RATE,5)||'-'|| round(case when B.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end,2) ||'-'|| TTFXFL.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM FXDH B 
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(B.CUST)
LEFT JOIN  TT_FXP_DEAL@FTMIG FIN_FX_SPOT ON trim(B.DEALNO) = trim(FIN_FX_SPOT.DEAL_IDENTIFIER) AND FIN_FX_SPOT.DEAL_TYPE='FXPLSP' AND FIN_FX_SPOT.DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_SPOT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_FX_SPOT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_SPOT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON FIN_FX_SPOT.CPTY_FBO_ID_NUM=SDCP.FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTMIG TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_SPOT.DEAL_NUM and TTFXFL.PARENT_FBO_ID_VER='1'--NEED TO CHECK PARENT_FBO_ID_VER 
LEFT JOIN (SELECT * FROM (
  SELECT * FROM  TT_FXP_LEG@FTMIG A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@FTMIG GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM)
  )) TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_SPOT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_SPOT.DEAL_TYPE
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY')
AND SPOTFWDIND='S' AND TRIM(SWAPDEAL)='0' AND TRIM(REVDATE) IS NULL 
AND TRIM(C.CMNE)!='CCIRS' and trim(port) !='EQFX'
;


SELECT 
B.DEALNO ,FIN_FX_SPOT.DEAL_IDENTIFIER,CASE WHEN TRIM(B.DEALNO) = FIN_FX_SPOT.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
B.BR OPICS_BR, CASE WHEN TRIM(B.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END MAPPED_ENTITY, SDENT.NAME FIN_ENTITY, CASE WHEN CASE WHEN TRIM(B.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END =  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
TO_DATE(TRIM(B.DEALDATE),'YYYY-MM-DD') OPICS_DEAL_DATE ,FIN_FX_SPOT.DEAL_DATE FIN_DEAL_DATE,CASE WHEN TO_DATE(TRIM(B.DEALDATE),'YYYY-MM-DD') = FIN_FX_SPOT.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
TO_DATE(VDATE,'YYYY-MM-DD') OPICS_END_DATE,TTFXL.VALUE_DATE_ONE FIN_END_DATE,CASE WHEN TO_DATE(TRIM(VDATE),'YYYY-MM-DD') =TTFXL.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
B.PORT OPICS_PORT,CASE WHEN trim(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(PORT) IN('FXTR','PORT') THEN 'DEALER1' END MAPPED_TRADING_BOOK,SDTRBK.NAME FIN_TRADING_BOOK,CASE WHEN CASE WHEN trim(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(PORT) IN('FXTR','PORT') THEN 'DEALER1' END = SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK,
CASE WHEN trim(PORT) = 'CORP' THEN 'CORP' WHEN trim(PORT) != 'CORP' THEN 'BANK' end MAPPED_SUBTYPE ,SDSBTY.NAME FIN_SUBTYPE,CASE WHEN CASE WHEN trim(PORT) = 'CORP' THEN 'CORP' WHEN trim(PORT) != 'CORP' THEN 'BANK' end = SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
TRIM(C.CMNE) OPICS_CPTY ,TRIM(SDCP.name) FIN_CPTY ,CASE WHEN TRIM(C.CMNE) = TRIM(SDCP.name)THEN 'TRUE' ELSE 'FALSE' END MATCH_CPTY,
CCYTERMS OPICS_CCYTERMS, CCY OPICS_CCY,CTRCCY OPICS_CTRCCY, CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END MAPPED_CCY_PAIR, TTFXL.CCY_PAIR  FIN_CCY_PAIR ,CASE WHEN CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END = TTFXL.CCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR ,
PS OPICS_PS,CASE WHEN PS='P' AND CCYTERMS='M' THEN 'BUY'     WHEN PS='S' AND CCYTERMS='M' THEN 'SELL'     WHEN PS='P' AND CCYTERMS='D' THEN 'SELL'     WHEN PS='S' AND CCYTERMS='D' THEN 'BUY'     END MAPPED_BUY_SELL,
CASE WHEN FX_BUY_SELL='S' THEN 'SELL' ELSE 'BUY' END FIN_BUY_SELL,CASE WHEN CASE WHEN PS='P' AND CCYTERMS='M' THEN 'BUY' WHEN PS='S' AND CCYTERMS='M' THEN 'SELL' WHEN PS='P' AND CCYTERMS='D' THEN 'SELL' WHEN PS='S' AND CCYTERMS='D' THEN 'BUY'     END = CASE WHEN FX_BUY_SELL='S' THEN 'SELL' ELSE 'BUY' END THEN 'TRUE' ELSE 'FALSE' END MATCH_BUY_SELL,
abs(round(B.CCYAMT,2)) OPICS_CCY_AMT,  ROUND(case when B.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end,2) FIN_CCY_AMT,CASE WHEN abs(round(B.CCYAMT,2)) =  ROUND(case when B.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_AMT,
abs(round(B.CTRAMT,2)) OPICS_CTR_AMT,ROUND(case when B.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end,2) FIN_CTR_AMT,CASE WHEN abs(round(B.CTRAMT,2)) = ROUND(case when B.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CTR_AMT,
ROUND(CCYRATE_8,5) OPICS_RATE,ROUND(case when TTFXL.CCY_PAIR='JPY/KWD' THEN ((TTFXL.MARKET_SPOT_RATE+TTFXL.SPOT_MARGIN_POINTS)*100) ELSE TTFXL.MARKET_SPOT_RATE+TTFXL.SPOT_MARGIN_POINTS END,5) FIN_RATE, CASE WHEN ROUND(CCYRATE_8,5) = ROUND(case when TTFXL.CCY_PAIR='JPY/KWD' THEN ((TTFXL.MARKET_SPOT_RATE+TTFXL.SPOT_MARGIN_POINTS)*100) ELSE TTFXL.MARKET_SPOT_RATE+TTFXL.SPOT_MARGIN_POINTS END,5) THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE, 
CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
END OPICS_PAY_NOSTRO,pay_nos FIN_PAY_NOSTRO,CASE WHEN nvl(trim(CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
END),' ') = nvl(trim(pay_nos),' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_NOSTRO,
CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
END OPICS_REC_NOSTRO,rec_nos FIN_REC_NOSTRO,CASE WHEN   nvl(trim(CASE WHEN PS='P' AND CCYTERMS='M' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END  
     WHEN PS='S' AND CCYTERMS='M' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END
     WHEN PS='P' AND CCYTERMS='D' THEN CASE WHEN TRIM(CCYSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CCYSACCT  END 
     WHEN PS='S' AND CCYTERMS='D' THEN CASE WHEN TRIM(CTRSMEANS) in ('BRDGE','BRIDGE') THEN 'BRIDGE_'||TRIM(CTRCCY)||CASE WHEN TRIM(BR)='51' THEN '_ABKU' ELSE '_ABKK' END ELSE CTRSACCT END  
END),' ') = nvl(trim(rec_nos),' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_REC_NOSTRO,
TO_DATE(TRIM(B.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(B.DEALNO)||'-'||CASE WHEN trim(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||CASE WHEN trim(PORT) = 'CORP' THEN 'CORP' WHEN trim(PORT) != 'CORP' THEN 'BANK' end ||'-'||
CASE WHEN TRIM(B.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END ||'-'||TRIM(C.CMNE) ||'-'||case when B.CCYTERMS='M' then B.CCY||'/'||B.CTRCCY else B.CTRCCY||'/'||B.CCY end||'-'||abs(round(B.CCYAMT,2))||'-'||round(B.CCYRATE_8,5)||'-'||
abs(round(B.CTRAMT,2))||'-'||TO_DATE(TRIM(B.VDATE),'YYYY-MM-DD') CONV_OPICS_DATA,
FIN_FX_SPOT.DEAL_DATE||'-'||TRIM(FIN_FX_SPOT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME||'-'||TRIM(SDCP.NAME) ||'-'||TTFXL.CCY_PAIR||'-'||round(case when B.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end,2)||'-'|| 
ROUND(TTFXFL.RATE,5)||'-'|| round(case when B.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end,2) ||'-'|| TTFXFL.VALUE_DATE_ONE FIN_DATA,
CASE WHEN TO_DATE(TRIM(B.DEALDATE),'YYYY-MM-DD')||'-'||TRIM(B.DEALNO)||'-'||CASE WHEN trim(PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(PORT) IN('FXTR','PORT') THEN 'DEALER1' END||'-'||CASE WHEN trim(PORT) = 'CORP' THEN 'CORP' WHEN trim(PORT) != 'CORP' THEN 'BANK' end ||'-'||
CASE WHEN TRIM(B.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END ||'-'||TRIM(C.CMNE) ||'-'||case when B.CCYTERMS='M' then B.CCY||'/'||B.CTRCCY else B.CTRCCY||'/'||B.CCY end||'-'||abs(round(B.CCYAMT,2))||'-'||ROUND(B.CCYRATE_8,5)||'-'||
abs(round(B.CTRAMT,2))||'-'||TO_DATE(TRIM(B.VDATE),'YYYY-MM-DD')=
FIN_FX_SPOT.DEAL_DATE||'-'||TRIM(FIN_FX_SPOT.DEAL_IDENTIFIER)||'-'||SDTRBK.NAME||'-'||SDSBTY.NAME||'-'||SDENT.NAME||'-'||TRIM(SDCP.NAME) ||'-'||TTFXL.CCY_PAIR||'-'||round(case when B.CCYTERMS='M' then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end,2)||'-'|| 
ROUND(TTFXFL.RATE,5)||'-'|| round(case when B.CCYTERMS='M' then TTFXL.CCY_TWO_AMOUNT_VALUE else TTFXL.CCY_ONE_AMOUNT_VALUE end,2) ||'-'|| TTFXFL.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM FXDH B 
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(B.CUST)
LEFT JOIN  TT_FXP_DEAL@FTMIG FIN_FX_SPOT ON trim(B.DEALNO) = trim(FIN_FX_SPOT.DEAL_IDENTIFIER) AND FIN_FX_SPOT.DEAL_TYPE='FXPLSP' AND FIN_FX_SPOT.DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_SPOT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_FX_SPOT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_SPOT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON FIN_FX_SPOT.CPTY_FBO_ID_NUM=SDCP.FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTMIG TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_SPOT.DEAL_NUM and TTFXFL.PARENT_FBO_ID_VER='1'--NEED TO CHECK PARENT_FBO_ID_VER 
LEFT JOIN (SELECT * FROM (
  SELECT * FROM  TT_FXP_LEG@FTMIG A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@FTMIG GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM)
  )) TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_SPOT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_SPOT.DEAL_TYPE
 left join (
  SELECT distinct a.PARENT_FBO_ID_NUM,a.PARENT_FBO_ID_TYPE,A.IQ_CURRENCY PAY_CCY,a.NAME pay_nos ,B.IQ_CURRENCY REC_CCY,b.NAME rec_nos  FROM (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT') A
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT') B ON A.PARENT_FBO_ID_TYPE = B.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM
  ) NOS on NOS.PARENT_FBO_ID_NUM = FIN_FX_SPOT.DEAL_NUM  
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY')
AND SPOTFWDIND='S' AND TRIM(SWAPDEAL)='0' AND TRIM(REVDATE) IS NULL 
AND TRIM(C.CMNE)!='CCIRS' and trim(port) !='EQFX'
; 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
fx_swap_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
fx_swap_report.sql 

select distinct
A.DEALDATE OPICS_DEALDATE,fin_fx_swap.DEAL_DATE FINACLE_DEAL_DATE ,CASE WHEN TO_DATE(TRIM(A.DEALDATE),'YYYY-MM-DD') = fin_fx_swap.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALDATE,
a.DEALNO OPICS_DEALNO, fin_fx_swap.DEAL_IDENTIFIER FINACLE_DEAL_IDENTIFIER, CASE WHEN TRIM(a.DEALNO) = TRIM(fin_fx_swap.DEAL_IDENTIFIER) THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
A.PORT OPICS_PORT,SDTRBK.NAME FINACLE_TRADING_BOOK, CASE WHEN CASE WHEN trim(A.PORT) IN('MMBK','CORP','FXBK') THEN 'TREASURY' WHEN trim(A.PORT) IN('FXTR','PORT') THEN 'DEALER1' END = SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK, 
A.PORT OPICS_PORT,SDSBTY.NAME FINACLE_SUBTYPE, CASE WHEN CASE WHEN trim(A.PORT) = 'CORP' THEN 'CORP' WHEN trim(A.PORT) != 'CORP' THEN 'BANK' end = SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
A.BR OPICS_BR,SDENT.NAME FINACLE_ENTITY_NAME,CASE WHEN CASE WHEN TRIM(A.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END like  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY_NAME,
C.CMNE OPICS_CMNE,SDCP.name FINACLE_MAIN_LEG_CPTY,CASE WHEN TRIM(C.CMNE) = TRIM(SDCP.name) THEN 'TRUE' ELSE 'FALSE' END MATCH_MAIN_LEG_CPTY,
A.CCYTERMS OPICS_CCYTERMS ,A.CCY OPICS_CCY,A.CTRCCY OPICS_CTRCCY,TTFXL_NL.CCY_PAIR FINACLE_MAIN_LEG_CCY_PAIR,CASE when case when A.CCYTERMS='M' then A.CCY||'/'||A.CTRCCY else A.CTRCCY||'/'||A.CCY end = TTFXL_NL.CCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR,
A.CCYTERMS OPICS_CCYTERMS,A.CCYAMT OPICS_CCYAMT,case when A.CCYTERMS='M' then TTFXL_NL.CCY_ONE_AMOUNT_VALUE else TTFXL_NL.CCY_TWO_AMOUNT_VALUE end  FIN_MAIN_LEG_CCY_ONE_AMNT_NLEG,
    CASE WHEN abs(round(A.CCYAMT,2)) = round(case when A.CCYTERMS='M' then TTFXL_NL.CCY_ONE_AMOUNT_VALUE else TTFXL_NL.CCY_TWO_AMOUNT_VALUE end,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_AMOUNT_NLEG,
A.CCYRATE_8 OPICS_CCYRATE_8, TTFXL_NL.MARKET_SPOT_RATE FIN_MAIN_LEG_MARKET_FWD_RATE,CASE WHEN A.CCYRATE_8 =  TTFXL_NL.MARKET_SPOT_RATE THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYRATE,
A.CCYTERMS OPICS_CCYTERMS,A.CTRAMT OPICS_CCYAMT,case when A.CCYTERMS='M' then TTFXL_NL.CCY_TWO_AMOUNT_VALUE else TTFXL_NL.CCY_ONE_AMOUNT_VALUE end  FIN_MAIN_LEG_CCY_TWO_AMNT_NLEG,
    CASE WHEN abs(round(A.CTRAMT,2)) = round(case when A.CCYTERMS='M' then TTFXL_NL.CCY_TWO_AMOUNT_VALUE else TTFXL_NL.CCY_ONE_AMOUNT_VALUE end,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CTR_AMOUNT_NLEG,
A.VDATE OPICS_VDATE,TTFXL_NL.VALUE_DATE_ONE FINACLE_VALUE_DATE_ONE,CASE WHEN TO_DATE(A.VDATE,'YYYY-MM-DD') = TTFXL_NL.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END FIN_NEAR_LEG_VALUE_DATE_ONE,--A.VDATE,fin_fx_swap.NEAR_LEG_VALUE_DATE_ONE,--***
C.CMNE OPICS_CMNE,SDCP.name FINACLE_FAR_LEG_CPTY,CASE WHEN TRIM(C.CMNE) = TRIM(SDCP.name) THEN 'TRUE' ELSE 'FALSE' END MATCH_FAR_LEG_CPTY,--C.CMNE, fin_fx_swap.FAR_LEG_CPTY,--***
B.CCYTERMS OPICS_CCYTERMS,B.CCYAMT OPICS_CCYAMT,case when B.CCYTERMS='M' then TTFXL_NL.CCY_ONE_AMOUNT_VALUE else TTFXL_NL.CCY_TWO_AMOUNT_VALUE end  FIN_MAIN_LEG_CCY_ONE_AMNT_NLEG,
    CASE WHEN abs(round(B.CCYAMT,2)) = round(case when B.CCYTERMS='M' then TTFXL_NL.CCY_ONE_AMOUNT_VALUE else TTFXL_NL.CCY_TWO_AMOUNT_VALUE end,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_AMOUNT_NLEG,
--B.CCYRATE_8 OPICS_CCYRATE_8,TTFXL_FL.MARKET_SPOT_RATE FIN_MAIN_LEG_MARKET_FWD_RATE,CASE WHEN B.CCYRATE_8 = TTFXL_FL.MARKET_SPOT_RATE THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYRATE,
B.CCYTERMS OPICS_CCYTERMS,B.CTRAMT OPICS_CCYAMT,case when B.CCYTERMS='M' then TTFXL_NL.CCY_TWO_AMOUNT_VALUE else TTFXL_NL.CCY_ONE_AMOUNT_VALUE end  FIN_MAIN_LEG_CCY_TWO_AMNT_NLEG,
    CASE WHEN abs(round(B.CTRAMT,2)) = round(case when B.CCYTERMS='M' then TTFXL_NL.CCY_TWO_AMOUNT_VALUE else TTFXL_NL.CCY_ONE_AMOUNT_VALUE end,2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CTR_AMOUNT_NLEG,
B.VDATE,TTFXL_FL.VALUE_DATE_ONE FINACLE_VALUE_DATE_ONE,CASE WHEN TO_DATE(TRIM(B.VDATE),'YYYY-MM-DD') = TTFXL_FL.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END FIN_FAR_LEG_VALUE_DATE_ONE
from FXDH A 
INNER JOIN CUST C ON TRIM(A.CUST)=TRIM(C.CNO)
INNER JOIN FXDH B ON A.SWAPDEAL=B.DEALNO AND B.FARNEARIND='F' AND TO_DATE(B.VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY')  AND A.BR=B.BR
LEFT JOIN TT_FXP_DEAL@ftuat fin_fx_swap on TRIM(A.DEALNO) = TRIM(fin_fx_swap.DEAL_IDENTIFIER) AND  DEAL_TYPE='FXPLSW' AND fin_fx_swap.DEAL_STATE!='DLTD' 
LEFT JOIN SD_TRADING_BOOK@ftuat SDTRBK ON SDTRBK.FBO_ID_NUM = fin_fx_swap.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftuat SDENT ON SDENT.FBO_ID_NUM = fin_fx_swap.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftuat SDSBTY ON SDSBTY.FBO_ID_NUM = fin_fx_swap.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftuat SDCP ON SDCP.FBO_ID_NUM= fin_fx_swap.CPTY_FBO_ID_NUM
--LEFT JOIN TT_FXP_FLOW@ftuat TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM  AND TTFXFL.FXP_FLOW_REFERENCE = '1'
LEFT JOIN (SELECT * FROM (SELECT * FROM  TT_FXP_LEG@ftuat A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@ftuat GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM AND LEG_IDENTIFIER='NELG'))) TTFXL_NL ON  TTFXL_NL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXL_NL.PARENT_FBO_ID_TYPE = fin_fx_swap.DEAL_TYPE
LEFT JOIN (SELECT * FROM (SELECT * FROM  TT_FXP_LEG@ftuat A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@ftuat GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM AND LEG_IDENTIFIER='FALG'))) TTFXL_FL ON  TTFXL_FL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXL_FL.PARENT_FBO_ID_TYPE = fin_fx_swap.DEAL_TYPE
AND TO_DATE(TRIM(B.VDATE),'YYYY-MM-DD') = TTFXL_FL.VALUE_DATE_ONE 
WHERE  A.SWAPDEAL>0 AND TRIM(A.REVDATE) IS NULL and A.PRODCODE!='CCS' AND TRIM(C.CMNE)!='CCIRS' AND TRIM(A.PORT)!='EQFX' AND TRIM(B.PORT)!='EQFX'





select 
TRIM(OP_SW.DEAL_IDENTIFIER)||'-'||TO_DATE(OP_SW.DEAL_DATE,'DD-MON-YYYY')||'-'||OP_SW.SUBTYPE||'-'||OP_SW.ENTITY_NAME||'-'||OP_SW.NEAR_LEG_CCY_PAIR||'-'||TRIM(OP_SW.NEAR_LEG_CPTY)||'-'||TRIM(ROUND(NEAR_LEG_CCY_ONE_AMOUNT,0))||'-'||
ROUND(TRIM(NEAR_LEG_MARKET_SPOT_RATE),3)||'-'||TRIM(ROUND(NEAR_LEG_CCY_TWO_AMOUNT,0))||'-'||TO_DATE(NEAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY')||'-'||TRIM(ROUND(FAR_LEG_CCY_ONE_AMOUNT,0))||'-'||ROUND(TRIM(FAR_LEG_MARKET_FWD_RATE),3)||'-'||
TRIM(ROUND(FAR_LEG_CCY_TWO_AMOUNT,0))||'-'||TO_DATE(FAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY') opics_data,
fin_fx_swap.DEAL_IDENTIFIER||'-'||fin_fx_swap.DEAL_DATE||'-'||SDSBTY.NAME||'-'||SDENT.NAME||'-'||TTFXL_NL.CCY_PAIR||'-'||trim(SDCP.name) ||'-'||ROUND(TTFXL_NL.CCY_ONE_AMOUNT_VALUE,0)||'-'||ROUND(TTFXL_NL.MARKET_SPOT_RATE,3)||'-'||
ROUND(TTFXL_NL.CCY_TWO_AMOUNT_VALUE,0)||'-'||TTFXL_NL.VALUE_DATE_ONE||'-'||ROUND(TTFXL_FL.CCY_ONE_AMOUNT_VALUE,0)||'-'||ROUND(TTFXL_FL.MARKET_FWD_RATE,3)||'-'||
ROUND(TTFXL_FL.CCY_TWO_AMOUNT_VALUE,0)||'-'||TTFXL_FL.VALUE_DATE_ONE fin_data,
CASE WHEN TRIM(OP_SW.DEAL_IDENTIFIER)||'-'||TO_DATE(OP_SW.DEAL_DATE,'DD-MON-YYYY')||'-'||OP_SW.SUBTYPE||'-'||OP_SW.ENTITY_NAME||'-'||OP_SW.NEAR_LEG_CCY_PAIR||'-'||TRIM(OP_SW.NEAR_LEG_CPTY)||'-'||TRIM(ROUND(NEAR_LEG_CCY_ONE_AMOUNT,0))||'-'||
ROUND(TRIM(NEAR_LEG_MARKET_SPOT_RATE),3)||'-'||TRIM(ROUND(NEAR_LEG_CCY_TWO_AMOUNT,0))||'-'||TO_DATE(NEAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY')||'-'||TRIM(ROUND(FAR_LEG_CCY_ONE_AMOUNT,0))||'-'||ROUND(TRIM(FAR_LEG_MARKET_FWD_RATE),3)||'-'||
TRIM(ROUND(FAR_LEG_CCY_TWO_AMOUNT,0))||'-'||TO_DATE(FAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY') = 
fin_fx_swap.DEAL_IDENTIFIER||'-'||fin_fx_swap.DEAL_DATE||'-'||SDSBTY.NAME||'-'||SDENT.NAME||'-'||TTFXL_NL.CCY_PAIR||'-'||trim(SDCP.name) ||'-'||ROUND(TTFXL_NL.CCY_ONE_AMOUNT_VALUE,0)||'-'||ROUND(TTFXL_NL.MARKET_SPOT_RATE,3)||'-'||
ROUND(TTFXL_NL.CCY_TWO_AMOUNT_VALUE,0)||'-'||TTFXL_NL.VALUE_DATE_ONE||'-'||ROUND(TTFXL_FL.CCY_ONE_AMOUNT_VALUE,0)||'-'||ROUND(TTFXL_FL.MARKET_FWD_RATE,3)||'-'||
ROUND(TTFXL_FL.CCY_TWO_AMOUNT_VALUE,0)||'-'||TTFXL_FL.VALUE_DATE_ONE
THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
from FX_SWAP_O_TABLE OP_SW
LEFT JOIN TT_FXP_DEAL@ftmig fin_fx_swap on TRIM(OP_SW.DEAL_IDENTIFIER) = TRIM(fin_fx_swap.DEAL_IDENTIFIER) AND  DEAL_TYPE='FXPLSW' AND fin_fx_swap.DEAL_STATE!='DLTD' 
LEFT JOIN SD_TRADING_BOOK@ftmig SDTRBK ON SDTRBK.FBO_ID_NUM = fin_fx_swap.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftmig SDENT ON SDENT.FBO_ID_NUM = fin_fx_swap.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftmig SDSBTY ON SDSBTY.FBO_ID_NUM = fin_fx_swap.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftmig SDCP ON SDCP.FBO_ID_NUM= fin_fx_swap.CPTY_FBO_ID_NUM
--LEFT JOIN TT_FXP_FLOW@ftmig TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM  AND TTFXFL.FXP_FLOW_REFERENCE = '1'
LEFT JOIN (SELECT * FROM (SELECT * FROM  TT_FXP_LEG@ftmig A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@ftmig GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM AND LEG_IDENTIFIER='NELG'))) TTFXL_NL ON  TTFXL_NL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXL_NL.PARENT_FBO_ID_TYPE = fin_fx_swap.DEAL_TYPE
LEFT JOIN (SELECT * FROM (SELECT * FROM  TT_FXP_LEG@ftmig A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@ftmig GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM AND LEG_IDENTIFIER='FALG'))) TTFXL_FL ON  TTFXL_FL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXL_FL.PARENT_FBO_ID_TYPE = fin_fx_swap.DEAL_TYPE
  
  
  
select 
TRIM(OP_SW.DEAL_IDENTIFIER) OPICS_DEALNO ,fin_fx_swap.DEAL_IDENTIFIER FIN_DEAL_IDENTIFIER,CASE WHEN TRIM(OP_SW.DEAL_IDENTIFIER) = fin_fx_swap.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
ENTITY_NAME MAPPED_ENTITY, SDENT.NAME FIN_ENTITY, CASE WHEN ENTITY_NAME =  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
SUBSTR(TRADING_BOOK,INSTR(TRADING_BOOK,'/',1,4)+1) MAPPED_TRADING_BOOK,SDTRBK.NAME FIN_TRADING_BOOK,CASE WHEN SUBSTR(TRADING_BOOK,INSTR(TRADING_BOOK,'/',1,4)+1) = SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK,
SUBTYPE MAPPED_SUBTYPE ,SDSBTY.NAME FIN_SUBTYPE,CASE WHEN SUBTYPE = SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
TO_DATE(OP_SW.DEAL_DATE,'DD-MON-YYYY') OPICS_DEAL_DATE ,fin_fx_swap.DEAL_DATE FIN_DEAL_DATE,CASE WHEN TO_DATE(OP_SW.DEAL_DATE,'DD-MON-YYYY') = fin_fx_swap.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
NEAR_LEG_CCY_PAIR MAPPED_CCY_PAIR ,TTFXL_NL.CCY_PAIR FIN_CCY_PAIR,CASE WHEN NEAR_LEG_CCY_PAIR = TTFXL_NL.CCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR,
NEAR_LEG_CPTY OPICS_NEAR_LEG_CPTY ,TRIM(SDCP.name) FIN_NEAR_LEG_CPTY ,CASE WHEN NEAR_LEG_CPTY = TRIM(SDCP.name)THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_LEG_CPTY,
TRIM(ROUND(NEAR_LEG_CCY_ONE_AMOUNT,0)) OPICS_NEAR_LEG_CCY_ONE_AMOUNT ,ROUND(TTFXL_NL.CCY_ONE_AMOUNT_VALUE,0) FIN_NEAR_LEG_CCY_ONE_AMOUNT,CASE WHEN TRIM(ROUND(NEAR_LEG_CCY_ONE_AMOUNT,0)) = ROUND(TTFXL_NL.CCY_ONE_AMOUNT_VALUE,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_LEG_CCY_ONE_AMOUNT,
ROUND(TRIM(NEAR_LEG_MARKET_SPOT_RATE),3) OPICS_NEAR_LEG_MAK_SPOT_RATE ,ROUND(TTFXL_NL.MARKET_SPOT_RATE,3) FIN_NEAR_LEG_MAK_SPOT_RATE,CASE WHEN ROUND(TRIM(NEAR_LEG_MARKET_SPOT_RATE),3) = ROUND(TTFXL_NL.MARKET_SPOT_RATE,3) THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_LEG_MAK_SPOT_RATE,
TRIM(ROUND(NEAR_LEG_CCY_TWO_AMOUNT,0)) OPICS_NEAR_LEG_CCY_TWO_AMOUNT ,ROUND(TTFXL_NL.CCY_TWO_AMOUNT_VALUE,0) FIN_NEAR_LEG_CCY_TWO_AMOUNT,CASE WHEN TRIM(ROUND(NEAR_LEG_CCY_TWO_AMOUNT,0)) = ROUND(TTFXL_NL.CCY_TWO_AMOUNT_VALUE,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_LEG_CCY_TWO_AMOUNT,
TRIM(ROUND(FAR_LEG_CCY_ONE_AMOUNT,0)) OPICS_FAR_LEG_CCY_ONE_AMOUNT,ROUND(TTFXL_FL.CCY_ONE_AMOUNT_VALUE,0) FIN_FAR_LEG_CCY_ONE_AMOUNT,CASE WHEN TRIM(ROUND(FAR_LEG_CCY_ONE_AMOUNT,0)) = ROUND(TTFXL_FL.CCY_ONE_AMOUNT_VALUE,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_FAR_LEG_CCY_ONE_AMOUNT,
ROUND(TRIM(FAR_LEG_MARKET_FWD_RATE),3) OPICS_FAR_LEG_MAK_FWD_RATE ,ROUND(TTFXL_FL.MARKET_SPOT_RATE,3) FIN_FAR_LEG_MAK_FWD_RATE,CASE WHEN ROUND(TRIM(FAR_LEG_MARKET_FWD_RATE),3) = ROUND(TTFXL_FL.MARKET_SPOT_RATE,3) THEN 'TRUE' ELSE 'FALSE' END MATCH_FAR_LEG_MAK_FWD_RATE,
TRIM(ROUND(FAR_LEG_CCY_TWO_AMOUNT,0)) OPICS_FAR_LEG_CCY_TWO_AMOUNT,ROUND(TTFXL_FL.CCY_TWO_AMOUNT_VALUE,0) FIN_FAR_LEG_CCY_TWO_AMOUNT,CASE WHEN TRIM(ROUND(FAR_LEG_CCY_TWO_AMOUNT,0)) = ROUND(TTFXL_FL.CCY_TWO_AMOUNT_VALUE,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_FAR_LEG_CCY_TWO_AMOUNT,
TO_DATE(OP_SW.NEAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY')  OPICS_NEAR_VALUE_DATE,TTFXL_NL.VALUE_DATE_ONE FIN_NEAR_VALUE_DATE ,CASE WHEN TO_DATE(OP_SW.NEAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY')  = TTFXL_NL.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_VALUE_DATE,
SI_FLOW_PAY_NOSTRO OPICS_NEAR_PAY_NOSTRO,NEAR_pay_nos FIN_NEAR_PAY_NOSTRO, CASE WHEN nvl(TRIM(SI_FLOW_PAY_NOSTRO),' ') =nvl(TRIM(NEAR_pay_nos),' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_PAY_NOSTRO ,
SI_FLOW_REC_NOSTRO OPICS_NEAR_REC_NOSTRO,NEAR_REC_nos FIN_NEAR_REC_NOSTRO ,CASE WHEN nvl(TRIM(SI_FLOW_REC_NOSTRO),' ') = nvl(TRIM(NEAR_REC_nos),' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_REC_NOSTRO ,
SI_FLOW_FAR_PAY_NOSTRO OPICS_FAR_PAY_NOSTRO,FAR_pay_nos FIN_FAR_PAY_NOSTRO,CASE WHEN nvl(TRIM(SI_FLOW_FAR_PAY_NOSTRO),' ') = nvl(TRIM(FAR_pay_nos),' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_FAR_PAY_NOSTRO ,
SI_FLOW_FAR_REC_NOSTRO OPICS_FAR_REC_NOSTRO,FAR_REC_NOS FIN_FAR_REC_NOSTRO,CASE WHEN nvl(TRIM(SI_FLOW_FAR_REC_NOSTRO),' ') = nvl(TRIM(FAR_REC_NOS),' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_FAR_REC_NOSTRO ,
TRIM(OP_SW.DEAL_IDENTIFIER)||'-'||TO_DATE(OP_SW.DEAL_DATE,'DD-MON-YYYY')||'-'||OP_SW.SUBTYPE||'-'||OP_SW.ENTITY_NAME||'-'||OP_SW.NEAR_LEG_CCY_PAIR||'-'||TRIM(OP_SW.NEAR_LEG_CPTY)||'-'||TRIM(ROUND(NEAR_LEG_CCY_ONE_AMOUNT,0))||'-'||
ROUND(TRIM(NEAR_LEG_MARKET_SPOT_RATE),3)||'-'||TRIM(ROUND(NEAR_LEG_CCY_TWO_AMOUNT,0))||'-'||TO_DATE(NEAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY')||'-'||TRIM(ROUND(FAR_LEG_CCY_ONE_AMOUNT,0))||'-'||ROUND(TRIM(FAR_LEG_MARKET_FWD_RATE),3)||'-'||
TRIM(ROUND(FAR_LEG_CCY_TWO_AMOUNT,0))||'-'||TO_DATE(FAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY') opics_data,
fin_fx_swap.DEAL_IDENTIFIER||'-'||fin_fx_swap.DEAL_DATE||'-'||SDSBTY.NAME||'-'||SDENT.NAME||'-'||TTFXL_NL.CCY_PAIR||'-'||trim(SDCP.name) ||'-'||ROUND(TTFXL_NL.CCY_ONE_AMOUNT_VALUE,0)||'-'||ROUND(TTFXL_NL.MARKET_SPOT_RATE,3)||'-'||
ROUND(TTFXL_NL.CCY_TWO_AMOUNT_VALUE,0)||'-'||TTFXL_NL.VALUE_DATE_ONE||'-'||ROUND(TTFXL_FL.CCY_ONE_AMOUNT_VALUE,0)||'-'||ROUND(TTFXL_FL.MARKET_FWD_RATE,3)||'-'||
ROUND(TTFXL_FL.CCY_TWO_AMOUNT_VALUE,0)||'-'||TTFXL_FL.VALUE_DATE_ONE fin_data,
CASE WHEN TRIM(OP_SW.DEAL_IDENTIFIER)||'-'||TO_DATE(OP_SW.DEAL_DATE,'DD-MON-YYYY')||'-'||OP_SW.SUBTYPE||'-'||OP_SW.ENTITY_NAME||'-'||OP_SW.NEAR_LEG_CCY_PAIR||'-'||TRIM(OP_SW.NEAR_LEG_CPTY)||'-'||TRIM(ROUND(NEAR_LEG_CCY_ONE_AMOUNT,0))||'-'||
ROUND(TRIM(NEAR_LEG_MARKET_SPOT_RATE),3)||'-'||TRIM(ROUND(NEAR_LEG_CCY_TWO_AMOUNT,0))||'-'||TO_DATE(NEAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY')||'-'||TRIM(ROUND(FAR_LEG_CCY_ONE_AMOUNT,0))||'-'||ROUND(TRIM(FAR_LEG_MARKET_FWD_RATE),3)||'-'||
TRIM(ROUND(FAR_LEG_CCY_TWO_AMOUNT,0))||'-'||TO_DATE(FAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY') = 
fin_fx_swap.DEAL_IDENTIFIER||'-'||fin_fx_swap.DEAL_DATE||'-'||SDSBTY.NAME||'-'||SDENT.NAME||'-'||TTFXL_NL.CCY_PAIR||'-'||trim(SDCP.name) ||'-'||ROUND(TTFXL_NL.CCY_ONE_AMOUNT_VALUE,0)||'-'||ROUND(TTFXL_NL.MARKET_SPOT_RATE,3)||'-'||
ROUND(TTFXL_NL.CCY_TWO_AMOUNT_VALUE,0)||'-'||TTFXL_NL.VALUE_DATE_ONE||'-'||ROUND(TTFXL_FL.CCY_ONE_AMOUNT_VALUE,0)||'-'||ROUND(TTFXL_FL.MARKET_FWD_RATE,3)||'-'||
ROUND(TTFXL_FL.CCY_TWO_AMOUNT_VALUE,0)||'-'||TTFXL_FL.VALUE_DATE_ONE
THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
from FX_SWAP_O_TABLE OP_SW
LEFT JOIN TT_FXP_DEAL@ftmig fin_fx_swap on TRIM(OP_SW.DEAL_IDENTIFIER) = TRIM(fin_fx_swap.DEAL_IDENTIFIER) AND  DEAL_TYPE='FXPLSW' AND fin_fx_swap.DEAL_STATE!='DLTD' 
LEFT JOIN SD_TRADING_BOOK@ftmig SDTRBK ON SDTRBK.FBO_ID_NUM = fin_fx_swap.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftmig SDENT ON SDENT.FBO_ID_NUM = fin_fx_swap.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftmig SDSBTY ON SDSBTY.FBO_ID_NUM = fin_fx_swap.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftmig SDCP ON SDCP.FBO_ID_NUM= fin_fx_swap.CPTY_FBO_ID_NUM
--LEFT JOIN TT_FXP_FLOW@ftmig TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM  AND TTFXFL.FXP_FLOW_REFERENCE = '1'
LEFT JOIN (SELECT * FROM (SELECT * FROM  TT_FXP_LEG@ftmig A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@ftmig GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM AND LEG_IDENTIFIER='NELG'))) TTFXL_NL ON  TTFXL_NL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXL_NL.PARENT_FBO_ID_TYPE = fin_fx_swap.DEAL_TYPE
LEFT JOIN (SELECT * FROM (SELECT * FROM  TT_FXP_LEG@ftmig A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@ftmig GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM AND LEG_IDENTIFIER='FALG'))) TTFXL_FL ON  TTFXL_FL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXL_FL.PARENT_FBO_ID_TYPE = fin_fx_swap.DEAL_TYPE
  LEFT JOIN(SELECT distinct a.PARENT_FBO_ID_NUM,a.PARENT_FBO_ID_TYPE,A.IQ_CURRENCY NEAR_PAY_CCY,a.NAME NEAR_pay_nos ,B.IQ_CURRENCY NEAR_REC_CCY,b.NAME NEAR_rec_nos,C.IQ_CURRENCY FAR_PAY_CCY,C.NAME FAR_pay_nos ,D.IQ_CURRENCY FAR_REC_CCY,D.NAME FAR_rec_nos  FROM (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT' AND PARENT_FBO_ID_VER='999999' AND SIDE_REFERENCE='1') A
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT' AND PARENT_FBO_ID_VER='999999' AND SIDE_REFERENCE='1') B ON A.PARENT_FBO_ID_TYPE = B.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM
   LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT' AND PARENT_FBO_ID_VER='999999' AND SIDE_REFERENCE='2') C ON A.PARENT_FBO_ID_TYPE = C.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = C.PARENT_FBO_ID_NUM
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT' AND PARENT_FBO_ID_VER='999999' AND SIDE_REFERENCE='2') D ON A.PARENT_FBO_ID_TYPE = D.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = D.PARENT_FBO_ID_NUM
  ) NOS ON NOS.PARENT_FBO_ID_NUM =fin_fx_swap.DEAL_NUM  AND NOS.PARENT_FBO_ID_TYPE =fin_fx_swap.DEAL_TYPE
  
   select 
TRIM(OP_SW.DEAL_IDENTIFIER) OPICS_DEALNO ,fin_fx_swap.DEAL_IDENTIFIER FIN_DEAL_IDENTIFIER,CASE WHEN TRIM(OP_SW.DEAL_IDENTIFIER) = fin_fx_swap.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
ENTITY_NAME MAPPED_ENTITY, SDENT.NAME FIN_ENTITY, CASE WHEN ENTITY_NAME =  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
SUBSTR(TRADING_BOOK,INSTR(TRADING_BOOK,'/',1,4)+1) MAPPED_TRADING_BOOK,SDTRBK.NAME FIN_TRADING_BOOK,CASE WHEN SUBSTR(TRADING_BOOK,INSTR(TRADING_BOOK,'/',1,4)+1) = SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK,
SUBTYPE MAPPED_SUBTYPE ,SDSBTY.NAME FIN_SUBTYPE,CASE WHEN SUBTYPE = SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
TO_DATE(OP_SW.DEAL_DATE,'DD-MON-YYYY') OPICS_DEAL_DATE ,fin_fx_swap.DEAL_DATE FIN_DEAL_DATE,CASE WHEN TO_DATE(OP_SW.DEAL_DATE,'DD-MON-YYYY') = fin_fx_swap.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
NEAR_LEG_CCY_PAIR MAPPED_CCY_PAIR ,TTFXL_NL.CCY_PAIR FIN_CCY_PAIR,CASE WHEN NEAR_LEG_CCY_PAIR = TTFXL_NL.CCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR,
NEAR_LEG_CPTY OPICS_NEAR_LEG_CPTY ,TRIM(SDCP.name) FIN_NEAR_LEG_CPTY ,CASE WHEN NEAR_LEG_CPTY = TRIM(SDCP.name)THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_LEG_CPTY,
TRIM(ROUND(NEAR_LEG_CCY_ONE_AMOUNT,0)) OPICS_NEAR_LEG_CCY_ONE_AMOUNT ,ROUND(TTFXL_NL.CCY_ONE_AMOUNT_VALUE,0) FIN_NEAR_LEG_CCY_ONE_AMOUNT,CASE WHEN TRIM(ROUND(NEAR_LEG_CCY_ONE_AMOUNT,0)) = ROUND(TTFXL_NL.CCY_ONE_AMOUNT_VALUE,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_LEG_CCY_ONE_AMOUNT,
ROUND(TRIM(NEAR_LEG_MARKET_SPOT_RATE),4) OPICS_NEAR_LEG_MAK_SPOT_RATE ,ROUND(TTFXL_NL.MARKET_SPOT_RATE,4) FIN_NEAR_LEG_MAK_SPOT_RATE,CASE WHEN ROUND(TRIM(NEAR_LEG_MARKET_SPOT_RATE),4) = ROUND(TTFXL_NL.MARKET_SPOT_RATE,4) THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_LEG_MAK_SPOT_RATE,
TRIM(ROUND(NEAR_LEG_CCY_TWO_AMOUNT,0)) OPICS_NEAR_LEG_CCY_TWO_AMOUNT ,ROUND(TTFXL_NL.CCY_TWO_AMOUNT_VALUE,0) FIN_NEAR_LEG_CCY_TWO_AMOUNT,CASE WHEN TRIM(ROUND(NEAR_LEG_CCY_TWO_AMOUNT,0)) = ROUND(TTFXL_NL.CCY_TWO_AMOUNT_VALUE,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_LEG_CCY_TWO_AMOUNT,
TRIM(ROUND(FAR_LEG_CCY_ONE_AMOUNT,0)) OPICS_FAR_LEG_CCY_ONE_AMOUNT,ROUND(TTFXL_FL.CCY_ONE_AMOUNT_VALUE,0) FIN_FAR_LEG_CCY_ONE_AMOUNT,CASE WHEN TRIM(ROUND(FAR_LEG_CCY_ONE_AMOUNT,0)) = ROUND(TTFXL_FL.CCY_ONE_AMOUNT_VALUE,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_FAR_LEG_CCY_ONE_AMOUNT,
ROUND(TRIM(FAR_LEG_MARKET_FWD_RATE),4) OPICS_FAR_LEG_MAK_FWD_RATE ,ROUND(TTFXL_FL.MARKET_FWD_RATE+TTFXL_FL.FWD_MARGIN_POINTS,4) FIN_FAR_LEG_MAK_FWD_RATE,CASE WHEN ROUND(TRIM(FAR_LEG_MARKET_FWD_RATE),4) = ROUND(TTFXL_FL.MARKET_FWD_RATE+TTFXL_FL.FWD_MARGIN_POINTS,4) THEN 'TRUE' ELSE 'FALSE' END MATCH_FAR_LEG_MAK_FWD_RATE,
TRIM(ROUND(FAR_LEG_CCY_TWO_AMOUNT,0)) OPICS_FAR_LEG_CCY_TWO_AMOUNT,ROUND(TTFXL_FL.CCY_TWO_AMOUNT_VALUE,0) FIN_FAR_LEG_CCY_TWO_AMOUNT,CASE WHEN TRIM(ROUND(FAR_LEG_CCY_TWO_AMOUNT,0)) = ROUND(TTFXL_FL.CCY_TWO_AMOUNT_VALUE,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_FAR_LEG_CCY_TWO_AMOUNT,
TO_DATE(OP_SW.NEAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY')  OPICS_NEAR_VALUE_DATE,TTFXL_NL.VALUE_DATE_ONE FIN_NEAR_VALUE_DATE ,CASE WHEN TO_DATE(OP_SW.NEAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY')  = TTFXL_NL.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_VALUE_DATE,
TO_DATE(OP_SW.FAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY')  OPICS_FAR_VALUE_DATE,TTFXL_FL.VALUE_DATE_ONE FIN_FAR_VALUE_DATE ,CASE WHEN TO_DATE(OP_SW.FAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY')  =TTFXL_FL.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END MATCH_FAR_VALUE_DATE,
SI_FLOW_PAY_NOSTRO OPICS_NEAR_PAY_NOSTRO,NEAR_pay_nos FIN_NEAR_PAY_NOSTRO, CASE WHEN nvl(TRIM(SI_FLOW_PAY_NOSTRO),' ') =nvl(TRIM(NEAR_pay_nos),' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_PAY_NOSTRO ,
SI_FLOW_REC_NOSTRO OPICS_NEAR_REC_NOSTRO,NEAR_REC_nos FIN_NEAR_REC_NOSTRO ,CASE WHEN nvl(TRIM(SI_FLOW_REC_NOSTRO),' ') = nvl(TRIM(NEAR_REC_nos),' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_NEAR_REC_NOSTRO ,
SI_FLOW_FAR_PAY_NOSTRO OPICS_FAR_PAY_NOSTRO,FAR_pay_nos FIN_FAR_PAY_NOSTRO,CASE WHEN nvl(TRIM(SI_FLOW_FAR_PAY_NOSTRO),' ') = nvl(TRIM(FAR_pay_nos),' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_FAR_PAY_NOSTRO ,
SI_FLOW_FAR_REC_NOSTRO OPICS_FAR_REC_NOSTRO,FAR_REC_NOS FIN_FAR_REC_NOSTRO,CASE WHEN nvl(TRIM(SI_FLOW_FAR_REC_NOSTRO),' ') = nvl(TRIM(FAR_REC_NOS),' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_FAR_REC_NOSTRO ,
TRIM(OP_SW.DEAL_IDENTIFIER)||'-'||TO_DATE(OP_SW.DEAL_DATE,'DD-MON-YYYY')||'-'||OP_SW.SUBTYPE||'-'||OP_SW.ENTITY_NAME||'-'||OP_SW.NEAR_LEG_CCY_PAIR||'-'||TRIM(OP_SW.NEAR_LEG_CPTY)||'-'||TRIM(ROUND(NEAR_LEG_CCY_ONE_AMOUNT,0))||'-'||
ROUND(TRIM(NEAR_LEG_MARKET_SPOT_RATE),4)||'-'||TRIM(ROUND(NEAR_LEG_CCY_TWO_AMOUNT,0))||'-'||TO_DATE(NEAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY')||'-'||TRIM(ROUND(FAR_LEG_CCY_ONE_AMOUNT,0))||'-'||ROUND(TRIM(FAR_LEG_MARKET_FWD_RATE),4)||'-'||
TRIM(ROUND(FAR_LEG_CCY_TWO_AMOUNT,0))||'-'||TO_DATE(FAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY') opics_data,
fin_fx_swap.DEAL_IDENTIFIER||'-'||fin_fx_swap.DEAL_DATE||'-'||SDSBTY.NAME||'-'||SDENT.NAME||'-'||TTFXL_NL.CCY_PAIR||'-'||trim(SDCP.name) ||'-'||ROUND(TTFXL_NL.CCY_ONE_AMOUNT_VALUE,0)||'-'||ROUND(TTFXL_NL.MARKET_SPOT_RATE,4)||'-'||
ROUND(TTFXL_NL.CCY_TWO_AMOUNT_VALUE,0)||'-'||TTFXL_NL.VALUE_DATE_ONE||'-'||ROUND(TTFXL_FL.CCY_ONE_AMOUNT_VALUE,0)||'-'||ROUND(TTFXL_FL.MARKET_FWD_RATE+TTFXL_FL.FWD_MARGIN_POINTS,4)||'-'||
ROUND(TTFXL_FL.CCY_TWO_AMOUNT_VALUE,0)||'-'||TTFXL_FL.VALUE_DATE_ONE fin_data,
CASE WHEN TRIM(OP_SW.DEAL_IDENTIFIER)||'-'||TO_DATE(OP_SW.DEAL_DATE,'DD-MON-YYYY')||'-'||OP_SW.SUBTYPE||'-'||OP_SW.ENTITY_NAME||'-'||OP_SW.NEAR_LEG_CCY_PAIR||'-'||TRIM(OP_SW.NEAR_LEG_CPTY)||'-'||TRIM(ROUND(NEAR_LEG_CCY_ONE_AMOUNT,0))||'-'||
ROUND(TRIM(NEAR_LEG_MARKET_SPOT_RATE),4)||'-'||TRIM(ROUND(NEAR_LEG_CCY_TWO_AMOUNT,0))||'-'||TO_DATE(NEAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY')||'-'||TRIM(ROUND(FAR_LEG_CCY_ONE_AMOUNT,0))||'-'||ROUND(TRIM(FAR_LEG_MARKET_FWD_RATE),4)||'-'||
TRIM(ROUND(FAR_LEG_CCY_TWO_AMOUNT,0))||'-'||TO_DATE(FAR_LEG_VALUE_DATE_ONE,'DD-MON-YYYY') = 
fin_fx_swap.DEAL_IDENTIFIER||'-'||fin_fx_swap.DEAL_DATE||'-'||SDSBTY.NAME||'-'||SDENT.NAME||'-'||TTFXL_NL.CCY_PAIR||'-'||trim(SDCP.name) ||'-'||ROUND(TTFXL_NL.CCY_ONE_AMOUNT_VALUE,0)||'-'||ROUND(TTFXL_NL.MARKET_SPOT_RATE,4)||'-'||
ROUND(TTFXL_NL.CCY_TWO_AMOUNT_VALUE,0)||'-'||TTFXL_NL.VALUE_DATE_ONE||'-'||ROUND(TTFXL_FL.CCY_ONE_AMOUNT_VALUE,0)||'-'||ROUND(TTFXL_FL.MARKET_FWD_RATE+TTFXL_FL.FWD_MARGIN_POINTS,4)||'-'||
ROUND(TTFXL_FL.CCY_TWO_AMOUNT_VALUE,0)||'-'||TTFXL_FL.VALUE_DATE_ONE
THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
from FX_SWAP_O_TABLE OP_SW
LEFT JOIN TT_FXP_DEAL@ftmig fin_fx_swap on TRIM(OP_SW.DEAL_IDENTIFIER) = TRIM(fin_fx_swap.DEAL_IDENTIFIER) AND  DEAL_TYPE='FXPLSW' AND fin_fx_swap.DEAL_STATE!='DLTD' 
LEFT JOIN SD_TRADING_BOOK@ftmig SDTRBK ON SDTRBK.FBO_ID_NUM = fin_fx_swap.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftmig SDENT ON SDENT.FBO_ID_NUM = fin_fx_swap.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftmig SDSBTY ON SDSBTY.FBO_ID_NUM = fin_fx_swap.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftmig SDCP ON SDCP.FBO_ID_NUM= fin_fx_swap.CPTY_FBO_ID_NUM
--LEFT JOIN TT_FXP_FLOW@ftmig TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM  AND TTFXFL.FXP_FLOW_REFERENCE = '1'
LEFT JOIN (SELECT * FROM (SELECT * FROM  TT_FXP_LEG@ftmig A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@ftmig GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM AND LEG_IDENTIFIER='NELG'))) TTFXL_NL ON  TTFXL_NL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXL_NL.PARENT_FBO_ID_TYPE = fin_fx_swap.DEAL_TYPE
LEFT JOIN (SELECT * FROM (SELECT * FROM  TT_FXP_LEG@ftmig A WHERE EXISTS(
  SELECT * FROM (SELECT PARENT_FBO_ID_NUM,FX_BUY_SELL,MAX(FBO_ID_NUM) FBO_ID_NUM FROM  TT_FXP_LEG@ftmig GROUP BY PARENT_FBO_ID_NUM,FX_BUY_SELL) B WHERE A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM AND A.FX_BUY_SELL =B.FX_BUY_SELL AND 
  A.FBO_ID_NUM = B.FBO_ID_NUM AND LEG_IDENTIFIER='FALG'))) TTFXL_FL ON  TTFXL_FL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXL_FL.PARENT_FBO_ID_TYPE = fin_fx_swap.DEAL_TYPE
  LEFT JOIN(SELECT distinct a.PARENT_FBO_ID_NUM,a.PARENT_FBO_ID_TYPE,A.IQ_CURRENCY NEAR_PAY_CCY,a.NAME NEAR_pay_nos ,B.IQ_CURRENCY NEAR_REC_CCY,b.NAME NEAR_rec_nos,C.IQ_CURRENCY FAR_PAY_CCY,C.NAME FAR_pay_nos ,D.IQ_CURRENCY FAR_REC_CCY,D.NAME FAR_rec_nos  FROM (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT' AND PARENT_FBO_ID_VER='999999' AND SIDE_REFERENCE='1') A
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT' AND PARENT_FBO_ID_VER='999999' AND SIDE_REFERENCE='1') B ON A.PARENT_FBO_ID_TYPE = B.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM
   LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT' AND PARENT_FBO_ID_VER='999999' AND SIDE_REFERENCE='2') C ON A.PARENT_FBO_ID_TYPE = C.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = C.PARENT_FBO_ID_NUM
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT' AND PARENT_FBO_ID_VER='999999' AND SIDE_REFERENCE='2') D ON A.PARENT_FBO_ID_TYPE = D.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = D.PARENT_FBO_ID_NUM
  ) NOS ON NOS.PARENT_FBO_ID_NUM =fin_fx_swap.DEAL_NUM  AND NOS.PARENT_FBO_ID_TYPE =fin_fx_swap.DEAL_TYPE 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
interest_rates_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
interest_rates_report.sql 
select distinct
Y.CONTRIBRATE OPICS_CONTRIBRATE,MINT.CCY FINACLE_CCY,CASE WHEN SUBSTR(Y.CONTRIBRATE,1,3) = MINT.CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
Y.CONTRIBRATE OPICS_CONTRIBRATE ,MINT.Type FINACLE_Type,CASE WHEN SUBSTR(Y.CONTRIBRATE,4) = MINT.Type THEN 'TRUE' ELSE 'FALSE' END MATCH_Type,
Y.MTYEND OPICS_MTYEND, MINT.Nominal FINACLE_Nominal,CASE WHEN Y.MTYEND = UPPER(MINT.Nominal) THEN 'TRUE' ELSE 'FALSE' END MATCH_Nominal,
R.BASIS OPICS_BASIS, MINT.Basis FINACLE_BASIS,CASE WHEN SUBSTR(R.BASIS,1,1)||'/'||SUBSTR(R.BASIS,2)  = MINT.Basis THEN 'TRUE' ELSE 'FALSE' END MATCH_BASIS,
Y.BIDRATE_8 OPICS_BIDRATE_8,MINT.BID_RATE*100 FINACLE_BID_RATE,CASE WHEN Y.BIDRATE_8  = MINT.BID_RATE*100 THEN 'TRUE' ELSE 'FALSE' END MATCH_BID_RATE,
Y.OFFERRATE_8 OPICS_OFFERRATE_8,MINT.OFFER_RATE*100 FINACLE_OFFER_RATE,CASE WHEN Y.OFFERRATE_8  = MINT.OFFER_RATE*100 THEN 'TRUE' ELSE 'FALSE' END MATCH_OFFER_RATE,
Y.BPDATA OPICS_BPDATA ,MINT.Base_Date FINACLE_Base_Date,CASE WHEN Y.BPDATA = MINT.Base_Date THEN 'TRUE' ELSE 'FALSE' END MATCH_Base_Date
FROM YCRH Y
INNER JOIN RATE R ON R.CCY=Y.CCY
LEFT JOIN(SELECT MINT.CCY,MINT.Type,MINT.Nominal,MINT.Basis,MINT.BID_RATE,MINT.OFFER_RATE,MNAM.Base_Date
FROM ftabkbpd.MRS_INTRATES@ftfc MINT --ON Y.CCY = MINT.CCY AND UPPER(TRIM(Y.MTYEND)) =  UPPER(TRIM(MINT.Nominal))
LEFT join ftabkbpd.mrs_names@ftfc MNAM on MNAM.NAME=MINT.NAME) MINT ON Y.CCY = MINT.CCY AND UPPER(TRIM(Y.MTYEND)) =  UPPER(TRIM(MINT.Nominal))
 AND  Y.BPDATA = MINT.Base_Date
where  y.ccy in ('BHD','CHF','GBP','KWD','OMR','QAR','EUR','SAR','AED','JPY','USD') and y.BIDRATE_8 <> 0; 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
internal_deals_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
internal_deals_report.sql 
select FX_BUY_SELL,
TRIM(DEALNO)||'-'||DEALDATE||'-'||VDATE||'-'||
MDATE||'-'||CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END||'-'||
trim(CCYNEARRATE_8)||'-'||ABS(round(CCYPRINAMT,2))||'-'||ABS(round(CTRPRINAMT,2))||'-'||ABS(round(CTRAMT,2))||'-'||trim(ABS(round(CCYAMT,2)))||'-'||trim(abs(CCYFARRATE_8))||'-'||
trim(abs(CCYINTRATE_8))||'-'||trim(abs(CTRINTRATE_8)) CONV_OPICS_DATA,
FIN_FX.deal_identifier||'-'||DEAL_DATE||'-'||START_DATE||'-'||END_DATE||'-'||SDENT.name||'-'||FIN_FX.CURRENCY_PAIR||'-'||FIN_FX.CONTRACT_RATE||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2)  else ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) end||'-'||abs(to_number(FWD_CONTRACT_RATE))||'-'||
round(TO_NUMBER(abs(DEPO_RATE)*100),8)||'-'||round(TO_NUMBER( abs(LOAN_RATE)*100),8) FIN_DATA,
CASE WHEN TRIM(DEALNO)||'-'||DEALDATE||'-'||VDATE||'-'||
MDATE||'-'||CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END||'-'||
trim(CCYNEARRATE_8)||'-'||ABS(round(CCYPRINAMT,2))||'-'||ABS(round(CTRPRINAMT,2))||'-'||ABS(round(CTRAMT,2))||'-'||trim(ABS(round(CCYAMT,2)))||'-'||trim(abs(CCYFARRATE_8))||'-'||
trim(abs(CCYINTRATE_8))||'-'||trim(abs(CTRINTRATE_8)) = 
FIN_FX.deal_identifier||'-'||DEAL_DATE||'-'||START_DATE||'-'||END_DATE||'-'||SDENT.name||'-'||FIN_FX.CURRENCY_PAIR||'-'||FIN_FX.CONTRACT_RATE||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2)  else ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) end||'-'||abs(FWD_CONTRACT_RATE)||'-'||
round(TO_NUMBER(abs(DEPO_RATE)*100),8)||'-'||round(TO_NUMBER( abs(LOAN_RATE)*100),8) THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
 from  FXIH
LEFT JOIN SPOT_RATES_O_TABLE ON CURRENCY_PAIR = CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END
LEFT JOIN TT_FX_ARB@ftmig FIN_FX ON TRIM(DEALNO) = TRIM(FIN_FX.DEAL_IDENTIFIER) and DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@ftmig SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftmig SDENT ON SDENT.FBO_ID_NUM = FIN_FX.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftmig SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftmig SDCP ON SDCP.FBO_ID_NUM = FIN_FX.CPTY_FBO_ID_NUM
WHERE MDATE > to_date(get_param('EOD_DATE'),'dd-mm-yyyy') AND BR = '01'AND REVDATE IS NULL



select FX_BUY_SELL,
TRIM(DEALNO)||'-'||DEALDATE||'-'||VDATE||'-'||
MDATE||'-'||CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END||'-'||
CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END||'-'||
trim(CCYNEARRATE_8)||'-'||ABS(round(CCYPRINAMT,2))||'-'||ABS(round(CTRPRINAMT,2))||'-'||ABS(round(CTRAMT,2))||'-'||trim(ABS(round(CCYAMT,2)))||'-'||trim(abs(CCYFARRATE_8))||'-'||
trim(abs(CCYINTRATE_8))||'-'||trim(abs(CTRINTRATE_8)) CONV_OPICS_DATA,
FIN_FX.deal_identifier||'-'||DEAL_DATE||'-'||START_DATE||'-'||END_DATE||'-'||SDENT.name||'-'||FIN_FX.CURRENCY_PAIR||'-'||
 CASE WHEN FX_BUY_SELL='B' THEN 'BUY' WHEN FX_BUY_SELL='S' THEN 'SELL' END||'-'||
FIN_FX.CONTRACT_RATE||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2)  else ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) end||'-'||abs(to_number(FWD_CONTRACT_RATE))||'-'||
round(TO_NUMBER(abs(DEPO_RATE)*100),8)||'-'||round(TO_NUMBER( abs(LOAN_RATE)*100),8) FIN_DATA,
CASE WHEN TRIM(DEALNO)||'-'||DEALDATE||'-'||VDATE||'-'||
MDATE||'-'||CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END||'-'||
CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END||'-'||
trim(CCYNEARRATE_8)||'-'||ABS(round(CCYPRINAMT,2))||'-'||ABS(round(CTRPRINAMT,2))||'-'||ABS(round(CTRAMT,2))||'-'||trim(ABS(round(CCYAMT,2)))||'-'||trim(abs(CCYFARRATE_8))||'-'||
trim(abs(CCYINTRATE_8))||'-'||trim(abs(CTRINTRATE_8)) = 
FIN_FX.deal_identifier||'-'||DEAL_DATE||'-'||START_DATE||'-'||END_DATE||'-'||SDENT.name||'-'||FIN_FX.CURRENCY_PAIR||'-'||
CASE WHEN FX_BUY_SELL='B' THEN 'BUY' WHEN FX_BUY_SELL='S' THEN 'SELL' END||'-'||FIN_FX.CONTRACT_RATE||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2)  else ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2) end||'-'||abs(FWD_CONTRACT_RATE)||'-'||
round(TO_NUMBER(abs(DEPO_RATE)*100),8)||'-'||round(TO_NUMBER( abs(LOAN_RATE)*100),8) THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
 from  FXIH
LEFT JOIN SPOT_RATES_O_TABLE ON CURRENCY_PAIR = CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END
LEFT JOIN TT_FX_ARB@ftmig FIN_FX ON TRIM(DEALNO) = TRIM(FIN_FX.DEAL_IDENTIFIER) and DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@ftmig SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftmig SDENT ON SDENT.FBO_ID_NUM = FIN_FX.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftmig SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftmig SDCP ON SDCP.FBO_ID_NUM = FIN_FX.CPTY_FBO_ID_NUM
WHERE MDATE > to_date(get_param('EOD_DATE'),'dd-mm-yyyy') AND BR = '01'AND REVDATE IS NULL






select FX_BUY_SELL,
TRIM(DEALNO)||'-'||DEALDATE||'-'||VDATE||'-'||
MDATE||'-'||CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END||'-'||
CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END||'-'||
trim(CCYNEARRATE_8)||'-'||ABS(round(CCYPRINAMT,2))||'-'||ABS(round(CTRPRINAMT,2))||'-'||ABS(round(CTRAMT,2))||'-'||trim(ABS(round(CCYAMT,2)))||'-'||trim(abs(CCYFARRATE_8))||'-'||
trim(abs(CCYINTRATE_8))||'-'||trim(abs(CTRINTRATE_8)) CONV_OPICS_DATA,
FIN_FX.deal_identifier||'-'||DEAL_DATE||'-'||START_DATE||'-'||END_DATE||'-'||SDENT.name||'-'||FIN_FX.CURRENCY_PAIR||'-'||
 CASE WHEN FX_BUY_SELL='B' THEN 'SELL' WHEN FX_BUY_SELL='S' THEN 'BUY' END||'-'||FIN_FX.CONTRACT_RATE||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2)  else ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) end||'-'||abs(to_number(FWD_CONTRACT_RATE))||'-'||
round(TO_NUMBER(abs(DEPO_RATE)*100),8)||'-'||round(TO_NUMBER( abs(LOAN_RATE)*100),8) FIN_DATA,
CASE WHEN TRIM(DEALNO)||'-'||DEALDATE||'-'||VDATE||'-'||
MDATE||'-'||CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END||'-'||
CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END||'-'||
trim(CCYNEARRATE_8)||'-'||ABS(round(CCYPRINAMT,2))||'-'||ABS(round(CTRPRINAMT,2))||'-'||ABS(round(CTRAMT,2))||'-'||trim(ABS(round(CCYAMT,2)))||'-'||trim(abs(CCYFARRATE_8))||'-'||
trim(abs(CCYINTRATE_8))||'-'||trim(abs(CTRINTRATE_8)) = 
FIN_FX.deal_identifier||'-'||DEAL_DATE||'-'||START_DATE||'-'||END_DATE||'-'||SDENT.name||'-'||FIN_FX.CURRENCY_PAIR||'-'||
 CASE WHEN FX_BUY_SELL='B' THEN 'SELL' WHEN FX_BUY_SELL='S' THEN 'BUY' END||'-'||FIN_FX.CONTRACT_RATE||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2)  else ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) end||'-'||abs(FWD_CONTRACT_RATE)||'-'||
round(TO_NUMBER(abs(DEPO_RATE)*100),8)||'-'||round(TO_NUMBER( abs(LOAN_RATE)*100),8) THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
 from  FXIH
LEFT JOIN SPOT_RATES_O_TABLE ON CURRENCY_PAIR = CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END
LEFT JOIN TT_FX_ARB@ftmig FIN_FX ON TRIM(DEALNO) = TRIM(FIN_FX.DEAL_IDENTIFIER) and DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@ftmig SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftmig SDENT ON SDENT.FBO_ID_NUM = FIN_FX.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftmig SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftmig SDCP ON SDCP.FBO_ID_NUM = FIN_FX.CPTY_FBO_ID_NUM
WHERE MDATE > to_date(get_param('EOD_DATE'),'dd-mm-yyyy') AND BR = '01'AND REVDATE IS NULL


--POST MOCK5A

select 
DEALNO OPICS_DEALNO ,FIN_FX.DEAL_IDENTIFIER FIN_DEAL_IDENTIFIER,CASE WHEN TRIM(DEALNO) = FIN_FX.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
BR OPICS_BR, CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END MAPPED_ENTITY, SDENT.NAME FIN_ENTITY, CASE WHEN CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END =  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
DEALDATE OPICS_DEAL_DATE ,FIN_FX.DEAL_DATE FIN_DEAL_DATE,CASE WHEN DEALDATE= FIN_FX.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
'TREASURY' MAPPED_TRADING_BOOK,SDTRBK.NAME FIN_TRADING_BOOK,CASE WHEN 'TREASURY' = SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK,
'ARBTRG' MAPPED_SUBTYPE ,SDSBTY.NAME FIN_SUBTYPE,CASE WHEN 'ARBTRG' = SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
VDATE OPICS_START_DATE ,START_DATE FIN_START_DATE,CASE WHEN VDATE = START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
MDATE OPICS_END_DATE ,END_DATE FIN_END_DATE,CASE WHEN MDATE = END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END MAPPED_CCY_PAIR ,FIN_FX.CURRENCY_PAIR FINCCY_PAIR,CASE WHEN CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END = FIN_FX.CURRENCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR,
PS OPICS_PS,CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END MAPPED_BUY_SELL,CASE WHEN FX_BUY_SELL='B' THEN 'SELL' WHEN FX_BUY_SELL='S' THEN 'BUY' END FIN_BUY_SELL,CASE WHEN CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END = CASE WHEN FX_BUY_SELL='B' THEN 'SELL' WHEN FX_BUY_SELL='S' THEN 'BUY' END THEN 'TRUE' ELSE 'FALSE' END MATCH_BUY_SELL,
trim(CCYNEARRATE_8) OPICS_CCYNEAR_RATE,FIN_FX.CONTRACT_RATE FIN_CCYNEAR_RATE,CASE WHEN trim(CCYNEARRATE_8) = FIN_FX.CONTRACT_RATE THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYNEAR_RATE,
ABS(round(CCYPRINAMT,2)) OPICS_CCYPRINAMT,case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) end FIN_CCYPRINAMT,CASE WHEN ABS(round(CCYPRINAMT,2)) = case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) end THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYPRINAMT,
ABS(round(CTRPRINAMT,2)) OPICS_CTRPRINAMT,case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2) end FIN_CTRPRINAMT,CASE WHEN ABS(round(CTRPRINAMT,2)) = case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2) end THEN 'TRUE' ELSE 'FALSE' END MATCH_CTRPRINAMT,
ABS(round(CTRAMT,2)) OPICS_CTRAMT,case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end FIN_CTRAMT,CASE WHEN ABS(round(CTRAMT,2)) = case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end THEN 'TRUE' ELSE 'FALSE' END MATCH_CTRAMT,
trim(ABS(round(CCYAMT,2))) OPICS_CCYAMT,case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end FIN_CCYAMT,CASE WHEN trim(ABS(round(CCYAMT,2))) = case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYAMT,
trim(abs(CCYFARRATE_8)) OPICS_CCY_FAR_RATE,abs(to_number(FWD_CONTRACT_RATE)) FIN_CCY_FAR_RATE,CASE WHEN trim(abs(CCYFARRATE_8)) = abs(to_number(FWD_CONTRACT_RATE)) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_FAR_RATE,
trim(abs(CCYINTRATE_8)) OPICS_CCY_INT_RATE,round(TO_NUMBER(abs(DEPO_RATE)*100),8) FIN_CCY_INT_RATE,CASE WHEN trim(abs(CCYINTRATE_8)) = round(TO_NUMBER(abs(DEPO_RATE)*100),8) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_INT_RATE,
trim(abs(CTRINTRATE_8)) OPICS_CTR_INT_RATE,round(TO_NUMBER( abs(LOAN_RATE)*100),8) FIN_CTR_INT_RATE,CASE WHEN trim(abs(CTRINTRATE_8)) = round(TO_NUMBER( abs(LOAN_RATE)*100),8) THEN 'TRUE' ELSE 'FALSE' END MATCH_CTR_INT_RATE,
TRIM(DEALNO)||'-'||DEALDATE||'-'||VDATE||'-'||
MDATE||'-'||CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END||'-'||
CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END||'-'||
trim(CCYNEARRATE_8)||'-'||ABS(round(CCYPRINAMT,2))||'-'||ABS(round(CTRPRINAMT,2))||'-'||ABS(round(CTRAMT,2))||'-'||trim(ABS(round(CCYAMT,2)))||'-'||trim(abs(CCYFARRATE_8))||'-'||
trim(abs(CCYINTRATE_8))||'-'||trim(abs(CTRINTRATE_8)) CONV_OPICS_DATA,
FIN_FX.deal_identifier||'-'||DEAL_DATE||'-'||START_DATE||'-'||END_DATE||'-'||SDENT.name||'-'||FIN_FX.CURRENCY_PAIR||'-'||
 CASE WHEN FX_BUY_SELL='B' THEN 'SELL' WHEN FX_BUY_SELL='S' THEN 'BUY' END||'-'||FIN_FX.CONTRACT_RATE||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2)  else ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) end||'-'||abs(to_number(FWD_CONTRACT_RATE))||'-'||
round(TO_NUMBER(abs(DEPO_RATE)*100),8)||'-'||round(TO_NUMBER( abs(LOAN_RATE)*100),8) FIN_DATA,
CASE WHEN TRIM(DEALNO)||'-'||DEALDATE||'-'||VDATE||'-'||
MDATE||'-'||CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END||'-'||
CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END||'-'||
trim(CCYNEARRATE_8)||'-'||ABS(round(CCYPRINAMT,2))||'-'||ABS(round(CTRPRINAMT,2))||'-'||ABS(round(CTRAMT,2))||'-'||trim(ABS(round(CCYAMT,2)))||'-'||trim(abs(CCYFARRATE_8))||'-'||
trim(abs(CCYINTRATE_8))||'-'||trim(abs(CTRINTRATE_8)) = 
FIN_FX.deal_identifier||'-'||DEAL_DATE||'-'||START_DATE||'-'||END_DATE||'-'||SDENT.name||'-'||FIN_FX.CURRENCY_PAIR||'-'||
 CASE WHEN FX_BUY_SELL='B' THEN 'SELL' WHEN FX_BUY_SELL='S' THEN 'BUY' END||'-'||FIN_FX.CONTRACT_RATE||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2)  else ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) end||'-'||abs(FWD_CONTRACT_RATE)||'-'||
round(TO_NUMBER(abs(DEPO_RATE)*100),8)||'-'||round(TO_NUMBER( abs(LOAN_RATE)*100),8) THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
 from  FXIH
LEFT JOIN SPOT_RATES_O_TABLE ON CURRENCY_PAIR = CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END
LEFT JOIN TT_FX_ARB@ftmig FIN_FX ON TRIM(DEALNO) = TRIM(FIN_FX.DEAL_IDENTIFIER) and DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@ftmig SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftmig SDENT ON SDENT.FBO_ID_NUM = FIN_FX.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftmig SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftmig SDCP ON SDCP.FBO_ID_NUM = FIN_FX.CPTY_FBO_ID_NUM
WHERE MDATE > to_date(get_param('EOD_DATE'),'dd-mm-yyyy') AND BR = '01'AND REVDATE IS NULL


--MOCK FODS2

select 
DEALNO OPICS_DEALNO ,FIN_FX.DEAL_IDENTIFIER FIN_DEAL_IDENTIFIER,CASE WHEN TRIM(DEALNO) = FIN_FX.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
BR OPICS_BR, CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END MAPPED_ENTITY, SDENT.NAME FIN_ENTITY, CASE WHEN CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END =  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
DEALDATE OPICS_DEAL_DATE ,FIN_FX.DEAL_DATE FIN_DEAL_DATE,CASE WHEN DEALDATE= FIN_FX.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
'TREASURY' MAPPED_TRADING_BOOK,SDTRBK.NAME FIN_TRADING_BOOK,CASE WHEN 'TREASURY' = SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK,
'ARBTRG' MAPPED_SUBTYPE ,SDSBTY.NAME FIN_SUBTYPE,CASE WHEN 'ARBTRG' = SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
VDATE OPICS_START_DATE ,START_DATE FIN_START_DATE,CASE WHEN VDATE = START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
MDATE OPICS_END_DATE ,END_DATE FIN_END_DATE,CASE WHEN MDATE = END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END MAPPED_CCY_PAIR ,FIN_FX.CURRENCY_PAIR FINCCY_PAIR,CASE WHEN CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END = FIN_FX.CURRENCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR,
PS OPICS_PS,CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END MAPPED_BUY_SELL,CASE WHEN FX_BUY_SELL='B' THEN 'SELL' WHEN FX_BUY_SELL='S' THEN 'BUY' END FIN_BUY_SELL,CASE WHEN CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END = CASE WHEN FX_BUY_SELL='B' THEN 'SELL' WHEN FX_BUY_SELL='S' THEN 'BUY' END THEN 'TRUE' ELSE 'FALSE' END MATCH_BUY_SELL,
trim(CCYNEARRATE_8) OPICS_CCYNEAR_RATE,FIN_FX.CONTRACT_RATE FIN_CCYNEAR_RATE,CASE WHEN trim(CCYNEARRATE_8) = FIN_FX.CONTRACT_RATE THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYNEAR_RATE,
ABS(round(CCYPRINAMT,2)) OPICS_CCYPRINAMT,ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) FIN_CCYPRINAMT,CASE WHEN ABS(round(CCYPRINAMT,2)) = ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2)  THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYPRINAMT,
ABS(round(CTRPRINAMT,2)) OPICS_CTRPRINAMT,ROUND(ABS(FIN_FX.CCY_two_AMOUNT_VALUE),2) FIN_CTRPRINAMT,CASE WHEN ABS(round(CTRPRINAMT,2)) = ROUND(ABS(FIN_FX.CCY_two_AMOUNT_VALUE),2)  THEN 'TRUE' ELSE 'FALSE' END MATCH_CTRPRINAMT,
ABS(round(CTRAMT,2)) OPICS_CTRAMT,ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) FIN_CTRAMT,CASE WHEN ABS(round(CTRAMT,2)) = ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CTRAMT,
trim(ABS(round(CCYAMT,2))) OPICS_CCYAMT,ROUND(ABS(FIN_FX.CCY_one_SWAP_AMOUNT_VALUE),2) FIN_CCYAMT,CASE WHEN trim(ABS(round(CCYAMT,2))) = ROUND(ABS(FIN_FX.CCY_one_SWAP_AMOUNT_VALUE),2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYAMT,
trim(abs(CCYFARRATE_8)) OPICS_CCY_FAR_RATE,abs(to_number(FWD_CONTRACT_RATE)) FIN_CCY_FAR_RATE,CASE WHEN trim(abs(CCYFARRATE_8)) = abs(to_number(FWD_CONTRACT_RATE)) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_FAR_RATE,
trim(abs(CCYINTRATE_8)) OPICS_CCY_INT_RATE,round(TO_NUMBER(abs(DEPO_RATE)*100),8) FIN_CCY_INT_RATE,CASE WHEN trim(abs(CCYINTRATE_8)) = round(TO_NUMBER(abs(DEPO_RATE)*100),8) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_INT_RATE,
trim(abs(CTRINTRATE_8)) OPICS_CTR_INT_RATE,round(TO_NUMBER( abs(LOAN_RATE)*100),8) FIN_CTR_INT_RATE,CASE WHEN trim(abs(CTRINTRATE_8)) = round(TO_NUMBER( abs(LOAN_RATE)*100),8) THEN 'TRUE' ELSE 'FALSE' END MATCH_CTR_INT_RATE,
TRIM(DEALNO)||'-'||DEALDATE||'-'||VDATE||'-'||
MDATE||'-'||CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END||'-'||
CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END||'-'||
trim(CCYNEARRATE_8)||'-'||ABS(round(CCYPRINAMT,2))||'-'||ABS(round(CTRPRINAMT,2))||'-'||ABS(round(CTRAMT,2))||'-'||trim(ABS(round(CCYAMT,2)))||'-'||trim(abs(CCYFARRATE_8))||'-'||
trim(abs(CCYINTRATE_8))||'-'||trim(abs(CTRINTRATE_8)) CONV_OPICS_DATA,
FIN_FX.deal_identifier||'-'||DEAL_DATE||'-'||START_DATE||'-'||END_DATE||'-'||SDENT.name||'-'||FIN_FX.CURRENCY_PAIR||'-'||
 CASE WHEN FX_BUY_SELL='B' THEN 'SELL' WHEN FX_BUY_SELL='S' THEN 'BUY' END||'-'||FIN_FX.CONTRACT_RATE||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2)  else ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) end||'-'||abs(to_number(FWD_CONTRACT_RATE))||'-'||
round(TO_NUMBER(abs(DEPO_RATE)*100),8)||'-'||round(TO_NUMBER( abs(LOAN_RATE)*100),8) FIN_DATA,
CASE WHEN TRIM(DEALNO)||'-'||DEALDATE||'-'||VDATE||'-'||
MDATE||'-'||CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END||'-'||
CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END||'-'||
trim(CCYNEARRATE_8)||'-'||ABS(round(CCYPRINAMT,2))||'-'||ABS(round(CTRPRINAMT,2))||'-'||ABS(round(CTRAMT,2))||'-'||trim(ABS(round(CCYAMT,2)))||'-'||trim(abs(CCYFARRATE_8))||'-'||
trim(abs(CCYINTRATE_8))||'-'||trim(abs(CTRINTRATE_8)) = 
FIN_FX.deal_identifier||'-'||DEAL_DATE||'-'||START_DATE||'-'||END_DATE||'-'||SDENT.name||'-'||FIN_FX.CURRENCY_PAIR||'-'||
 CASE WHEN FX_BUY_SELL='B' THEN 'SELL' WHEN FX_BUY_SELL='S' THEN 'BUY' END||'-'||FIN_FX.CONTRACT_RATE||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_TWO_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) else ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) end||'-'||
case when FX_BUY_SELL='S' then ROUND(ABS(FIN_FX.CCY_ONE_SWAP_AMOUNT_VALUE),2)  else ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) end||'-'||abs(FWD_CONTRACT_RATE)||'-'||
round(TO_NUMBER(abs(DEPO_RATE)*100),8)||'-'||round(TO_NUMBER( abs(LOAN_RATE)*100),8) THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
 from  FXIH
LEFT JOIN SPOT_RATES_O_TABLE ON CURRENCY_PAIR = CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END
LEFT JOIN TT_FX_ARB@ftmig FIN_FX ON TRIM(DEALNO) = TRIM(FIN_FX.DEAL_IDENTIFIER) and DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@ftmig SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftmig SDENT ON SDENT.FBO_ID_NUM = FIN_FX.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftmig SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftmig SDCP ON SDCP.FBO_ID_NUM = FIN_FX.CPTY_FBO_ID_NUM
WHERE MDATE > to_date(get_param('EOD_DATE'),'dd-mm-yyyy') AND BR = '01'AND REVDATE IS NULL


select 
DEALNO OPICS_DEALNO ,FIN_FX.DEAL_IDENTIFIER FIN_DEAL_IDENTIFIER,CASE WHEN TRIM(DEALNO) = FIN_FX.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
BR OPICS_BR, CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END MAPPED_ENTITY, SDENT.NAME FIN_ENTITY, CASE WHEN CASE WHEN TRIM(BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END =  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
DEALDATE OPICS_DEAL_DATE ,FIN_FX.DEAL_DATE FIN_DEAL_DATE,CASE WHEN DEALDATE= FIN_FX.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
'TREASURY' MAPPED_TRADING_BOOK,SDTRBK.NAME FIN_TRADING_BOOK,CASE WHEN 'TREASURY' = SDTRBK.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_TRADING_BOOK,
'ARBTRG' MAPPED_SUBTYPE ,SDSBTY.NAME FIN_SUBTYPE,CASE WHEN 'ARBTRG' = SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
VDATE OPICS_START_DATE ,START_DATE FIN_START_DATE,CASE WHEN VDATE = START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
MDATE OPICS_END_DATE ,END_DATE FIN_END_DATE,CASE WHEN MDATE = END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END MAPPED_CCY_PAIR ,FIN_FX.CURRENCY_PAIR FINCCY_PAIR,CASE WHEN CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END = FIN_FX.CURRENCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR,
PS OPICS_PS,CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END MAPPED_BUY_SELL,CASE WHEN FX_BUY_SELL='B' THEN 'SELL' WHEN FX_BUY_SELL='S' THEN 'BUY' END FIN_BUY_SELL,CASE WHEN CASE WHEN PS='P' THEN 'BUY' WHEN PS='S' THEN 'SELL' END = CASE WHEN FX_BUY_SELL='B' THEN 'SELL' WHEN FX_BUY_SELL='S' THEN 'BUY' END THEN 'TRUE' ELSE 'FALSE' END MATCH_BUY_SELL,
trim(CCYNEARRATE_8) OPICS_CCYNEAR_RATE,FIN_FX.CONTRACT_RATE FIN_CCYNEAR_RATE,CASE WHEN trim(CCYNEARRATE_8) = FIN_FX.CONTRACT_RATE THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYNEAR_RATE,
ABS(round(CCYPRINAMT,2)) OPICS_CCYPRINAMT,ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2) FIN_CCYPRINAMT,CASE WHEN ABS(round(CCYPRINAMT,2)) = ROUND(ABS(FIN_FX.CCY_one_AMOUNT_VALUE),2)  THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYPRINAMT,
ABS(round(CTRPRINAMT,2)) OPICS_CTRPRINAMT,ROUND(ABS(FIN_FX.CCY_two_AMOUNT_VALUE),2) FIN_CTRPRINAMT,CASE WHEN ABS(round(CTRPRINAMT,2)) = ROUND(ABS(FIN_FX.CCY_two_AMOUNT_VALUE),2)  THEN 'TRUE' ELSE 'FALSE' END MATCH_CTRPRINAMT,
ABS(round(CTRAMT,2)) OPICS_CTRAMT,ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) FIN_CTRAMT,CASE WHEN ABS(round(CTRAMT,2)) = ROUND(ABS(FIN_FX.CCY_two_SWAP_AMOUNT_VALUE),2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CTRAMT,
trim(ABS(round(CCYAMT,2))) OPICS_CCYAMT,ROUND(ABS(FIN_FX.CCY_one_SWAP_AMOUNT_VALUE),2) FIN_CCYAMT,CASE WHEN trim(ABS(round(CCYAMT,2))) = ROUND(ABS(FIN_FX.CCY_one_SWAP_AMOUNT_VALUE),2) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCYAMT,
trim(abs(CCYFARRATE_8)) OPICS_CCY_FAR_RATE,abs(to_number(FWD_CONTRACT_RATE)) FIN_CCY_FAR_RATE,CASE WHEN trim(abs(CCYFARRATE_8)) = abs(to_number(FWD_CONTRACT_RATE)) THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_FAR_RATE,
trim(abs(CCYINTRATE_8)) OPICS_CCY_INT_RATE,CASE WHEN PS='P' THEN round(TO_NUMBER(abs(DEPO_RATE)*100),8) WHEN PS='S' THEN round(TO_NUMBER( abs(LOAN_RATE)*100),8) END  FIN_CCY_INT_RATE,CASE WHEN trim(abs(CCYINTRATE_8)) = CASE WHEN PS='P' THEN round(TO_NUMBER(abs(DEPO_RATE)*100),8) WHEN PS='S' THEN round(TO_NUMBER( abs(LOAN_RATE)*100),8) END THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_INT_RATE,
trim(abs(CTRINTRATE_8)) OPICS_CTR_INT_RATE,CASE WHEN PS='P' THEN round(TO_NUMBER( abs(LOAN_RATE)*100),8) WHEN PS='S' THEN  round(TO_NUMBER(abs(DEPO_RATE)*100),8) END  FIN_CTR_INT_RATE,CASE WHEN trim(abs(CTRINTRATE_8)) = CASE WHEN PS='P' THEN round(TO_NUMBER( abs(LOAN_RATE)*100),8) WHEN PS='S' THEN  round(TO_NUMBER(abs(DEPO_RATE)*100),8) END THEN 'TRUE' ELSE 'FALSE' END MATCH_CTR_INT_RATE
 from  FXIH
LEFT JOIN SPOT_RATES_O_TABLE ON CURRENCY_PAIR = CASE WHEN CCYTERMS='M' THEN TRIM(CCY)||'/'||TRIM(CTRCCY) ELSE TRIM(CTRCCY)||'/'||TRIM(CCY) END
LEFT JOIN TT_FX_ARB@ftmig FIN_FX ON TRIM(DEALNO) = TRIM(FIN_FX.DEAL_IDENTIFIER) and DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@ftmig SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftmig SDENT ON SDENT.FBO_ID_NUM = FIN_FX.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftmig SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftmig SDCP ON SDCP.FBO_ID_NUM = FIN_FX.CPTY_FBO_ID_NUM
WHERE MDATE > to_date(get_param('EOD_DATE'),'dd-mm-yyyy') AND BR = '01'AND REVDATE IS NULL 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
reference_rate_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
reference_rate_report.sql 
SELECT 
 A."Rate Code" OPICS_RATE_CODE, B.RATE_CODE FIN_RATE_CODE,CASE WHEN A."Rate Code" = B.RATE_CODE THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE_CODE,
 A."Rate Currency" OPICS_RATE_CCY,B.RATE_CCY FIN_RATE_CCY,CASE WHEN A."Rate Currency" = B.RATE_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE_CCY,
 TO_DATE(A."Effective Date",'DD-MON-YYYY') OPICS_EFFECTIVE_DATE, B.EFFECTIVE_DATE FIN_EFFECTIVE_DATE,CASE WHEN TO_DATE(A."Effective Date",'DD-MON-YYYY') = B.EFFECTIVE_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_EFFECTIVE_DATE,
 ROUND(A."Rate Value",8) OPICS_RATE , ROUND(B.RATE_VALUE*100,8) FIN_RATE,CASE WHEN round(A."Rate Value",8) = round(B.RATE_VALUE*100,8) THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE,
 A."Rate Code"||'-'||A."Rate Currency"||'-'||TO_DATE(A."Effective Date",'DD-MON-YYYY')||'-'||ROUND(A."Rate Value",8) OPICS_DATA,
 B.RATE_CODE||'-'||B.RATE_CCY||'-'||B.EFFECTIVE_DATE||'-'||ROUND(B.RATE_VALUE*100,8) FIN_DATA,
 CASE WHEN 
 A."Rate Code"||'-'||A."Rate Currency"||'-'||TO_DATE(A."Effective Date",'DD-MON-YYYY')||'-'||ROUND(A."Rate Value",8)
 =
 B.RATE_CODE||'-'||B.RATE_CCY||'-'||B.EFFECTIVE_DATE||'-'||ROUND(B.RATE_VALUE*100,8)
 THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
 FROM REFERENCE_RATE_O_TABLE A
LEFT JOIN (
SELECT RATE_CODE,RATE_CCY,RATE_VALUE,EFFECTIVE_DATE FROM SD_REF_RATE_VALUE@FTMIG A
LEFT JOIN SD_REF_RATE@FTMIG B ON B.FBO_ID_NUM = A.REF_RATE_FBO_ID_NUM
) B ON A."Rate Code" = B.RATE_CODE AND B.RATE_CCY =A."Rate Currency" AND B.EFFECTIVE_DATE = TO_DATE(A."Effective Date",'DD-MON-YYYY') 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
repo_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
repo_report.sql 
select
D.DEALNO OPICS_DEALNO, FIN_REPO.DEAL_IDENTIFIER FINACLE_DEAL_IDENTIFIER, CASE WHEN TRIM(D.DEALNO) = TRIM(FIN_REPO.DEAL_IDENTIFIER) THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
D.PORT OPICS_PORT,SDTRBK.NAME FINACLE_TRADING_BOOK,
D.BR OPICS_BR,SDENT.NAME FINACLE_ENTITY_NAME,
D.PORT OPICS_PORT,SDSBTY.NAME FINACLE_SUBTYPE,
C.CMNE OPICS_CMNE,SDCP.MNEMONIC FINACLE_COUNTERPARTY_STRING,CASE WHEN TRIM(C.CMNE) = TRIM(SDCP.MNEMONIC) THEN 'TRUE' ELSE 'FALSE' END MATCH_COUNTERPARTY_STRING,
D.DEALDATE OPICS_DEALDATE,FIN_REPO.DEAL_DATE FINACLE_DEAL_DATE ,CASE WHEN D.DEALDATE = FIN_REPO.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALDATE,
D.VDATE OPICS_VDATE , FIN_REPO.START_DATE FINACLE_START_DATE,CASE WHEN D.VDATE =  FIN_REPO.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
R.MDATE OPICS_MDATE,FIN_REPO.END_DATE FINACLE_END_DATE,CASE WHEN R.MDATE = FIN_REPO.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
D.PS OPICS_PS , LONG_OR_SHORT FINACLE_LONG_OR_SHORT,
D.PS OPICS_PS,D.RATECODE OPICS_RATECODE,TYPE_STRING FINACLE_TYPE_STRING ,--***
D.CCY OPICS_CCY,FIN_REPO.CURRENCY_LIST FINACLE_CURRENCY_LIST,
R.PROCEEDAMT OPICS_PROCEEDAMT,TTCMFL.NOTIONAL_AMOUNT_VALUE FINACLE_NOTIONAL_AMOUNT_VALUE,
D.BASIS OPICS_BASIS,TTCMFL.BASIS_CODE OPICS_BASIS_CODE,
D.REPORATE_8 OPICS_REPORATE_8 ,TTCMFL.FIX_RATE*100 FINACLE_FIX_RATE,--SIDE_SIDE_ONE_FIX_RATE,--***
C.BIC OPICS_BIC,FIN_REPO.CONFIRM_METHOD--,
FROM  RPRH D 
LEFT JOIN CUST C ON TRIM(D.CNO)=TRIM(C.CNO)
LEFT JOIN RPDT R ON TRIM(D.DEALNO)=TRIM(R.DEALNO)
LEFT JOIN FTABKBPD.TT_COM_LOAN@FTFC FIN_REPO ON TRIM(D.DEALNO) = TRIM(FIN_REPO.DEAL_IDENTIFIER) AND SUBTYPE_FBO_ID_NUM IN (SELECT FBO_ID_NUM FROM FTABKBPD.SD_SUBTYPE@FTFC WHERE TRIM(DESCRIPTION) IN ('REPO deal with Banks','REPO deal with Central Banks'))
LEFT JOIN FTABKBPD.SD_TRADING_BOOK@FTFC SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_REPO.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN FTABKBPD.SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = FIN_REPO.ENTITY_FBO_ID_NUM
LEFT JOIN FTABKBPD.SD_SUBTYPE@FTFC SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_REPO.SUBTYPE_FBO_ID_NUM
LEFT JOIN FTABKBPD.SD_CPTY@FTFC SDCP ON SDCP.FBO_ID_NUM= FIN_REPO.CPTY_FBO_ID_NUM
LEFT JOIN FTABKBPD.TT_CMLOAN_CASH_FLOWS@FTFC TTCMFL ON TTCMFL.PARENT_FBO_ID_NUM = FIN_REPO.DEAL_NUM  AND TTCMFL.FIX_RATE IS NOT NULL
WHERE R.MDATE>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND TRIM(R.REVDATE) IS NULL 
;




select
D.DEALNO ||'-'||trim(D.PORT)||'-'||TRIM(D.BR)||'-'||TRIM(D.PORT)||'-'||trim(CMNE)||'-'||DEALDATE||'-'||D.VDATE||'-'||D.MATDATE||'-'||D.PS||'-'||D.CCY||'-'||R.COMMPROCAMT||'-'||
D.BASIS||'-'||D.REPORATE_8 OPICS_DATA,
D.DEALNO ||'-'||CASE WHEN trim(D.PORT)='MMBK' THEN 'CORPORATE' ELSE 'INTERBANK' END||'-'||CASE WHEN TRIM(D.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||
trim(CMNE)||'-'||DEALDATE||'-'||D.VDATE||'-'||D.MATDATE||'-'||CASE WHEN D.PS='S' THEN 'S' ELSE 'L' END||'-'||D.CCY||'-'||R.COMMPROCAMT||'-'||SUBSTR(D.BASIS,1,1)||'/'||SUBSTR(D.BASIS,2)||'-'||
D.REPORATE_8 CONV_OPICS_DATA,
FIN_REPO.DEAL_IDENTIFIER||'-'||SDTRBK.NAME||'-'||SDENT.NAME||'-'||SDCP.NAME||'-'||FIN_REPO.DEAL_DATE||'-'||FIN_REPO.START_DATE||'-'||FIN_REPO.END_DATE||'-'||LONG_OR_SHORT||'-'||
FIN_REPO.CURRENCY_LIST||'-'||ABS(TTCMFL.NOTIONAL_AMOUNT_VALUE)||'-'||TTCMFL.BASIS_CODE||'-'||TTCMFL.SETTLEMENT_RATE*100 FIN_DATA,
CASE WHEN D.DEALNO ||'-'||CASE WHEN trim(D.PORT)='MMBK' THEN 'CORPORATE' ELSE 'INTERBANK' END||'-'||CASE WHEN TRIM(D.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||
trim(CMNE)||'-'||DEALDATE||'-'||D.VDATE||'-'||D.MATDATE||'-'||CASE WHEN D.PS='S' THEN 'S' ELSE 'L' END||'-'||D.CCY||'-'||R.COMMPROCAMT||'-'||SUBSTR(D.BASIS,1,1)||'/'||SUBSTR(D.BASIS,2)||'-'||
D.REPORATE_8= FIN_REPO.DEAL_IDENTIFIER||'-'||SDTRBK.NAME||'-'||SDENT.NAME||'-'||SDCP.NAME||'-'||FIN_REPO.DEAL_DATE||'-'||FIN_REPO.START_DATE||'-'||FIN_REPO.END_DATE||'-'||LONG_OR_SHORT||'-'||
FIN_REPO.CURRENCY_LIST||'-'||ABS(TTCMFL.NOTIONAL_AMOUNT_VALUE)||'-'||TTCMFL.BASIS_CODE||'-'||TTCMFL.SETTLEMENT_RATE*100THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM  RPRH D 
LEFT JOIN CUST C ON TRIM(D.CNO)=TRIM(C.CNO)
LEFT JOIN RPDT R ON TRIM(D.DEALNO)=TRIM(R.DEALNO)
LEFT JOIN TT_COM_LOAN@FTMIG FIN_REPO ON TRIM(D.DEALNO) = TRIM(FIN_REPO.DEAL_IDENTIFIER) AND SUBTYPE_FBO_ID_NUM IN (SELECT FBO_ID_NUM FROM SD_SUBTYPE@FTMIG WHERE TRIM(DESCRIPTION) IN ('REPO deal with Banks','REPO deal with Central Banks'))
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_REPO.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_REPO.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_REPO.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_REPO.CPTY_FBO_ID_NUM
LEFT JOIN TT_CMLOAN_CASH_FLOWS@FTMIG TTCMFL ON TTCMFL.PARENT_FBO_ID_NUM = FIN_REPO.DEAL_NUM  AND TTCMFL.FIX_RATE IS NOT NULL
WHERE R.MDATE>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND TRIM(R.REVDATE) IS NULL 
;
 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
security_deals_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
security_deals_report.sql 
SELECT SEC_DEAL.DEAL_IDENTIFIER ||'-'||replace(SEC_DEAL.SEC_DEFN_NAME,'  ',' ') ||'-'||SEC_DEAL.SUBTYPE ||'-'||TRIM(SEC_DEAL.COUNTERPARTY_STRING) ||'-'||TO_DATE(SEC_DEAL.DEAL_DATE,'DD-MM-YYYY') ||'-'||SEC_DEAL.BUY_OR_SELL ||'-'||
SEC_D.ISSUE_CCY ||'-'||ROUND(SEC_DEAL.PRICE_STRING,5) ||'-'||SEC_DEAL.QTY_TRADED OPICS_DATA,
SECDEAL.DEAL_IDENTIFIER ||'-'||replace(SECD.NAME,'  ',' ')  ||'-'||SDSBTY.NAME ||'-'||trim(SDCP.NAME )||'-'||SECDEAL.DEAL_DATE||'-'||CASE WHEN SECDEAL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END||'-'||SECDEAL.SETTLEMENT_CCY ||'-'||
ROUND(REPLACE(SECDEAL.PRICE,',',''),5) ||'-'||abs(SECDEAL.QTY_TRADED) FIN_DATA,
CASE WHEN SEC_DEAL.DEAL_IDENTIFIER ||'-'||replace(SEC_DEAL.SEC_DEFN_NAME,'  ',' ') ||'-'||SEC_DEAL.SUBTYPE ||'-'||TRIM(SEC_DEAL.COUNTERPARTY_STRING) ||'-'||TO_DATE(SEC_DEAL.DEAL_DATE,'DD-MM-YYYY') ||'-'||SEC_DEAL.BUY_OR_SELL ||'-'||
SEC_D.ISSUE_CCY ||'-'||ROUND(SEC_DEAL.PRICE_STRING,5) ||'-'||SEC_DEAL.QTY_TRADED=
SECDEAL.DEAL_IDENTIFIER ||'-'||replace(SECD.NAME,'  ',' ')  ||'-'||SDSBTY.NAME ||'-'||trim(SDCP.NAME) ||'-'||SECDEAL.DEAL_DATE||'-'||CASE WHEN SECDEAL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END||'-'||SECDEAL.SETTLEMENT_CCY ||'-'||
ROUND(REPLACE(SECDEAL.PRICE,',',''),5) ||'-'||abs(SECDEAL.QTY_TRADED) THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM SEC_BUY_SELL_O_TABLE SEC_DEAL
LEFT JOIN SECURITY_DEFN_O_TABLE SEC_D ON SEC_D.NAME = SEC_DEAL.SEC_DEFN_NAME
LEFT JOIN TT_SEC_BS@FTMIG SECDEAL ON SEC_DEAL.DEAL_IDENTIFIER = SECDEAL.DEAL_IDENTIFIER and DEAL_STATE!='DLTD'
LEFT JOIN SD_SEC_DEFN@FTMIG SECD ON SECD.FBO_ID_NUM = SECDEAL.SEC_DEFN_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = SECDEAL.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = SECDEAL.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= SECDEAL.CPTY_FBO_ID_NUM


SELECT 
SEC_DEAL.DEAL_IDENTIFIER MAPPED_DEALNO,SECDEAL.DEAL_IDENTIFIER FIN_DEALNO, CASE WHEN SEC_DEAL.DEAL_IDENTIFIER = SECDEAL.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
SEC_DEAL.SEC_DEFN_NAME OPICS_SECID,trim(SECD.NAME) FIN_SECID, CASE WHEN SEC_DEAL.SEC_DEFN_NAME  = trim(SECD.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SECID,
SEC_DEAL.SUBTYPE MAPPED_SUBTYPE,trim(SDSBTY.NAME) FIN_SUBTYPE ,CASE WHEN  TRIM(SEC_DEAL.SUBTYPE) = trim(SDSBTY.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
COUNTERPARTY_STRING OPICS_COUNTERPARTY,trim(SDCP.NAME) FIN_COUNTERPARTY,CASE WHEN  TRIM(COUNTERPARTY_STRING) = trim(SDCP.NAME)  THEN 'TRUE' ELSE 'FALSE' END MATCH_COUNTERPARTY,
TO_DATE(SEC_DEAL.DEAL_DATE,'DD-MM-YYYY') MAPPED_DEAL_DATE,SECDEAL.DEAL_DATE FIN_DEAL_DATE,CASE WHEN TO_DATE(SEC_DEAL.DEAL_DATE,'DD-MM-YYYY')  = SECDEAL.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
SEC_DEAL.BUY_OR_SELL OPICS_BUY_OR_SELL,CASE WHEN SECDEAL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END FIN_BUY_OR_SELL ,CASE WHEN SEC_DEAL.BUY_OR_SELL  =CASE WHEN SECDEAL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END THEN 'TRUE' ELSE 'FALSE' END MATCH_BUY_OR_SELL,
ROUND(SEC_DEAL.PRICE_STRING,5) OPICS_AVG_PRICE,ROUND(REPLACE(SECDEAL.PRICE,',',''),5) FIN_PRICE,CASE WHEN ROUND(SEC_DEAL.PRICE_STRING,5)  = ROUND(REPLACE(SECDEAL.PRICE,',',''),5) THEN 'TRUE' ELSE 'FALSE' END MATCH_PRICE,
SEC_DEAL.QTY_TRADED OPICS_QTY, ABS(SECDEAL.QTY_TRADED) FIN_QTY,CASE WHEN  SEC_DEAL.QTY_TRADED =  ABS(SECDEAL.QTY_TRADED)  THEN 'TRUE' ELSE 'FALSE' END MATCH_QTY,
SI_FLOW_PAY_NOSTRO OPICS_PAY_NOSTRO,pay_nos FIN_PAY_NOSTRO,CASE WHEN trim(SI_FLOW_PAY_NOSTRO) = trim(pay_nos) THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_NOSTRO,
SI_FLOW_REC_NOSTRO OPICS_REC_NOSTRO,rec_nos FIN_REC_NOSTRO,CASE WHEN   trim(SI_FLOW_REC_NOSTRO) = trim(rec_nos) THEN 'TRUE' ELSE 'FALSE' END MATCH_REC_NOSTRO,
SEC_DEAL.DEAL_IDENTIFIER ||'-'||replace(SEC_DEAL.SEC_DEFN_NAME,'  ',' ') ||'-'||SEC_DEAL.SUBTYPE ||'-'||TRIM(SEC_DEAL.COUNTERPARTY_STRING) ||'-'||TO_DATE(SEC_DEAL.DEAL_DATE,'DD-MM-YYYY') ||'-'||SEC_DEAL.BUY_OR_SELL ||'-'||
SEC_D.ISSUE_CCY ||'-'||ROUND(SEC_DEAL.PRICE_STRING,5) ||'-'||SEC_DEAL.QTY_TRADED OPICS_DATA,
SECDEAL.DEAL_IDENTIFIER ||'-'||replace(SECD.NAME,'  ',' ')  ||'-'||SDSBTY.NAME ||'-'||trim(SDCP.NAME )||'-'||SECDEAL.DEAL_DATE||'-'||CASE WHEN SECDEAL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END||'-'||SECDEAL.SETTLEMENT_CCY ||'-'||
ROUND(REPLACE(SECDEAL.PRICE,',',''),5) ||'-'||abs(SECDEAL.QTY_TRADED) FIN_DATA,
CASE WHEN SEC_DEAL.DEAL_IDENTIFIER ||'-'||replace(SEC_DEAL.SEC_DEFN_NAME,'  ',' ') ||'-'||SEC_DEAL.SUBTYPE ||'-'||TRIM(SEC_DEAL.COUNTERPARTY_STRING) ||'-'||TO_DATE(SEC_DEAL.DEAL_DATE,'DD-MM-YYYY') ||'-'||SEC_DEAL.BUY_OR_SELL ||'-'||
SEC_D.ISSUE_CCY ||'-'||ROUND(SEC_DEAL.PRICE_STRING,5) ||'-'||SEC_DEAL.QTY_TRADED=
SECDEAL.DEAL_IDENTIFIER ||'-'||replace(SECD.NAME,'  ',' ')  ||'-'||SDSBTY.NAME ||'-'||trim(SDCP.NAME) ||'-'||SECDEAL.DEAL_DATE||'-'||CASE WHEN SECDEAL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END||'-'||SECDEAL.SETTLEMENT_CCY ||'-'||
ROUND(REPLACE(SECDEAL.PRICE,',',''),5) ||'-'||abs(SECDEAL.QTY_TRADED) THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM SEC_BUY_SELL_O_TABLE SEC_DEAL
LEFT JOIN SECURITY_DEFN_O_TABLE SEC_D ON SEC_D.NAME = SEC_DEAL.SEC_DEFN_NAME
LEFT JOIN TT_SEC_BS@FTMIG SECDEAL ON  SECDEAL.DEAL_IDENTIFIER like SEC_DEAL.DEAL_IDENTIFIER||'%'and DEAL_STATE!='DLTD'
LEFT JOIN SD_SEC_DEFN@FTMIG SECD ON SECD.FBO_ID_NUM = SECDEAL.SEC_DEFN_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = SECDEAL.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = SECDEAL.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= SECDEAL.CPTY_FBO_ID_NUM
left join (
  SELECT distinct a.PARENT_FBO_ID_NUM,a.PARENT_FBO_ID_TYPE,A.IQ_CURRENCY PAY_CCY,a.NAME pay_nos ,B.IQ_CURRENCY REC_CCY,b.NAME rec_nos  FROM (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT') A
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT') B ON A.PARENT_FBO_ID_TYPE = B.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM
  ) NOS on NOS.PARENT_FBO_ID_NUM = SECDEAL.DEAL_NUM
  
  
  

SELECT 
SEC_DEAL.DEAL_IDENTIFIER MAPPED_DEALNO,SECDEAL.DEAL_IDENTIFIER FIN_DEALNO, CASE WHEN SEC_DEAL.DEAL_IDENTIFIER = SECDEAL.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
SEC_DEAL.SEC_DEFN_NAME OPICS_SECID,trim(SECD.NAME) FIN_SECID, CASE WHEN SEC_DEAL.SEC_DEFN_NAME  = trim(SECD.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SECID,
SEC_DEAL.SUBTYPE MAPPED_SUBTYPE,trim(SDSBTY.NAME) FIN_SUBTYPE ,CASE WHEN  TRIM(SEC_DEAL.SUBTYPE) = trim(SDSBTY.NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
COUNTERPARTY_STRING OPICS_COUNTERPARTY,trim(SDCP.NAME) FIN_COUNTERPARTY,CASE WHEN  TRIM(COUNTERPARTY_STRING) = trim(SDCP.NAME)  THEN 'TRUE' ELSE 'FALSE' END MATCH_COUNTERPARTY,
TO_DATE(SEC_DEAL.DEAL_DATE,'DD-MM-YYYY') MAPPED_DEAL_DATE,SECDEAL.DEAL_DATE FIN_DEAL_DATE,CASE WHEN TO_DATE(SEC_DEAL.DEAL_DATE,'DD-MM-YYYY')  = SECDEAL.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
SEC_DEAL.BUY_OR_SELL OPICS_BUY_OR_SELL,CASE WHEN SECDEAL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END FIN_BUY_OR_SELL ,CASE WHEN SEC_DEAL.BUY_OR_SELL  =CASE WHEN SECDEAL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END THEN 'TRUE' ELSE 'FALSE' END MATCH_BUY_OR_SELL,
ROUND(SEC_DEAL.PRICE_STRING,5) OPICS_AVG_PRICE,ROUND(REPLACE(SECDEAL.PRICE,',',''),5) FIN_PRICE,CASE WHEN ROUND(SEC_DEAL.PRICE_STRING,5)  = ROUND(REPLACE(SECDEAL.PRICE,',',''),5) THEN 'TRUE' ELSE 'FALSE' END MATCH_PRICE,
SEC_DEAL.QTY_TRADED OPICS_QTY, ABS(SECDEAL.QTY_TRADED) FIN_QTY,CASE WHEN  SEC_DEAL.QTY_TRADED =  ABS(SECDEAL.QTY_TRADED)  THEN 'TRUE' ELSE 'FALSE' END MATCH_QTY,
SI_FLOW_PAY_NOSTRO OPICS_PAY_NOSTRO,pay_nos FIN_PAY_NOSTRO,CASE WHEN trim(SI_FLOW_PAY_NOSTRO) = trim(pay_nos) THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_NOSTRO,
SI_FLOW_REC_NOSTRO OPICS_REC_NOSTRO,rec_nos FIN_REC_NOSTRO,CASE WHEN   trim(SI_FLOW_REC_NOSTRO) = trim(rec_nos) THEN 'TRUE' ELSE 'FALSE' END MATCH_REC_NOSTRO,
SEC_DEAL.DEAL_IDENTIFIER ||'-'||replace(SEC_DEAL.SEC_DEFN_NAME,'  ',' ') ||'-'||SEC_DEAL.SUBTYPE ||'-'||TRIM(SEC_DEAL.COUNTERPARTY_STRING) ||'-'||TO_DATE(SEC_DEAL.DEAL_DATE,'DD-MM-YYYY') ||'-'||SEC_DEAL.BUY_OR_SELL ||'-'||
SEC_D.ISSUE_CCY ||'-'||ROUND(SEC_DEAL.PRICE_STRING,5) ||'-'||SEC_DEAL.QTY_TRADED OPICS_DATA,
SECDEAL.DEAL_IDENTIFIER ||'-'||replace(SECD.NAME,'  ',' ')  ||'-'||SDSBTY.NAME ||'-'||trim(SDCP.NAME )||'-'||SECDEAL.DEAL_DATE||'-'||CASE WHEN SECDEAL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END||'-'||SECDEAL.SETTLEMENT_CCY ||'-'||
ROUND(REPLACE(SECDEAL.PRICE,',',''),5) ||'-'||abs(SECDEAL.QTY_TRADED) FIN_DATA,
CASE WHEN SEC_DEAL.DEAL_IDENTIFIER ||'-'||replace(SEC_DEAL.SEC_DEFN_NAME,'  ',' ') ||'-'||SEC_DEAL.SUBTYPE ||'-'||TRIM(SEC_DEAL.COUNTERPARTY_STRING) ||'-'||TO_DATE(SEC_DEAL.DEAL_DATE,'DD-MM-YYYY') ||'-'||SEC_DEAL.BUY_OR_SELL ||'-'||
SEC_D.ISSUE_CCY ||'-'||ROUND(SEC_DEAL.PRICE_STRING,5) ||'-'||SEC_DEAL.QTY_TRADED=
SECDEAL.DEAL_IDENTIFIER ||'-'||replace(SECD.NAME,'  ',' ')  ||'-'||SDSBTY.NAME ||'-'||trim(SDCP.NAME) ||'-'||SECDEAL.DEAL_DATE||'-'||CASE WHEN SECDEAL.BUY_OR_SELL='B' THEN 'BUY' ELSE 'SELL' END||'-'||SECDEAL.SETTLEMENT_CCY ||'-'||
ROUND(REPLACE(SECDEAL.PRICE,',',''),5) ||'-'||abs(SECDEAL.QTY_TRADED) THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM SEC_BUY_SELL_O_TABLE SEC_DEAL
LEFT JOIN SECURITY_DEFN_O_TABLE SEC_D ON SEC_D.NAME = SEC_DEAL.SEC_DEFN_NAME
LEFT JOIN TT_SEC_BS@FTMIG SECDEAL ON  SECDEAL.DEAL_IDENTIFIER like SEC_DEAL.DEAL_IDENTIFIER||'%'and DEAL_STATE!='DLTD'
LEFT JOIN SD_SEC_DEFN@FTMIG SECD ON SECD.FBO_ID_NUM = SECDEAL.SEC_DEFN_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = SECDEAL.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = SECDEAL.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= SECDEAL.CPTY_FBO_ID_NUM
left join (
  SELECT distinct a.PARENT_FBO_ID_NUM,a.PARENT_FBO_ID_TYPE,A.IQ_CURRENCY PAY_CCY,a.NAME pay_nos ,B.IQ_CURRENCY REC_CCY,b.NAME rec_nos  FROM (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT' and PARENT_FBO_ID_VER='999999') A
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT'and PARENT_FBO_ID_VER='999999') B ON A.PARENT_FBO_ID_TYPE = B.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM
  ) NOS on NOS.PARENT_FBO_ID_NUM = SECDEAL.DEAL_NUM 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
security_defn_flows_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
security_defn_flows_report.sql 
--ALL CASH FLOWS
select 
secid OPICS_SECID,name FIN_DEAL_SECID,CASE WHEN trim(secid) = trim(name) THEN 'TRUE' ELSE 'FALSE' END MATCH_secid,
seq OPICS_SCHEDULE_SEQ,SIDE_SEQUENCE FIN_SCHEDULE_SEQ,CASE WHEN TO_NUMBER(seq) = SIDE_SEQUENCE THEN 'TRUE' ELSE 'FALSE' END MATCH_SEQUENCE,
--INTCCY OPICS_CCY,NOTIONAL_AMOUNT_CCY FIN_CCY,CASE WHEN INTCCY = NOTIONAL_AMOUNT_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
INTSTRTDTE OPICS_START_DATE ,fin_flow.START_DATE FIN_START_DATE ,CASE WHEN INTSTRTDTE = fin_flow.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
INTENDDTE OPICS_END_DATE,fin_flow.END_DATE FIN_END_DATE,CASE WHEN INTENDDTE = fin_flow.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
RATECODE OPICS_RATECODE,RATE_CODE FIN_RATECODE,CASE WHEN nvl(RATECODE,' ') = nvl(RATE_CODE,' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE_CODE,
INTRATE_8 OPICS_INTRATE,NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) FIN_INTRATE,CASE WHEN INTRATE_8 = NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) THEN 'TRUE' ELSE 'FALSE' END MATCH_INTRATE,
SPREADRATE_8 OPICS_SPREAD_RATE ,fin_flow.SPREAD_RATE*100 FIN_SPREAD_RATE,CASE WHEN to_number(SPREADRATE_8) = NVL(fin_flow.SPREAD_RATE*100,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPREAD_RATE
 from SECS
left join SD_SEC_DEFN@ftmig on trim(secid) = trim(name) 
left join (select reset_date,REFERENCE_RATE_FBO_ID_NUM,CASH_FLOW_TYPE,parent_fbo_id_num,BASIS_CODE,START_DATE,END_DATE,NOTIONAL_AMOUNT_CCY,NOTIONAL_AMOUNT_VALUE,SPREAD_RATE,
MARGIN,FIX_RATE,SIDE_SEQUENCE,PARENT_FBO_ID_VER from  TT_SECDEFN_CASH_FLOWS@ftmig) fin_flow on PARENT_FBO_ID_NUM  = SD_SEC_DEFN.FBO_ID_NUM and PARENT_FBO_ID_VER='999999' and SIDE_SEQUENCE = to_number(seq)
LEFT JOIN (
SELECT  A.REF_RATE_FBO_ID_NUM,RATE_CODE,RATE_CCY,RATE_VALUE,EFFECTIVE_DATE FROM SD_REF_RATE_VALUE@FTMIG A
LEFT JOIN SD_REF_RATE@FTMIG B ON B.FBO_ID_NUM = A.REF_RATE_FBO_ID_NUM
) REF_RATE ON REF_RATE.REF_RATE_FBO_ID_NUM = REFERENCE_RATE_FBO_ID_NUM AND reset_date = EFFECTIVE_DATE
where TRIM(secid) IN(SELECT TRIM(name) FROM SECURITY_DEFN_O_TABLE)
order by secid,to_number(seq)

--CURRENT CASH FLOWS
select 
secid OPICS_SECID,name FIN_DEAL_SECID,CASE WHEN trim(secid) = trim(name) THEN 'TRUE' ELSE 'FALSE' END MATCH_secid,
seq OPICS_SCHEDULE_SEQ,SIDE_SEQUENCE FIN_SCHEDULE_SEQ,CASE WHEN TO_NUMBER(seq) = SIDE_SEQUENCE THEN 'TRUE' ELSE 'FALSE' END MATCH_SEQUENCE,
--INTCCY OPICS_CCY,NOTIONAL_AMOUNT_CCY FIN_CCY,CASE WHEN INTCCY = NOTIONAL_AMOUNT_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
INTSTRTDTE OPICS_START_DATE ,fin_flow.START_DATE FIN_START_DATE ,CASE WHEN INTSTRTDTE = fin_flow.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
INTENDDTE OPICS_END_DATE,fin_flow.END_DATE FIN_END_DATE,CASE WHEN INTENDDTE = fin_flow.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
RATECODE OPICS_RATECODE,RATE_CODE FIN_RATECODE,CASE WHEN nvl(RATECODE,' ') = nvl(RATE_CODE,' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE_CODE,
INTRATE_8 OPICS_INTRATE,NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) FIN_INTRATE,CASE WHEN INTRATE_8 = NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) THEN 'TRUE' ELSE 'FALSE' END MATCH_INTRATE,
SPREADRATE_8 OPICS_SPREAD_RATE ,fin_flow.SPREAD_RATE*100 FIN_SPREAD_RATE,CASE WHEN to_number(SPREADRATE_8) = NVL(fin_flow.SPREAD_RATE*100,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPREAD_RATE
 from SECS
left join SD_SEC_DEFN@ftmig on trim(secid) = trim(name) 
left join (select reset_date,REFERENCE_RATE_FBO_ID_NUM,CASH_FLOW_TYPE,parent_fbo_id_num,BASIS_CODE,START_DATE,END_DATE,NOTIONAL_AMOUNT_CCY,NOTIONAL_AMOUNT_VALUE,SPREAD_RATE,
MARGIN,FIX_RATE,SIDE_SEQUENCE,PARENT_FBO_ID_VER from  TT_SECDEFN_CASH_FLOWS@ftmig) fin_flow on PARENT_FBO_ID_NUM  = SD_SEC_DEFN.FBO_ID_NUM and PARENT_FBO_ID_VER='999999' and SIDE_SEQUENCE = to_number(seq)
LEFT JOIN (
SELECT  A.REF_RATE_FBO_ID_NUM,RATE_CODE,RATE_CCY,RATE_VALUE,EFFECTIVE_DATE FROM SD_REF_RATE_VALUE@FTMIG A
LEFT JOIN SD_REF_RATE@FTMIG B ON B.FBO_ID_NUM = A.REF_RATE_FBO_ID_NUM
) REF_RATE ON REF_RATE.REF_RATE_FBO_ID_NUM = REFERENCE_RATE_FBO_ID_NUM AND reset_date = EFFECTIVE_DATE
where TRIM(secid) IN(SELECT TRIM(name) FROM SECURITY_DEFN_O_TABLE)
AND INTSTRTDTE <= TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND  INTENDDTE > TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY')
order by secid,to_number(seq) 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
security_defn_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
security_defn_report.sql 
select S.SECID OPICS_SECID, SEDF.DESCRIPTION FINACLE_DESCRIPTION, CASE WHEN TRIM(S.SECID) = TRIM(SEDF.DESCRIPTION) THEN 'TRUE' ELSE 'FALSE' END MATCH_SECID, 
S.CCY OPICS_ISSUE_CCY,SEDF.ISSUE_CCY FINACLE_ISSUE_CCY,CASE WHEN TRIM(S.CCY) = TRIM(SEDF.ISSUE_CCY) THEN 'TRUE' ELSE 'FALSE' END MATCH_ISSUE_CCY, 
PRODTYPE OPICS_PRODTYPE,TYPE FINACLE_A_TYPE,
PRODTYPE OPICS_PRODTYPE ,SEDF.SECURITY_TYPE FINACLE_SECURITY_TYPE,
BASIS OPICS_BASIS,SEDF.YIELD_BASIS FINACLE_YIELD_BASIS,
BASIS OPICS_BASIS,SEDF.EFFECTIVE_YIELD_BASIS FINACLE_EFFECTIVE_YIELD_BASIS,
DESCR OPICS_DESCR ,SEDF.ALT_ID1 FINACLE_ALT_ID1,CASE WHEN TRIM(DESCR) = TRIM(SEDF.ALT_ID1) THEN 'TRUE' ELSE 'FALSE' END MATCH_DESCR,
ISSDATE OPICS_ISSDATE ,SEDF.ISSUE_DATE FINACLE_ISSUE_DATE ,CASE WHEN ISSDATE = SEDF.ISSUE_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_ISSUE_DATE,
MDATE OPICS_MDATE,SEDF.MATURITY_DATE FINACLE_MATURITY_DATE,CASE WHEN MDATE = SEDF.MATURITY_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_MATURITY_DATE,
--RATECODE SIDE_$1_CASH_FLOW_SIDE_TYPE,--
--RATECODE,COUPRATE_8 SIDE_$1_FIX_RATE,--
--RATECODE SIDE_$1_REFERENCE_RATE,--
PARAMT OPICS_PARAMT,PARAMT FINACLE_REDEMPTION_VALUE,CASE WHEN PARAMT = PARAMT THEN 'TRUE' ELSE 'FALSE' END MATCH_REDEMPTION_VALUE,
C.CMNE OPICS_CMNE,CPTY.MNEMONIC ISSUER_STRING,CASE WHEN trim(C.CMNE) = trim(CPTY.MNEMONIC) THEN 'TRUE' ELSE 'FALSE' END MATCH_ISSUER_STRING,
MDATE OPICS_MDATE,SEDF.ACTIVE_STATUS FINACLE_ACTIVE_STATUS,
DENOM OPICS_DENOM,SEDF.MINIMUM_AMOUNT,CASE WHEN DENOM = SEDF.MINIMUM_AMOUNT THEN 'TRUE' ELSE 'FALSE' END MATCH_MINIMUM_AMOUNT,
DENOM OPICS_MDATE ,SEDF.QTY_MULTIPLE FINACLE_QTY_MULTIPLE,CASE WHEN DENOM = SEDF.QTY_MULTIPLE THEN 'TRUE' ELSE 'FALSE' END MATCH_QTY_MULTIPLE,
SECID OPICS_SECID ,SEDF.AMORT_APPLICABILITY FINACLE_AMORT_APPLICABILITY,
PARAMT OPICS_PARAMT,SEDF.ISSUE_PRICE FINACLE_ISSUE_PRICE ,CASE WHEN PARAMT =SEDF.ISSUE_PRICE  THEN 'TRUE' ELSE 'FALSE' END MATCH_ISSUE_PRICE,
PARAMT OPICS_PARAMT,SEDF.ISSUANCE_FACE FINACLE_ISSUANCE_FACE,CASE WHEN PARAMT =SEDF.ISSUANCE_FACE  THEN 'TRUE' ELSE 'FALSE' END MATCH_ISSUANCE_FACE,
PRICEDECS OPICS_PRICEDECS,SEDF.PRICE_ROUNDING_DIGITS FINACLE_PRICE_ROUNDING_DIGITS,CASE WHEN PRICEDECS =SEDF.PRICE_ROUNDING_DIGITS  THEN 'TRUE' ELSE 'FALSE' END MATCH_PRICE_ROUNDING_DIGITS,
CCY OPICS_CCY,SEDF.SETTLEMENT_CALENDAR_SET FIN_SETTLEMENT_CALENDAR_SET,CASE WHEN CCY =SEDF.SETTLEMENT_CALENDAR_SET  THEN 'TRUE' ELSE 'FALSE' END MATCH_SETTLEMENT_CALENDAR_SET,
SETTCCY OPICS_SETTCCY,SEDF.INDEX_SETT_CCY FINACLE_INDEX_SETT_CCY,CASE WHEN SETTCCY =SEDF.INDEX_SETT_CCY  THEN 'TRUE' ELSE 'FALSE' END MATCH_INDEX_SETT_CCY
FROM SECM S
INNER JOIN CUST C ON TRIM(S.ISSUER)=TRIM(C.CNO)
LEFT JOIN FTABKBPD.SD_SEC_DEFN@FTFC SEDF ON TRIM(SEDF.DESCRIPTION) = TRIM(S.SECID)
LEFT JOIN FTABKBPD.SD_CPTY@FTFC CPTY ON CPTY.FBO_ID_NUM=SEDF.ISSUER_FBO_ID_NUM
WHERE S.PRODTYPE IN ('F1','F2','FI','SB','TB') AND S.MDATE > TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY');



select 
replace(trim(SEC_DEF.NAME),'  ',' ') ||'-'||SEC_DEF.ISSUE_CCY||'-'||A_TYPE||'-'||TRIM(SEC_DEF.YIELD_BASIS)||'-'||to_date(SEC_DEF.ISSUE_DATE,'dd-mon-yyyy')||'-'||
to_date(SEC_DEF.MATURITY_DATE,'dd-mon-yyyy')||'-'||TRIM(ISSUER_STRING)||'-'||TRIM(SEC_DEF.MINIMUM_AMOUNT)||'-'||TRIM(SEC_DEF.QTY_MULTIPLE)||'-'||TRIM(SEC_DEF.ISSUE_PRICE) OPICS_DATA,
 replace(TRIM(EQDN.NAME),'  ',' ')||'-'|| EQDN.ISSUE_CCY||'-'|| EQDN.TYPE||'-'|| EQDN.YIELD_BASIS||'-'||EQDN.ISSUE_DATE||'-'||EQDN.MATURITY_DATE||'-'||SDCP.NAME||'-'||EQDN.MINIMUM_AMOUNT||'-'||
EQDN.QTY_MULTIPLE||'-'||EQDN.ISSUE_PRICE FIN_DATA,
CASE WHEN replace(trim(SEC_DEF.NAME),'  ',' ') ||'-'||SEC_DEF.ISSUE_CCY||'-'||A_TYPE||'-'||TRIM(SEC_DEF.YIELD_BASIS)||'-'||to_date(SEC_DEF.ISSUE_DATE,'dd-mon-yyyy')||'-'||
to_date(SEC_DEF.MATURITY_DATE,'dd-mon-yyyy')||'-'||TRIM(ISSUER_STRING)||'-'||TRIM(SEC_DEF.MINIMUM_AMOUNT)||'-'||TRIM(SEC_DEF.QTY_MULTIPLE)||'-'||TRIM(SEC_DEF.ISSUE_PRICE) =   replace(TRIM(EQDN.NAME),'  ',' ')||'-'|| EQDN.ISSUE_CCY||'-'|| EQDN.TYPE||'-'|| EQDN.YIELD_BASIS||'-'||EQDN.ISSUE_DATE||'-'||EQDN.MATURITY_DATE||'-'||SDCP.NAME||'-'||EQDN.MINIMUM_AMOUNT||'-'||
EQDN.QTY_MULTIPLE||'-'||EQDN.ISSUE_PRICE THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
  from SECURITY_DEFN_O_TABLE SEC_DEF
LEFT JOIN SD_SEC_DEFN@ftmig EQDN ON replace(SEC_DEF.NAME,'  ',' ') =replace( TRIM(EQDN.NAME),'  ',' ')
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= EQDN.ISSUER_FBO_ID_NUM;


select 
replace(trim(SEC_DEF.NAME),'  ',' ') ||'-'||SEC_DEF.ISSUE_CCY||'-'||A_TYPE||'-'||to_date(SEC_DEF.ISSUE_DATE,'dd-mon-yyyy')||'-'||
to_date(SEC_DEF.MATURITY_DATE,'dd-mon-yyyy')||'-'||TRIM(ISSUER_STRING)||'-'||TRIM(SEC_DEF.MINIMUM_AMOUNT)||'-'||TRIM(SEC_DEF.QTY_MULTIPLE)||'-'||TRIM(SEC_DEF.ISSUE_PRICE) OPICS_DATA,
 replace(TRIM(EQDN.NAME),'  ',' ')||'-'|| EQDN.ISSUE_CCY||'-'|| EQDN.TYPE||'-'||EQDN.ISSUE_DATE||'-'||EQDN.MATURITY_DATE||'-'||trim(SDCP.NAME)||'-'||EQDN.MINIMUM_AMOUNT||'-'||
EQDN.QTY_MULTIPLE||'-'||EQDN.ISSUE_PRICE FIN_DATA,
CASE WHEN replace(trim(SEC_DEF.NAME),'  ',' ') ||'-'||SEC_DEF.ISSUE_CCY||'-'||A_TYPE||'-'||to_date(SEC_DEF.ISSUE_DATE,'dd-mon-yyyy')||'-'||
to_date(SEC_DEF.MATURITY_DATE,'dd-mon-yyyy')||'-'||TRIM(ISSUER_STRING)||'-'||TRIM(SEC_DEF.MINIMUM_AMOUNT)||'-'||TRIM(SEC_DEF.QTY_MULTIPLE)||'-'||TRIM(SEC_DEF.ISSUE_PRICE) =   replace(TRIM(EQDN.NAME),'  ',' ')||'-'|| EQDN.ISSUE_CCY||'-'|| EQDN.TYPE||'-'||EQDN.ISSUE_DATE||'-'||EQDN.MATURITY_DATE||'-'||trim(SDCP.NAME)||'-'||EQDN.MINIMUM_AMOUNT||'-'||
EQDN.QTY_MULTIPLE||'-'||EQDN.ISSUE_PRICE THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
  from SECURITY_DEFN_O_TABLE SEC_DEF
LEFT JOIN SD_SEC_DEFN@ftmig EQDN ON replace(SEC_DEF.NAME,'  ',' ') =replace( TRIM(EQDN.NAME),'  ',' ')
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= EQDN.ISSUER_FBO_ID_NUM



select 
TRIM(SEC_DEF.NAME) OPICS_SECID ,EQDN.NAME FIN_SECID,CASE WHEN TRIM(SEC_DEF.NAME) = EQDN.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SECID,
SEC_DEF.A_TYPE MAPPED_INSTRUMENT_TYPE ,EQDN.TYPE FIN_INSTRUMENT_TYPE,CASE WHEN SEC_DEF.A_TYPE  = EQDN.TYPE THEN 'TRUE' ELSE 'FALSE' END MATCH_INSTRUMENT_TYPE,
INSTRUMENT_CLASS_DATA_NAME MAPPED_NSTRUMENT_CLASS ,INCL.NAME FIN_NSTRUMENT_CLASS ,CASE WHEN INSTRUMENT_CLASS_DATA_NAME = INCL.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_NSTRUMENT_CLASS,
SEC_DEF.ISSUE_CCY OPICS_CCY,EQDN.ISSUE_CCY FIN_CCY,CASE WHEN SEC_DEF.ISSUE_CCY = EQDN.ISSUE_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
TRIM(ISSUER_STRING) OPICS_CPTY,trim(SDCP.NAME) FIN_CPTY,CASE WHEN TRIM(ISSUER_STRING) = trim(SDCP.NAME)THEN 'TRUE' ELSE 'FALSE' END MATCH_CPTY,
to_date(SEC_DEF.ISSUE_DATE,'dd-mon-yyyy') OPICS_ISSUE_DATE,EQDN.ISSUE_DATE FIN_ISSUE_DATE,CASE WHEN to_date(SEC_DEF.ISSUE_DATE,'dd-mon-yyyy') = EQDN.ISSUE_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_ISSUE_DATE,
to_date(SEC_DEF.MATURITY_DATE,'dd-mon-yyyy') OPICS_MATURITY_DATE,EQDN.MATURITY_DATE FIN_MATURITY_DATE,CASE WHEN to_date(SEC_DEF.MATURITY_DATE,'dd-mon-yyyy') = EQDN.MATURITY_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_MATURITY_DATE,
SEC_DEF.MINIMUM_AMOUNT OPICS_MINIMUM_AMOUNT,EQDN.MINIMUM_AMOUNT FIN_MINIMUM_AMOUNT,CASE WHEN SEC_DEF.MINIMUM_AMOUNT = EQDN.MINIMUM_AMOUNT THEN 'TRUE' ELSE 'FALSE' END MATCH_MINIMUM_AMOUNT,
SEC_DEF.QTY_MULTIPLE OPICS_MINIMUM_AMOUNT,EQDN.QTY_MULTIPLE FIN_QTY_MULTIPLE,CASE WHEN SEC_DEF.QTY_MULTIPLE = EQDN.QTY_MULTIPLE THEN 'TRUE' ELSE 'FALSE' END MATCH_QTY_MULTIPLE,
replace(trim(SEC_DEF.NAME),'  ',' ') ||'-'||SEC_DEF.ISSUE_CCY||'-'||A_TYPE||'-'||to_date(SEC_DEF.ISSUE_DATE,'dd-mon-yyyy')||'-'||
to_date(SEC_DEF.MATURITY_DATE,'dd-mon-yyyy')||'-'||TRIM(ISSUER_STRING)||'-'||TRIM(SEC_DEF.MINIMUM_AMOUNT)||'-'||TRIM(SEC_DEF.QTY_MULTIPLE)||'-'||TRIM(SEC_DEF.ISSUE_PRICE) OPICS_DATA,
 replace(TRIM(EQDN.NAME),'  ',' ')||'-'|| EQDN.ISSUE_CCY||'-'|| EQDN.TYPE||'-'||EQDN.ISSUE_DATE||'-'||EQDN.MATURITY_DATE||'-'||trim(SDCP.NAME)||'-'||EQDN.MINIMUM_AMOUNT||'-'||
EQDN.QTY_MULTIPLE||'-'||EQDN.ISSUE_PRICE FIN_DATA,
CASE WHEN replace(trim(SEC_DEF.NAME),'  ',' ') ||'-'||SEC_DEF.ISSUE_CCY||'-'||A_TYPE||'-'||to_date(SEC_DEF.ISSUE_DATE,'dd-mon-yyyy')||'-'||
to_date(SEC_DEF.MATURITY_DATE,'dd-mon-yyyy')||'-'||TRIM(ISSUER_STRING)||'-'||TRIM(SEC_DEF.MINIMUM_AMOUNT)||'-'||TRIM(SEC_DEF.QTY_MULTIPLE)||'-'||TRIM(SEC_DEF.ISSUE_PRICE) =  
 replace(TRIM(EQDN.NAME),'  ',' ')||'-'|| EQDN.ISSUE_CCY||'-'|| EQDN.TYPE||'-'||EQDN.ISSUE_DATE||'-'||EQDN.MATURITY_DATE||'-'||trim(SDCP.NAME)||'-'||EQDN.MINIMUM_AMOUNT||'-'||
EQDN.QTY_MULTIPLE||'-'||EQDN.ISSUE_PRICE THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
  from SECURITY_DEFN_O_TABLE SEC_DEF
LEFT JOIN SD_SEC_DEFN@ftmig EQDN ON replace(SEC_DEF.NAME,'  ',' ') =replace( TRIM(EQDN.NAME),'  ',' ')
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= EQDN.ISSUER_FBO_ID_NUM
LEFT JOIN SD_INSTRUMENT_CLASS@FTMIG  INCL ON INCL.FBO_ID_NUM = INSTRUMENT_CLASS_FBO_ID_NUM 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
security_price_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
security_price_report.sql 
select SECURITY OPICS_SECID,NAME FIN_SECID, CASE WHEN TRIM(SECURITY) =TRIM(NAME) THEN 'TRUE' ELSE 'FALSE' END MATCH_SECID,
BID OPICS_BIC_RATE,BID_RATE FIN_BID_RATE, CASE WHEN TRIM(BID) =TRIM(BID_RATE) THEN 'TRUE' ELSE 'FALSE' END MATCH_BID_RATE,
OFFER OPICS_OFFER_RATE,OFFER_RATE FIN_OFFER_RATE, CASE WHEN TRIM(OFFER) =TRIM(OFFER_RATE) THEN 'TRUE' ELSE 'FALSE' END MATCH_OFFER_RATE,
TO_DATE(BASE_DATE,'dd-Mon-yyyy') OPICS_BASE_DATE,FIN_BASE_DATE , CASE WHEN TO_DATE(BASE_DATE,'dd-Mon-yyyy') =TRIM(FIN_BASE_DATE) THEN 'TRUE' ELSE 'FALSE' END MATCH_BASE_DATE
 from SECURITY_PRICES_O_TABLE a
left join(
select a.NAME,BID_RATE,OFFER_RATE,c.BASE_DATE FIN_BASE_DATE from SD_SEC_DEFN@ftmig a
inner join MRS_SECURITY_PRICES@ftmig b on a.FBO_ID_NUM = b.SEC_DEFN_FBO_ID_NUM
inner join MRS_NAMES@ftmig c on c.NAME = b.NAME
) b on trim(a.SECURITY) = trim(b.NAME) 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
spot_position_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
spot_position_report.sql 
SELECT A.DEAL_DATE LEG_DEALDATE,B.DEAL_DATE FINACLE_DEAL_DATE ,CASE WHEN TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY') = B.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALDATE,
MAIN_LEG_CCY_PAIR LEG_CURRENCY_PAIR,CURRENCY_PAIR FIN_CURRENCY_PAIR,CASE WHEN MAIN_LEG_CCY_PAIR = CURRENCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CURRENCY_PAIR,
ABS( B. CCY_ONE_AMOUNT_VALUE) LEG_AMOUNT,to_number(MAIN_LEG_CCY_ONE_AMOUNT) FIN_AMOUNT,CASE WHEN ABS( B. CCY_ONE_AMOUNT_VALUE) = MAIN_LEG_CCY_ONE_AMOUNT THEN 'TRUE' ELSE 'FALSE' END MATCH_AMOUNT,
CASE WHEN MAIN_LEG_CCY_PAIR LIKE '%JPY%' THEN ROUND(to_number(MARKET_SPOT_RATE),8)  ELSE  ROUND(to_number(MARKET_SPOT_RATE),8) END LEG_SPOT_RATE,ROUND(RATE,8) FIN_SPOT_RATE,
CASE WHEN CASE WHEN MAIN_LEG_CCY_PAIR LIKE '%JPY%' THEN ROUND(to_number(MARKET_SPOT_RATE),8)  ELSE  ROUND(to_number(MARKET_SPOT_RATE),8) END = ROUND(RATE,8) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPOT_RATE,
MEMO_FIELD_1 LEG_BRANCH,MEMO_FIELD0 FIN_BRANCH,CASE WHEN MEMO_FIELD_1 = MEMO_FIELD0 THEN 'TRUE' ELSE 'FALSE' END MATCH_BRANCH,
DEAL_NUM FIN_DEAL_NUM
FROM SPOT_POSITION_DEALS_O_TABLE A
INNER JOIN(
SELECT FIN_FX_OUTRIGHT.DEAL_NUM,FIN_FX_OUTRIGHT.DEAL_TYPE,TTFXFL.CCY_ONE_AMOUNT_VALUE,CURRENCY_PAIR,DEAL_DATE ,CASE WHEN FX_BUY_SELL='B' THEN 'BUY' ELSE 'SELL' END BUY_SELL,TTFXFL.RATE,MEMO_FIELD0 FROM 
TT_FXP_DEAL@FTFC FIN_FX_OUTRIGHT
LEFT JOIN SD_TRADING_BOOK@FTFC SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTFC SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTFC SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTFC TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM
LEFT JOIN TT_FXP_LEG@FTFC TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
WHERE  FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD' AND FIN_FX_OUTRIGHT.DEAL_NUM = FIN_FX_OUTRIGHT.DEAL_IDENTIFIER
) B
ON B.CURRENCY_PAIR = A.MAIN_LEG_CCY_PAIR AND BUY_SELL = MAIN_LEG_FX_BUY_SELL AND ABS( B. CCY_ONE_AMOUNT_VALUE) = MAIN_LEG_CCY_ONE_AMOUNT



SELECT A.DEAL_DATE LEG_DEALDATE,B.DEAL_DATE FINACLE_DEAL_DATE ,CASE WHEN TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY') = B.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALDATE,
MAIN_LEG_CCY_PAIR LEG_CURRENCY_PAIR,CCY1_CALENDAR_SET||'/'||CCY2_CALENDAR_SET FIN_CURRENCY_PAIR,CASE WHEN MAIN_LEG_CCY_PAIR = CURRENCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CURRENCY_PAIR,
to_number(MAIN_LEG_CCY_ONE_AMOUNT) LEG_AMOUNT,ABS( B. CCY_ONE_AMOUNT_VALUE) FIN_AMOUNT,CASE WHEN ABS( B. CCY_ONE_AMOUNT_VALUE) = MAIN_LEG_CCY_ONE_AMOUNT THEN 'TRUE' ELSE 'FALSE' END MATCH_AMOUNT,
CASE WHEN MAIN_LEG_CCY_PAIR LIKE '%JPY%' THEN ROUND(to_number(MARKET_SPOT_RATE),8)  ELSE  ROUND(to_number(MARKET_SPOT_RATE),8) END LEG_SPOT_RATE,ROUND(RATE,8) FIN_SPOT_RATE,
CASE WHEN CASE WHEN MAIN_LEG_CCY_PAIR LIKE '%JPY%' THEN ROUND(to_number(MARKET_SPOT_RATE),8)  ELSE  ROUND(to_number(MARKET_SPOT_RATE),8) END = ROUND(RATE,8) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPOT_RATE,
MEMO_FIELD_1 LEG_BRANCH,MEMO_FIELD0 FIN_BRANCH,CASE WHEN MEMO_FIELD_1 = MEMO_FIELD0 THEN 'TRUE' ELSE 'FALSE' END MATCH_BRANCH,
DEAL_NUM FIN_DEAL_NUM
FROM SPOT_POSITION_DEALS_O_TABLE A
left JOIN(
SELECT CCY1_CALENDAR_SET,CCY2_CALENDAR_SET,FIN_FX_OUTRIGHT.DEAL_NUM,FIN_FX_OUTRIGHT.DEAL_TYPE,TTFXFL.CCY_ONE_AMOUNT_VALUE,CURRENCY_PAIR,DEAL_DATE ,CASE WHEN FX_BUY_SELL='B' THEN 'BUY' ELSE 'SELL' END BUY_SELL,TTFXFL.RATE,MEMO_FIELD0 FROM 
TT_FXP_DEAL@FTFC FIN_FX_OUTRIGHT
LEFT JOIN SD_TRADING_BOOK@FTFC SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTFC SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTFC SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTFC TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM
LEFT JOIN TT_FXP_LEG@FTFC TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
WHERE  FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD' AND FIN_FX_OUTRIGHT.DEAL_NUM = FIN_FX_OUTRIGHT.DEAL_IDENTIFIER
) B
ON CCY1_CALENDAR_SET||'/'||CCY2_CALENDAR_SET  = trim(A.MAIN_LEG_CCY_PAIR) AND trim(BUY_SELL) = trim(MAIN_LEG_FX_BUY_SELL) and trim(MEMO_FIELD0) = trim(MEMO_FIELD_1)




SELECT CCY_PAIR,A.DEAL_DATE LEG_DEALDATE,B.DEAL_DATE FINACLE_DEAL_DATE ,CASE WHEN TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY') = B.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALDATE,
MAIN_LEG_CCY_PAIR LEG_CURRENCY_PAIR,QUOTED_CCY_PAIR FIN_CURRENCY_PAIR,CASE WHEN MAIN_LEG_CCY_PAIR = CURRENCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CURRENCY_PAIR,
to_number(MAIN_LEG_CCY_ONE_AMOUNT) LEG_AMOUNT,ABS( B. CCY_ONE_AMOUNT_VALUE) FIN_AMOUNT,CASE WHEN ABS( B. CCY_ONE_AMOUNT_VALUE) = MAIN_LEG_CCY_ONE_AMOUNT THEN 'TRUE' ELSE 'FALSE' END MATCH_AMOUNT,
 to_char(to_number(MARKET_SPOT_RATE),'9990.999999') LEG_SPOT_RATE,to_char(ROUND(RATE,6),'9990.999999') FIN_SPOT_RATE,
CASE WHEN  to_char(to_number(MARKET_SPOT_RATE),'9990.999999') = to_char(ROUND(RATE,6),'9990.999999') THEN 'TRUE' ELSE 'FALSE' END MATCH_SPOT_RATE,
MEMO_FIELD_1 LEG_BRANCH,MEMO_FIELD0 FIN_BRANCH,CASE WHEN MEMO_FIELD_1 = MEMO_FIELD0 THEN 'TRUE' ELSE 'FALSE' END MATCH_BRANCH,
DEAL_NUM FIN_DEAL_NUM
FROM SPOT_POSITION_DEALS_O_TABLE A
left JOIN(
SELECT CCY_PAIR,CCY1_CALENDAR_SET,CCY2_CALENDAR_SET,FIN_FX_OUTRIGHT.DEAL_NUM,FIN_FX_OUTRIGHT.DEAL_TYPE,
case when CCY_PAIR =QUOTED_CCY_PAIR  then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end CCY_ONE_AMOUNT_VALUE,CURRENCY_PAIR,QUOTED_CCY_PAIR,DEAL_DATE ,
CASE WHEN CCY_PAIR =QUOTED_CCY_PAIR and FX_BUY_SELL='B' THEN 'BUY'  
WHEN CCY_PAIR =QUOTED_CCY_PAIR and FX_BUY_SELL='S' THEN 'SELL' 
WHEN CCY_PAIR !=QUOTED_CCY_PAIR and FX_BUY_SELL='S' THEN 'BUY'
WHEN CCY_PAIR !=QUOTED_CCY_PAIR and FX_BUY_SELL='B' THEN 'SELL'
END BUY_SELL,case when CCY_PAIR =QUOTED_CCY_PAIR then TTFXL.MARKET_SPOT_RATE else 1/TTFXL.MARKET_SPOT_RATE end RATE,MEMO_FIELD0 FROM 
TT_FXP_DEAL@ftuat FIN_FX_OUTRIGHT
LEFT JOIN SD_TRADING_BOOK@ftuat SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@ftuat SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@ftuat SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@ftuat SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@ftuat TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM
LEFT JOIN TT_FXP_LEG@ftuat TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
WHERE  FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD' AND FIN_FX_OUTRIGHT.DEAL_NUM = FIN_FX_OUTRIGHT.DEAL_IDENTIFIER and  MEMO_FIELD0='KUWAIT'
) B
ON QUOTED_CCY_PAIR = trim(A.MAIN_LEG_CCY_PAIR)
 AND trim(BUY_SELL) = trim(MAIN_LEG_FX_BUY_SELL) and 
trim(MEMO_FIELD0) = trim(MEMO_FIELD_1)








SELECT DISTINCT 
TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY')||'-'||MAIN_LEG_CCY_PAIR||'-'||ABS(MAIN_LEG_CCY_ONE_AMOUNT)||'-'|| to_char(to_number(MARKET_SPOT_RATE),'9990.999999')||'-'|| MEMO_FIELD_1 OPICS_DATA,
 B.DEAL_DATE||'-'||CCY_PAIR ||'-'||MAIN_LEG_CCY_ONE_AMOUNT||'-'||CASE WHEN CCY_PAIR='JPY/KWD' THEN to_char(ROUND(RATE*100,6),'9990.999999') ELSE to_char(ROUND(RATE,6),'9990.999999') END||'-'||MEMO_FIELD0  FIN_DATA,
CASE WHEN TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY')||'-'||MAIN_LEG_CCY_PAIR||'-'||ABS(MAIN_LEG_CCY_ONE_AMOUNT)||'-'|| to_char(to_number(MARKET_SPOT_RATE),'9990.999999')||'-'|| MEMO_FIELD_1=
B.DEAL_DATE||'-'||CCY_PAIR ||'-'||MAIN_LEG_CCY_ONE_AMOUNT||'-'||CASE WHEN CCY_PAIR='JPY/KWD' THEN to_char(ROUND(RATE*100,6),'9990.999999') ELSE to_char(ROUND(RATE,6),'9990.999999') END||'-'||MEMO_FIELD0 THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM SPOT_POSITION_DEALS_O_TABLE A
left JOIN(SELECT CCY_PAIR,CCY1_CALENDAR_SET,CCY2_CALENDAR_SET,FIN_FX_OUTRIGHT.DEAL_NUM,FIN_FX_OUTRIGHT.DEAL_TYPE,
case when CCY_PAIR =CURRENCY_PAIR  then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end CCY_ONE_AMOUNT_VALUE,CURRENCY_PAIR,DEAL_DATE ,
CASE WHEN CCY_PAIR =CURRENCY_PAIR and FX_BUY_SELL='B' THEN 'BUY'  
WHEN CCY_PAIR =CURRENCY_PAIR and FX_BUY_SELL='S' THEN 'SELL' 
WHEN CCY_PAIR !=CURRENCY_PAIR and FX_BUY_SELL='S' THEN 'BUY'
WHEN CCY_PAIR !=CURRENCY_PAIR and FX_BUY_SELL='B' THEN 'SELL'
END BUY_SELL,case when CCY_PAIR =CURRENCY_PAIR then TTFXL.MARKET_SPOT_RATE else TTFXL.MARKET_SPOT_RATE end RATE,MEMO_FIELD0 FROM 
TT_FXP_DEAL@FTMIG FIN_FX_OUTRIGHT
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTMIG TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM  and PARENT_FBO_ID_VER='1' and PARENT_FBO_MIN_VER='1'
LEFT JOIN TT_FXP_LEG@FTMIG TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
WHERE  FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD' AND FIN_FX_OUTRIGHT.DEAL_NUM = FIN_FX_OUTRIGHT.DEAL_IDENTIFIER and  MEMO_FIELD0='KUWAIT') B
ON CCY_PAIR = trim(A.MAIN_LEG_CCY_PAIR)
 AND --trim(BUY_SELL) = trim(MAIN_LEG_FX_BUY_SELL) and 
trim(MEMO_FIELD0) = trim(MEMO_FIELD_1)



SELECT DISTINCT 
TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY')||'-'||MAIN_LEG_CCY_PAIR||'-'||ABS(MAIN_LEG_CCY_ONE_AMOUNT)||'-'|| to_char(to_number(MARKET_SPOT_RATE),'9990.999999')||'-'|| MEMO_FIELD_1 OPICS_DATA,
 B.DEAL_DATE||'-'||CCY_PAIR ||'-'||MAIN_LEG_CCY_ONE_AMOUNT||'-'||CASE WHEN CCY_PAIR='JPY/KWD' THEN to_char(ROUND(RATE,6),'9990.999999') ELSE to_char(ROUND(RATE,6),'9990.999999') END||'-'||MEMO_FIELD0  FIN_DATA,
CASE WHEN TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY')||'-'||MAIN_LEG_CCY_PAIR||'-'||ABS(MAIN_LEG_CCY_ONE_AMOUNT)||'-'|| to_char(to_number(MARKET_SPOT_RATE),'9990.999999')||'-'|| MEMO_FIELD_1=
B.DEAL_DATE||'-'||CCY_PAIR ||'-'||MAIN_LEG_CCY_ONE_AMOUNT||'-'||CASE WHEN CCY_PAIR='JPY/KWD' THEN to_char(ROUND(RATE,6),'9990.999999') ELSE to_char(ROUND(RATE,6),'9990.999999') END||'-'||MEMO_FIELD0 THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM SPOT_POSITION_DEALS_O_TABLE A
left JOIN(SELECT CCY_PAIR,CCY1_CALENDAR_SET,CCY2_CALENDAR_SET,FIN_FX_OUTRIGHT.DEAL_NUM,FIN_FX_OUTRIGHT.DEAL_TYPE,
case when CCY_PAIR =CURRENCY_PAIR  then TTFXL.CCY_ONE_AMOUNT_VALUE else TTFXL.CCY_TWO_AMOUNT_VALUE end CCY_ONE_AMOUNT_VALUE,CURRENCY_PAIR,DEAL_DATE ,
CASE WHEN CCY_PAIR =CURRENCY_PAIR and FX_BUY_SELL='B' THEN 'BUY'  
WHEN CCY_PAIR =CURRENCY_PAIR and FX_BUY_SELL='S' THEN 'SELL' 
WHEN CCY_PAIR !=CURRENCY_PAIR and FX_BUY_SELL='S' THEN 'BUY'
WHEN CCY_PAIR !=CURRENCY_PAIR and FX_BUY_SELL='B' THEN 'SELL'
END BUY_SELL,case when CCY_PAIR =CURRENCY_PAIR then TTFXL.MARKET_SPOT_RATE else TTFXL.MARKET_SPOT_RATE end RATE,MEMO_FIELD0 FROM 
TT_FXP_DEAL@FTMIG FIN_FX_OUTRIGHT
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTMIG TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM  and PARENT_FBO_ID_VER='1' and PARENT_FBO_MIN_VER='1'
LEFT JOIN TT_FXP_LEG@FTMIG TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
WHERE  FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD' AND FIN_FX_OUTRIGHT.DEAL_NUM = FIN_FX_OUTRIGHT.DEAL_IDENTIFIER and  MEMO_FIELD0='KUWAIT') B
ON CCY_PAIR = trim(A.MAIN_LEG_CCY_PAIR)
 AND --trim(BUY_SELL) = trim(MAIN_LEG_FX_BUY_SELL) and 
trim(MEMO_FIELD0) = trim(MEMO_FIELD_1)



SELECT DISTINCT 
TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY')||'-'||MAIN_LEG_CCY_PAIR||'-'||ABS(MAIN_LEG_CCY_ONE_AMOUNT)||'-'|| to_char(to_number(MARKET_SPOT_RATE),'9990.999999')||'-'|| MEMO_FIELD_1 OPICS_DATA,
 B.DEAL_DATE||'-'||CCY_PAIR ||'-'||CCY_ONE_AMOUNT_VALUE||'-'||CASE WHEN CCY_PAIR='JPY/KWD' THEN to_char(ROUND(RATE,6),'9990.999999') ELSE to_char(ROUND(RATE,6),'9990.999999') END||'-'||MEMO_FIELD0  FIN_DATA,
CASE WHEN TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY')||'-'||MAIN_LEG_CCY_PAIR||'-'||ABS(MAIN_LEG_CCY_ONE_AMOUNT)||'-'|| to_char(to_number(MARKET_SPOT_RATE),'9990.999999')||'-'|| MEMO_FIELD_1=
B.DEAL_DATE||'-'||CCY_PAIR ||'-'||CCY_ONE_AMOUNT_VALUE||'-'||CASE WHEN CCY_PAIR='JPY/KWD' THEN to_char(ROUND(RATE,6),'9990.999999') ELSE to_char(ROUND(RATE,6),'9990.999999') END||'-'||MEMO_FIELD0 THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM SPOT_POSITION_DEALS_O_TABLE A
left JOIN(SELECT CCY_PAIR,CCY1_CALENDAR_SET,CCY2_CALENDAR_SET,FIN_FX_OUTRIGHT.DEAL_NUM,FIN_FX_OUTRIGHT.DEAL_TYPE,
TTFXL.CCY_ONE_AMOUNT_VALUE CCY_ONE_AMOUNT_VALUE,CURRENCY_PAIR,DEAL_DATE ,
CASE WHEN CCY_PAIR =CURRENCY_PAIR and FX_BUY_SELL='B' THEN 'BUY'  
WHEN CCY_PAIR =CURRENCY_PAIR and FX_BUY_SELL='S' THEN 'SELL' 
WHEN CCY_PAIR !=CURRENCY_PAIR and FX_BUY_SELL='S' THEN 'BUY'
WHEN CCY_PAIR !=CURRENCY_PAIR and FX_BUY_SELL='B' THEN 'SELL'
END BUY_SELL,case when CCY_PAIR =CURRENCY_PAIR then TTFXL.MARKET_SPOT_RATE else TTFXL.MARKET_SPOT_RATE end RATE,MEMO_FIELD0 FROM 
TT_FXP_DEAL@FTMIG FIN_FX_OUTRIGHT
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTMIG TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM  and PARENT_FBO_ID_VER='1' and PARENT_FBO_MIN_VER='1'
LEFT JOIN TT_FXP_LEG@FTMIG TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
WHERE  FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD' AND FIN_FX_OUTRIGHT.DEAL_NUM = FIN_FX_OUTRIGHT.DEAL_IDENTIFIER and  MEMO_FIELD0='KUWAIT') B
ON CCY_PAIR = trim(A.MAIN_LEG_CCY_PAIR)
 AND --trim(BUY_SELL) = trim(MAIN_LEG_FX_BUY_SELL) and 
trim(MEMO_FIELD0) = trim(MEMO_FIELD_1)




SELECT DISTINCT 
TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY')||'-'||MAIN_LEG_CCY_PAIR||'-'||ABS(MAIN_LEG_CCY_ONE_AMOUNT)||'-'|| TRIM(to_char(to_number(MARKET_SPOT_RATE),'9990.999999')) OPICS_DATA,
 B.DEAL_DATE||'-'||CCY_PAIR ||'-'||CCY_ONE_AMOUNT_VALUE||'-'||TRIM(CASE WHEN CCY_PAIR='JPY/KWD' THEN to_char(ROUND(RATE,6),'9990.999999') ELSE to_char(ROUND(RATE,6),'9990.999999') END)  FIN_DATA,
CASE WHEN TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY')||'-'||MAIN_LEG_CCY_PAIR||'-'||ABS(MAIN_LEG_CCY_ONE_AMOUNT)||'-'|| TRIM(to_char(to_number(MARKET_SPOT_RATE),'9990.999999'))=
B.DEAL_DATE||'-'||CCY_PAIR ||'-'||CCY_ONE_AMOUNT_VALUE||'-'||TRIM(CASE WHEN CCY_PAIR='JPY/KWD' THEN to_char(ROUND(RATE,6),'9990.999999') ELSE to_char(ROUND(RATE,6),'9990.999999') END) THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM SPOT_POSITION_DEALS_O_TABLE A
left JOIN(SELECT QUOTED_CCY_PAIR,CCY_PAIR,CCY1_CALENDAR_SET,CCY2_CALENDAR_SET,FIN_FX_OUTRIGHT.DEAL_NUM,FIN_FX_OUTRIGHT.DEAL_TYPE,
TTFXL.CCY_ONE_AMOUNT_VALUE CCY_ONE_AMOUNT_VALUE,CURRENCY_PAIR,DEAL_DATE ,
CASE WHEN CCY_PAIR =CURRENCY_PAIR and FX_BUY_SELL='B' THEN 'BUY'  
WHEN CCY_PAIR =CURRENCY_PAIR and FX_BUY_SELL='S' THEN 'SELL' 
WHEN CCY_PAIR !=CURRENCY_PAIR and FX_BUY_SELL='S' THEN 'BUY'
WHEN CCY_PAIR !=CURRENCY_PAIR and FX_BUY_SELL='B' THEN 'SELL'
END BUY_SELL,case when CCY_PAIR =CURRENCY_PAIR then TTFXL.MARKET_SPOT_RATE else TTFXL.MARKET_SPOT_RATE end RATE,MEMO_FIELD0 FROM 
TT_FXP_DEAL@FTMIG FIN_FX_OUTRIGHT
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTMIG TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM  and PARENT_FBO_ID_VER='1' and PARENT_FBO_MIN_VER='1'
LEFT JOIN TT_FXP_LEG@FTMIG TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE
WHERE  FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD' AND  TO_CHAR(TRIM(FIN_FX_OUTRIGHT.DEAL_NUM)) = TO_CHAR(TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER)) 
AND DEAL_DATE = TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND TTFXL.VALUE_DATE_ONE = TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND TTFXL.VALUE_DATE_TWO = TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') ) B
ON QUOTED_CCY_PAIR = trim(A.MAIN_LEG_CCY_PAIR)
-- AND --trim(BUY_SELL) = trim(MAIN_LEG_FX_BUY_SELL) and 
--trim(MEMO_FIELD0) = trim(MEMO_FIELD_1)


SELECT DEAL_NUM FIN_DEAL_NUM,
MAIN_LEG_SPOT_RISK_ENTITY MAPPED_ENTITY, NAME FIN_ENTITY, CASE WHEN MAIN_LEG_SPOT_RISK_ENTITY =  NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY') OPICS_DEAL_DATE ,B.DEAL_DATE FIN_DEAL_DATE,CASE WHEN TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY') = B.DEAL_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_DEAL_DATE,
TO_DATE(TRIM(A.MAIN_LEG_VALUE_DATE_ONE),'DD-mON-YYYY') OPICS_START_DATE ,B.VALUE_DATE_ONE FIN_START_DATE,CASE WHEN TO_DATE(TRIM(A.MAIN_LEG_VALUE_DATE_ONE),'DD-mON-YYYY') = B.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
TO_DATE(TRIM(A.MAIN_LEG_VALUE_DATE_ONE),'DD-mON-YYYY') OPICS_END_DATE ,B.VALUE_DATE_TWO FIN_END_DATE,CASE WHEN TO_DATE(TRIM(A.MAIN_LEG_VALUE_DATE_ONE),'DD-mON-YYYY') = B.VALUE_DATE_ONE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
A.MAIN_LEG_CCY_PAIR MAPPED_CCY_PAIR,B.QUOTED_CCY_PAIR FIN_CCY_PAIR, CASE WHEN A.MAIN_LEG_CCY_PAIR = B.QUOTED_CCY_PAIR THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_PAIR,
A.MAIN_LEG_CCY_ONE_AMOUNT OPICS_CCY_AMT,  ( CCY_ONE_AMOUNT_VALUE) FIN_CCY_AMT,CASE WHEN round(to_number(A.MAIN_LEG_CCY_ONE_AMOUNT),8) =  round ( CCY_ONE_AMOUNT_VALUE,8)  THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY_AMT,
ROUND(TO_NUMBER(MARKET_SPOT_RATE),8) OPICS_SPOT_RATE,ROUND(CASE WHEN CCY_PAIR='JPY/KWD' THEN RATE ELSE RATE END,8) FIN_SPOT_RATE, CASE WHEN ROUND(TO_NUMBER(MARKET_SPOT_RATE),8) = ROUND(CASE WHEN CCY_PAIR='JPY/KWD' THEN RATE ELSE RATE END,8) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPOT_RATE,
( CCY_TWO_AMOUNT_VALUE) FIN_CTR_AMT,
TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY')||'-'||MAIN_LEG_CCY_PAIR||'-'||ABS(MAIN_LEG_CCY_ONE_AMOUNT)||'-'|| TRIM(TO_CHAR(TO_NUMBER(MARKET_SPOT_RATE),'9990.999999')) OPICS_DATA,
 B.DEAL_DATE||'-'||CCY_PAIR ||'-'||CCY_ONE_AMOUNT_VALUE||'-'||TRIM(CASE WHEN CCY_PAIR='JPY/KWD' THEN TO_CHAR(ROUND(RATE,6),'9990.999999') ELSE TO_CHAR(ROUND(RATE,6),'9990.999999') END)  FIN_DATA,
CASE WHEN TO_DATE(TRIM(A.DEAL_DATE),'DD-mON-YYYY')||'-'||MAIN_LEG_CCY_PAIR||'-'||ABS(MAIN_LEG_CCY_ONE_AMOUNT)||'-'|| TRIM(TO_CHAR(TO_NUMBER(MARKET_SPOT_RATE),'9990.999999'))=
B.DEAL_DATE||'-'||CCY_PAIR ||'-'||CCY_ONE_AMOUNT_VALUE||'-'||TRIM(CASE WHEN CCY_PAIR='JPY/KWD' THEN TO_CHAR(ROUND(RATE,6),'9990.999999') ELSE TO_CHAR(ROUND(RATE,6),'9990.999999') END) THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM SPOT_POSITION_DEALS_O_TABLE A
LEFT JOIN(SELECT TTFXL.VALUE_DATE_ONE,TTFXL.VALUE_DATE_TWO,SDENT.NAME,QUOTED_CCY_PAIR,CCY_PAIR,CCY1_CALENDAR_SET,CCY2_CALENDAR_SET,FIN_FX_OUTRIGHT.DEAL_NUM,FIN_FX_OUTRIGHT.DEAL_TYPE,
TTFXL.CCY_ONE_AMOUNT_VALUE,TTFXL.CCY_TWO_AMOUNT_VALUE,CURRENCY_PAIR,DEAL_DATE ,
CASE WHEN CCY_PAIR =CURRENCY_PAIR AND FX_BUY_SELL='B' THEN 'BUY'  
WHEN CCY_PAIR =CURRENCY_PAIR AND FX_BUY_SELL='S' THEN 'SELL' 
WHEN CCY_PAIR !=CURRENCY_PAIR AND FX_BUY_SELL='S' THEN 'BUY'
WHEN CCY_PAIR !=CURRENCY_PAIR AND FX_BUY_SELL='B' THEN 'SELL'
END BUY_SELL,CASE WHEN CCY_PAIR =CURRENCY_PAIR THEN TTFXL.MARKET_SPOT_RATE ELSE TTFXL.MARKET_SPOT_RATE END RATE,MEMO_FIELD0 FROM 
TT_FXP_DEAL@FTMIG FIN_FX_OUTRIGHT
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_FX_OUTRIGHT.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_FX_OUTRIGHT.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_FX_OUTRIGHT.CPTY_FBO_ID_NUM
LEFT JOIN TT_FXP_FLOW@FTMIG TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM  AND PARENT_FBO_ID_VER='1' AND PARENT_FBO_MIN_VER='1'
LEFT JOIN TT_FXP_LEG@FTMIG TTFXL ON  TTFXL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM AND TTFXL.PARENT_FBO_ID_TYPE = FIN_FX_OUTRIGHT.DEAL_TYPE AND TTFXL.PARENT_FBO_ID_VER='999999'
WHERE  FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD' AND  TO_CHAR(TRIM(FIN_FX_OUTRIGHT.DEAL_NUM)) = TO_CHAR(TRIM(FIN_FX_OUTRIGHT.DEAL_IDENTIFIER)) 
AND DEAL_DATE = TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND TTFXL.VALUE_DATE_ONE = TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND TTFXL.VALUE_DATE_TWO = TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') ) B
ON QUOTED_CCY_PAIR = TRIM(A.MAIN_LEG_CCY_PAIR)
-- AND --trim(BUY_SELL) = trim(MAIN_LEG_FX_BUY_SELL) and 
--trim(MEMO_FIELD0) = trim(MEMO_FIELD_1) 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
swap_flows_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
swap_flows_report.sql 
--ALL CASH FLOWS
select 
DEALNO OPICS_DEALNO,deal_identifier FIN_DEAL_IDENTIFIER,CASE WHEN DEALNO = deal_identifier THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
deal_num FIN_DEAL_NUM,
case when trim(SEQ)='001' then 'PAY' else 'REC' end OPICS_PAY_REC,SETTLEMENT_ACTION FIN_PAY_REC,CASE WHEN case when trim(SEQ)='001' then 'PAY' else 'REC' end = SETTLEMENT_ACTION THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_REC,
SCHDSEQ OPICS_SCHEDULE_SEQ,SIDE_SEQUENCE FIN_SCHEDULE_SEQ,CASE WHEN TO_NUMBER(SCHDSEQ) = SIDE_SEQUENCE THEN 'TRUE' ELSE 'FALSE' END MATCH_SEQUENCE,
INTCCY OPICS_CCY,NOTIONAL_AMOUNT_CCY FIN_CCY,CASE WHEN INTCCY = NOTIONAL_AMOUNT_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
INTSTRTDTE OPICS_START_DATE ,fin_flow.START_DATE FIN_START_DATE ,CASE WHEN INTSTRTDTE = fin_flow.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
INTENDDTE OPICS_END_DATE,fin_flow.END_DATE OPICS_END_DATE,CASE WHEN INTENDDTE = fin_flow.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
RATECODE OPICS_RATECODE,RATE_CODE FIN_RATECODE,CASE WHEN nvl(case when RATECODE like 'LI%' then RATECODE end,' ') = nvl(RATE_CODE,' ')  THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE_CODE,
INTRATE_8 OPICS_INTRATE,NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) FIN_INTRATE,CASE WHEN INTRATE_8 = nvl(NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100),0) THEN 'TRUE' ELSE 'FALSE' END MATCH_INTRATE,
SPREAD_8 OPICS_SPREAD_RATE ,fin_flow.SPREAD_RATE*100 FIN_SPREAD_RATE,CASE WHEN to_number(SPREAD_8) = NVL(fin_flow.SPREAD_RATE*100,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPREAD_RATE
 from SWDS
left join tt_swap@ftmig on deal_identifier = dealno 
left join (select SETTLEMENT_ACTION,REFERENCE_RATE_FBO_ID_NUM,CASH_FLOW_TYPE,parent_fbo_id_num,BASIS_CODE,START_DATE,END_DATE,NOTIONAL_AMOUNT_CCY,NOTIONAL_AMOUNT_VALUE,
SPREAD_RATE,MARGIN,FIX_RATE,SIDE_SEQUENCE,PARENT_FBO_ID_VER from  TT_SWAP_CASH_FLOWS@ftmig)
 fin_flow on PARENT_FBO_ID_NUM  = deal_num and PARENT_FBO_ID_VER='999999' and SIDE_SEQUENCE = to_number(SCHDSEQ) and case when trim(SEQ)='001' then 'PAY' else 'REC' end  = SETTLEMENT_ACTION
LEFT JOIN (
SELECT  A.REF_RATE_FBO_ID_NUM,RATE_CODE,RATE_CCY,RATE_VALUE,EFFECTIVE_DATE FROM SD_REF_RATE_VALUE@FTMIG A
LEFT JOIN SD_REF_RATE@FTMIG B ON B.FBO_ID_NUM = A.REF_RATE_FBO_ID_NUM
) REF_RATE ON REF_RATE.REF_RATE_FBO_ID_NUM = REFERENCE_RATE_FBO_ID_NUM AND reset_date = EFFECTIVE_DATE
where TRIM(DEALNO) IN(SELECT TRIM(IDENTIFIER) FROM SWAP_O_TABLE)
order by DEALNO,to_number(SCHDSEQ);


select 
DEALNO OPICS_DEALNO,deal_identifier FIN_DEAL_IDENTIFIER,CASE WHEN DEALNO = deal_identifier THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
deal_num FIN_DEAL_NUM,
case when trim(SEQ)='001' then 'PAY' else 'REC' end OPICS_PAY_REC,SETTLEMENT_ACTION FIN_PAY_REC,CASE WHEN case when trim(SEQ)='001' then 'PAY' else 'REC' end = SETTLEMENT_ACTION THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_REC,
SCHDSEQ OPICS_SCHEDULE_SEQ,SIDE_SEQUENCE+1 FIN_SCHEDULE_SEQ,CASE WHEN TO_NUMBER(SCHDSEQ) = SIDE_SEQUENCE+1 THEN 'TRUE' ELSE 'FALSE' END MATCH_SEQUENCE,
INTCCY OPICS_CCY,NOTIONAL_AMOUNT_CCY FIN_CCY,CASE WHEN INTCCY = NOTIONAL_AMOUNT_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
INTSTRTDTE OPICS_START_DATE ,fin_flow.START_DATE FIN_START_DATE ,CASE WHEN INTSTRTDTE = fin_flow.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
INTENDDTE OPICS_END_DATE,fin_flow.END_DATE OPICS_END_DATE,CASE WHEN INTENDDTE = fin_flow.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
RATECODE OPICS_RATECODE,RATE_CODE FIN_RATECODE,CASE WHEN nvl(case when RATECODE like 'LI%' then RATECODE end,' ') = nvl(RATE_CODE,' ')  THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE_CODE,
INTRATE_8 OPICS_INTRATE,NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) FIN_INTRATE,CASE WHEN INTRATE_8 = nvl(NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100),0) THEN 'TRUE' ELSE 'FALSE' END MATCH_INTRATE,
SPREAD_8 OPICS_SPREAD_RATE ,fin_flow.SPREAD_RATE*100 FIN_SPREAD_RATE,CASE WHEN to_number(SPREAD_8) = NVL(fin_flow.SPREAD_RATE*100,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPREAD_RATE
 from SWDS
left join tt_swap@ftmig on DEAL_STATE <> 'DLTD' and  deal_identifier like dealno||'%'  
left join (select reset_date,SETTLEMENT_ACTION,REFERENCE_RATE_FBO_ID_NUM,CASH_FLOW_TYPE,parent_fbo_id_num,BASIS_CODE,START_DATE,END_DATE,NOTIONAL_AMOUNT_CCY,NOTIONAL_AMOUNT_VALUE,
SPREAD_RATE,MARGIN,FIX_RATE,SIDE_SEQUENCE,PARENT_FBO_ID_VER from  TT_SWAP_CASH_FLOWS@ftmig where SUBTYPE='MAIN')
 fin_flow on PARENT_FBO_ID_NUM  = deal_num and PARENT_FBO_ID_VER='999999' and SIDE_SEQUENCE+1 = to_number(SCHDSEQ) and case when trim(SEQ)='001' then 'PAY' else 'REC' end  = SETTLEMENT_ACTION
LEFT JOIN (
SELECT  A.REF_RATE_FBO_ID_NUM,RATE_CODE,RATE_CCY,RATE_VALUE,EFFECTIVE_DATE FROM SD_REF_RATE_VALUE@FTMIG A
LEFT JOIN SD_REF_RATE@FTMIG B ON B.FBO_ID_NUM = A.REF_RATE_FBO_ID_NUM
) REF_RATE ON REF_RATE.REF_RATE_FBO_ID_NUM = REFERENCE_RATE_FBO_ID_NUM AND reset_date = EFFECTIVE_DATE
where TRIM(DEALNO) IN(SELECT TRIM(IDENTIFIER) FROM SWAP_O_TABLE)
and SCHDTYPE!='V'
order by DEALNO,to_number(SCHDSEQ);


--CURRENT CASH FLOWS
select 
DEALNO OPICS_DEALNO,deal_identifier FIN_DEAL_IDENTIFIER,CASE WHEN DEALNO = deal_identifier THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
deal_num FIN_DEAL_NUM,
case when trim(SEQ)='001' then 'PAY' else 'REC' end OPICS_PAY_REC,SETTLEMENT_ACTION FIN_PAY_REC,CASE WHEN case when trim(SEQ)='001' then 'PAY' else 'REC' end = SETTLEMENT_ACTION THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_REC,
SCHDSEQ OPICS_SCHEDULE_SEQ,SIDE_SEQUENCE FIN_SCHEDULE_SEQ,CASE WHEN TO_NUMBER(SCHDSEQ) = SIDE_SEQUENCE THEN 'TRUE' ELSE 'FALSE' END MATCH_SEQUENCE,
INTCCY OPICS_CCY,NOTIONAL_AMOUNT_CCY FIN_CCY,CASE WHEN INTCCY = NOTIONAL_AMOUNT_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
INTSTRTDTE OPICS_START_DATE ,fin_flow.START_DATE FIN_START_DATE ,CASE WHEN INTSTRTDTE = fin_flow.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
INTENDDTE OPICS_END_DATE,fin_flow.END_DATE OPICS_END_DATE,CASE WHEN INTENDDTE = fin_flow.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
RATECODE OPICS_RATECODE,RATE_CODE FIN_RATECODE,CASE WHEN RATECODE = RATE_CODE THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE_CODE,
INTRATE_8 OPICS_INTRATE,NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) FIN_INTRATE,CASE WHEN INTRATE_8 = NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) THEN 'TRUE' ELSE 'FALSE' END MATCH_INTRATE,
SPREAD_8 OPICS_SPREAD_RATE ,fin_flow.SPREAD_RATE*100 FIN_SPREAD_RATE,CASE WHEN to_number(SPREAD_8) = NVL(fin_flow.SPREAD_RATE*100,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPREAD_RATE
 from SWDS
left join tt_swap@ftmig on deal_identifier = dealno 
left join (select SETTLEMENT_ACTION,REFERENCE_RATE_FBO_ID_NUM,CASH_FLOW_TYPE,parent_fbo_id_num,BASIS_CODE,START_DATE,END_DATE,NOTIONAL_AMOUNT_CCY,NOTIONAL_AMOUNT_VALUE,
SPREAD_RATE,MARGIN,FIX_RATE,SIDE_SEQUENCE,PARENT_FBO_ID_VER from  TT_SWAP_CASH_FLOWS@ftmig)
 fin_flow on PARENT_FBO_ID_NUM  = deal_num and PARENT_FBO_ID_VER='999999' and SIDE_SEQUENCE = to_number(SCHDSEQ) and case when trim(SEQ)='001' then 'PAY' else 'REC' end  = SETTLEMENT_ACTION
LEFT JOIN (
SELECT  A.REF_RATE_FBO_ID_NUM,RATE_CODE,RATE_CCY,RATE_VALUE,EFFECTIVE_DATE FROM SD_REF_RATE_VALUE@FTMIG A
LEFT JOIN SD_REF_RATE@FTMIG B ON B.FBO_ID_NUM = A.REF_RATE_FBO_ID_NUM
) REF_RATE ON REF_RATE.REF_RATE_FBO_ID_NUM = REFERENCE_RATE_FBO_ID_NUM AND INTSTRTDTE = EFFECTIVE_DATE
where TRIM(DEALNO) IN(SELECT TRIM(IDENTIFIER) FROM SWAP_O_TABLE)
AND INTSTRTDTE <= TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND  INTENDDTE > TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY')
order by DEALNO,to_number(SCHDSEQ);

select 
DEALNO OPICS_DEALNO,deal_identifier FIN_DEAL_IDENTIFIER,CASE WHEN DEALNO = deal_identifier THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
deal_num FIN_DEAL_NUM,
case when trim(SEQ)='001' then 'PAY' else 'REC' end OPICS_PAY_REC,SETTLEMENT_ACTION FIN_PAY_REC,CASE WHEN case when trim(SEQ)='001' then 'PAY' else 'REC' end = SETTLEMENT_ACTION THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_REC,
SCHDSEQ OPICS_SCHEDULE_SEQ,SIDE_SEQUENCE+1 FIN_SCHEDULE_SEQ,CASE WHEN TO_NUMBER(SCHDSEQ) = SIDE_SEQUENCE+1 THEN 'TRUE' ELSE 'FALSE' END MATCH_SEQUENCE,
INTCCY OPICS_CCY,NOTIONAL_AMOUNT_CCY FIN_CCY,CASE WHEN INTCCY = NOTIONAL_AMOUNT_CCY THEN 'TRUE' ELSE 'FALSE' END MATCH_CCY,
INTSTRTDTE OPICS_START_DATE ,fin_flow.START_DATE FIN_START_DATE ,CASE WHEN INTSTRTDTE = fin_flow.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
INTENDDTE OPICS_END_DATE,fin_flow.END_DATE OPICS_END_DATE,CASE WHEN INTENDDTE = fin_flow.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
RATECODE OPICS_RATECODE,RATE_CODE FIN_RATECODE,CASE WHEN nvl(case when RATECODE like 'LI%' then RATECODE end,' ') = nvl(RATE_CODE,' ')  THEN 'TRUE' ELSE 'FALSE' END MATCH_RATE_CODE,
INTRATE_8 OPICS_INTRATE,NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100) FIN_INTRATE,CASE WHEN INTRATE_8 = nvl(NVL(fin_flow.FIX_RATE*100,RATE_VALUE*100),0) THEN 'TRUE' ELSE 'FALSE' END MATCH_INTRATE,
SPREAD_8 OPICS_SPREAD_RATE ,fin_flow.SPREAD_RATE*100 FIN_SPREAD_RATE,CASE WHEN to_number(SPREAD_8) = NVL(fin_flow.SPREAD_RATE*100,0) THEN 'TRUE' ELSE 'FALSE' END MATCH_SPREAD_RATE
 from SWDS
left join tt_swap@ftmig on DEAL_STATE <> 'DLTD' and  deal_identifier like dealno||'%'  
left join (select reset_date,SETTLEMENT_ACTION,REFERENCE_RATE_FBO_ID_NUM,CASH_FLOW_TYPE,parent_fbo_id_num,BASIS_CODE,START_DATE,END_DATE,NOTIONAL_AMOUNT_CCY,NOTIONAL_AMOUNT_VALUE,
SPREAD_RATE,MARGIN,FIX_RATE,SIDE_SEQUENCE,PARENT_FBO_ID_VER from  TT_SWAP_CASH_FLOWS@ftmig where SUBTYPE='MAIN')
 fin_flow on PARENT_FBO_ID_NUM  = deal_num and PARENT_FBO_ID_VER='999999' and SIDE_SEQUENCE+1 = to_number(SCHDSEQ) and case when trim(SEQ)='001' then 'PAY' else 'REC' end  = SETTLEMENT_ACTION
LEFT JOIN (
SELECT  A.REF_RATE_FBO_ID_NUM,RATE_CODE,RATE_CCY,RATE_VALUE,EFFECTIVE_DATE FROM SD_REF_RATE_VALUE@FTMIG A
LEFT JOIN SD_REF_RATE@FTMIG B ON B.FBO_ID_NUM = A.REF_RATE_FBO_ID_NUM
) REF_RATE ON REF_RATE.REF_RATE_FBO_ID_NUM = REFERENCE_RATE_FBO_ID_NUM AND reset_date = EFFECTIVE_DATE
where TRIM(DEALNO) IN(SELECT TRIM(IDENTIFIER) FROM SWAP_O_TABLE)
and SCHDTYPE!='V'
AND INTSTRTDTE <= TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY') AND  INTENDDTE > TO_DATE(GET_PARAM('EOD_DATE'),'DD-MM-YYYY')
order by DEALNO,to_number(SCHDSEQ); 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
swap_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
swap_report.sql 

select distinct
S1.DEALNO OPICS_DEALNO, FIN_SWAP.DEAL_IDENTIFIER FINACLE_DEAL_IDENTIFIER, CASE WHEN TRIM(S1.DEALNO) = TRIM(FIN_SWAP.DEAL_IDENTIFIER) THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
C.CMNE OPICS_CMNE,SDCP.MNEMONIC FINACLE_Counterparty,CASE WHEN TRIM(C.CMNE) = TRIM(SDCP.MNEMONIC) THEN 'TRUE' ELSE 'FALSE' END MATCH_Counterparty,--C.CMNE,-- Counterparty, --***
S1.NOTCCY OPICS_NOTCCY,S2.NOTCCY OPICS_NOTCCY,FIN_SWAP.CURRENCY_LIST FINACLE_CURRENCY_STRING,--CURRENCY_STRING,
S1.FIXFLOATIND OPICS_FIXFLOATIND, CASH_FLOW_TYPE FINACLE_CASH_FLOW_TYPE,
S1.MATDATE OPICS_MATDATE,FIN_SWAP.END_DATE FINACLE_END_DATE,CASE WHEN S1.MATDATE= FIN_SWAP.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_END_DATE,
S1.STARTDATE OPICS_STARTDATE,FIN_SWAP.START_DATE OPICS_START_DATE,CASE WHEN S1.STARTDATE= FIN_SWAP.START_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_START_DATE,
S1.PRODTYPE OPICS_PRODTYPE,SDTRBK.NAME FINACLE_TRADING_BOOK,--TRADING_BOOK,--***
S1.PRODTYPE OPICS_PRODTYPE,SDSBTY.NAME FINACLE_SUBTYPE,
S1.NOTCCYAMT OPICS_NOTCCYAMT,NOTIONAL_AMOUNT_VALUE FINACLE_NOTIONAL_AMOUNT_VALUE,--***
S1.NOTCCY OPICS_NOTCCY,S2.NOTCCY OPICS_NOTCCY, FIN_SWAP.CCY_CALENDAR_SET FINACLE_CCY_CALENDAR_SET,
S1.INTRATE_8 OPICS_INTRATE_8,SETTLEMENT_RATE*100 FINACLE_FIX_RATE,--@@@@@@@@
s1.RATECODE OPICS_RATECODE,TTSWFL.CASH_FLOW_TYPE FINACLE_CASH_FLOW_TYPE,
S1.BASIS,BASIS_CODE FINACLE_BASIS_CODE,--***
S2.FIXFLOATIND,FIN_SWAP.TYPE_STRING,
S1.BR,FIN_SWAP.SDENT.NAME FINACLE_ENTITY_NAME--,-- ENTITY_NAME,--***
FROM SWDT S1
INNER JOIN SWDT S2 ON TRIM(S2.DEALNO)=TRIM(S1.DEALNO) AND S2.SEQ='002' 
INNER JOIN SWDH H ON trim(S1.DEALNO)=trim(H.DEALNO) AND TRIM(H.REVDATE) IS NULL
INNER JOIN CUST C ON C.CNO=H.CNO
LEFT JOIN  TT_SWAP@FTUAT FIN_SWAP  ON TRIM(S1.DEALNO) = TRIM(FIN_SWAP.DEAL_IDENTIFIER) and DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@FTUAT SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_SWAP.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTUAT SDENT ON SDENT.FBO_ID_NUM = FIN_SWAP.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTUAT SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_SWAP.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTUAT SDCP ON SDCP.FBO_ID_NUM= FIN_SWAP.CPTY_FBO_ID_NUM
LEFT JOIN TT_SWAP_CASH_FLOWS@FTUAT TTSWFL ON TTSWFL.PARENT_FBO_ID_NUM = FIN_SWAP.DEAL_NUM   AND trim(SETTLEMENT_RATE) IS NOT NULL
WHERE S1.SEQ='001' AND S1.MATDATE>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY')
and (S1.INTRATE_8 = SETTLEMENT_RATE*100 or trim(s1.RATECODE) not like 'FIX%' or S1.DEALNO='8100050');

select DISTINCT 
S1.BR||'-'||S1.DEALNO||'-'||S1.FIXFLOATIND||'-'||TRIM(C.CMNE) ||'-'||S1.NOTCCY||','||S2.NOTCCY||'-'||S1.MATDATE||'-'||S1.STARTDATE||'-'||S1.PRODTYPE||'-'||S1.NOTCCYAMT||'-'||S1.INTRATE_8 OPICS_DATA,
CASE WHEN TRIM(S1.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||S1.DEALNO||'-'||CASE WHEN S1.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END||'-'||TRIM(C.CMNE) ||'-'||S1.NOTCCY||','||
S2.NOTCCY||'-'||S1.MATDATE||'-'||S1.STARTDATE||'-'||CASE WHEN TRIM(S1.PRODTYPE)='IR' THEN 'IRSH' ELSE 'CCIRST' END||'-'||ABS(S1.NOTCCYAMT)||'-'||CASE WHEN S1.FIXFLOATIND='X' THEN ROUND(S1.INTRATE_8,4) ELSE ROUND(S2.INTRATE_8,4) END ||'-'||ABS(S2.NOTCCYAMT) CONV_OPICS_DATA,
FIN_SWAP.SDENT.NAME||'-'||FIN_SWAP.DEAL_IDENTIFIER||'-'||CASH_FLOW_TYPE||'-'||SDCP.NAME||'-'||CASE WHEN LENGTH(FIN_SWAP.CCY_CALENDAR_SET)=3 THEN FIN_SWAP.CCY_CALENDAR_SET||','||
FIN_SWAP.CCY_CALENDAR_SET ELSE FIN_SWAP.CCY_CALENDAR_SET END ||'-'||FIN_SWAP.END_DATE||'-'||FIN_SWAP.START_DATE||'-'||SDSBTY.NAME||'-'||ABS(PAY_AMOUNT)||'-'||CASE WHEN S1.FIXFLOATIND='X' THEN ROUND(PAY_RATE,4) ELSE ROUND(REC_RATE,4) END ||'-'||ABS(REC_AMOUNT) FIN_DATA,
CASE WHEN CASE WHEN TRIM(S1.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||S1.DEALNO||'-'||CASE WHEN S1.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END||'-'||TRIM(C.CMNE) ||'-'||
S1.NOTCCY||','||S2.NOTCCY||'-'||S1.MATDATE||'-'||S1.STARTDATE||'-'||CASE WHEN TRIM(S1.PRODTYPE)='IR' THEN 'IRSH' ELSE 'CCIRST' END||'-'||ABS(S1.NOTCCYAMT)||'-'||CASE WHEN S1.FIXFLOATIND='X' THEN ROUND(S1.INTRATE_8,4) ELSE ROUND(S2.INTRATE_8,4) END||'-'||ABS(S2.NOTCCYAMT)  =
FIN_SWAP.SDENT.NAME||'-'||FIN_SWAP.DEAL_IDENTIFIER||'-'||CASH_FLOW_TYPE||'-'||SDCP.NAME||'-'||CASE WHEN LENGTH(FIN_SWAP.CCY_CALENDAR_SET)=3 THEN FIN_SWAP.CCY_CALENDAR_SET||','||
FIN_SWAP.CCY_CALENDAR_SET ELSE FIN_SWAP.CCY_CALENDAR_SET END||'-'||FIN_SWAP.END_DATE||'-'||FIN_SWAP.START_DATE||'-'||SDSBTY.NAME||'-'||ABS(PAY_AMOUNT)||'-'||CASE WHEN S1.FIXFLOATIND='X' THEN ROUND(PAY_RATE,4) ELSE ROUND(REC_RATE,4) END||'-'||ABS(REC_AMOUNT)
THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM SWDT S1
INNER JOIN SWDT S2 ON TRIM(S2.DEALNO)=TRIM(S1.DEALNO) AND S2.SEQ='002' 
INNER JOIN SWDH H ON trim(S1.DEALNO)=trim(H.DEALNO) AND TRIM(H.REVDATE) IS NULL
INNER JOIN CUST C ON C.CNO=H.CNO
LEFT JOIN  TT_SWAP@FTMIG FIN_SWAP  ON TRIM(S1.DEALNO) = TRIM(FIN_SWAP.DEAL_IDENTIFIER) and DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_SWAP.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_SWAP.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_SWAP.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_SWAP.CPTY_FBO_ID_NUM
LEFT JOIN (select A.PARENT_FBO_ID_NUM,A.CASH_FLOW_TYPE,A.NOTIONAL_AMOUNT_VALUE PAY_AMOUNT,A.SETTLEMENT_RATE PAY_RATE, B.NOTIONAL_AMOUNT_VALUE REC_AMOUNT,B.SETTLEMENT_RATE REC_RATE from (
select distinct PARENT_FBO_ID_NUM,CASH_FLOW_TYPE,NOTIONAL_AMOUNT_VALUE,SETTLEMENT_ACTION,SETTLEMENT_RATE*100 SETTLEMENT_RATE from TT_SWAP_CASH_FLOWS@FTMIG where SETTLEMENT_ACTION='PAY' and PARENT_FBO_ID_VER='999999'
) a
left join (select distinct PARENT_FBO_ID_NUM,CASH_FLOW_TYPE,NOTIONAL_AMOUNT_VALUE,SETTLEMENT_ACTION,SETTLEMENT_RATE*100 SETTLEMENT_RATE from TT_SWAP_CASH_FLOWS@FTMIG where SETTLEMENT_ACTION='REC'  and PARENT_FBO_ID_VER='999999'
)b on a.PARENT_FBO_ID_NUM = b.PARENT_FBO_ID_NUM) TTSWFL ON TTSWFL.PARENT_FBO_ID_NUM = FIN_SWAP.DEAL_NUM
WHERE S1.SEQ='001' AND S1.MATDATE>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY')



select DISTINCT 
S1.DEALNO ,FIN_SWAP.DEAL_IDENTIFIER,CASE WHEN TRIM(S1.DEALNO) = FIN_SWAP.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
S1.BR OPICS_BR, CASE WHEN TRIM(S1.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END MAPPED_ENTITY, SDENT.NAME FIN_ENTITY, CASE WHEN CASE WHEN TRIM(S2.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END =  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
S1.PRODTYPE OPICS_PRODTYPE, CASE WHEN TRIM(S1.PRODTYPE)='IR' THEN 'IRSH' ELSE 'CCIRST' END MAPPED_SUBTYPE, SDSBTY.NAME ,CASE WHEN CASE WHEN TRIM(S1.PRODTYPE)='IR' THEN 'IRSH' ELSE 'CCIRST' END =  SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
S1.STARTDATE OPICS_SIDE1_START_DATE ,TTSWFL.START_DATE_1 FIN_SIDE1_START_DATE,CASE WHEN S1.STARTDATE = TTSWFL.START_DATE_1 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_START_DATE,
S1.MATDATE OPICS_SIDE1_END_DATE ,FIN_SWAP.END_DATE FIN_SIDE1_END_DATE,CASE WHEN S1.MATDATE = FIN_SWAP.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_END_DATE,
CASE WHEN S1.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END OPICS_SIDE1_FIXED_FLOAT, TTSWFL.CASH_FLOW_TYPE_1 FIN_SIDE1_FIXED_FLOAT,CASE WHEN CASE WHEN S1.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END = TTSWFL.CASH_FLOW_TYPE_1 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_FIXED_FLOAT,
S1.NOTCCY OPICS_SIDE1_CCY, TTSWFL.NOTIONAL_AMOUNT_CCY_1 FIN_SIDE1_CCY,CASE WHEN S1.NOTCCY = TTSWFL.NOTIONAL_AMOUNT_CCY_1 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_CCY,
S1.NOTCCYAMT OPICS_SIDE1_AMOUNT, TTSWFL.NOTIONAL_AMOUNT_VALUE_1 FIN_SIDE1_AMOUNT,CASE WHEN S1.NOTCCYAMT = TTSWFL.NOTIONAL_AMOUNT_VALUE_1 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_AMOUNT,
S1.INTRATE_8 OPICS_SIDE1_RATE, TTSWFL.FIX_RATE_1*100 FIN_SIDE1_RATE,CASE WHEN S1.INTRATE_8 = TTSWFL.FIX_RATE_1*100 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_FIX_RATE,
S2.STARTDATE OPICS_SIDE1_START_DATE ,TTSWFL.START_DATE_2 FIN_SIDE1_START_DATE,CASE WHEN S2.STARTDATE = TTSWFL.START_DATE_2 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_START_DATE,
S2.MATDATE OPICS_SIDE1_END_DATE ,FIN_SWAP.END_DATE FIN_SIDE1_END_DATE,CASE WHEN S2.MATDATE = FIN_SWAP.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_END_DATE,
CASE WHEN S2.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END OPICS_SIDE1_FIXED_FLOAT, TTSWFL.CASH_FLOW_TYPE_2 FIN_SIDE1_FIXED_FLOAT,CASE WHEN CASE WHEN S2.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END = TTSWFL.CASH_FLOW_TYPE_2 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_FIXED_FLOAT,
S2.NOTCCY OPICS_SIDE1_CCY, TTSWFL.NOTIONAL_AMOUNT_CCY_2 FIN_SIDE1_CCY,CASE WHEN S2.NOTCCY = TTSWFL.NOTIONAL_AMOUNT_CCY_2 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_CCY,
S2.NOTCCYAMT OPICS_SIDE1_AMOUNT, TTSWFL.NOTIONAL_AMOUNT_VALUE_2 FIN_SIDE1_AMOUNT,CASE WHEN S2.NOTCCYAMT = TTSWFL.NOTIONAL_AMOUNT_VALUE_2 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_AMOUNT,
S2.INTRATE_8 OPICS_SIDE1_RATE, TTSWFL.FIX_RATE_2*100 FIN_SIDE1_RATE,CASE WHEN S2.INTRATE_8 = TTSWFL.FIX_RATE_2*100 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_FIX_RATE,
S1.INTPAYCYCLE OPICS_PAY_INTPAYCYCLE,CF_SIDES.CREATION_FREQUENCY_1 FIN_PAY_INTPAYCYCLE, CASE WHEN TRIM(S1.INTPAYCYCLE)=TRIM(CF_SIDES.CREATION_FREQUENCY_1) THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_INTPAYCYCLE,
S2.INTPAYCYCLE OPICS_RECEIVE_INTPAYCYCLE,CF_SIDES.CREATION_FREQUENCY_2 FIN_REC_INTPAYCYCLE ,  CASE WHEN TRIM(S2.INTPAYCYCLE)=TRIM(CF_SIDES.CREATION_FREQUENCY_2) THEN 'TRUE' ELSE 'FALSE' END MATCH_REC_INTPAYCYCLE,
case when s1.PRODTYPE='IR' and s1.INTSMEANS='NOS' then s1.INTSACCT else 'BRIDGE_'||TRIM(s1.NOTCCY)||CASE WHEN TRIM(s1.BR)='51' THEN '_ABKU' ELSE '_ABKK' END  end OPICS_PAY_NOSTRO,PAY_NOS FIN_PAY_NOS, CASE WHEN TRIM(case when s1.PRODTYPE='IR' and s1.INTSMEANS='NOS' then s1.INTSACCT else 'BRIDGE_'||TRIM(s1.NOTCCY)||CASE WHEN TRIM(s1.BR)='51' THEN '_ABKU' ELSE '_ABKK' END  end) =TRIM(PAY_NOS) THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_NOS,
case when s2.PRODTYPE='IR' and s2.INTSMEANS='NOS' then s2.INTSACCT else 'BRIDGE_'||TRIM(s2.NOTCCY)||CASE WHEN TRIM(s2.BR)='51' THEN '_ABKU' ELSE '_ABKK' END  end OPICS_REC_NOSTRO,REC_NOS FIN_REC_NOS, CASE WHEN TRIM(case when s2.PRODTYPE='IR' and s2.INTSMEANS='NOS' then s2.INTSACCT else 'BRIDGE_'||TRIM(s2.NOTCCY)||CASE WHEN TRIM(s2.BR)='51' THEN '_ABKU' ELSE '_ABKK' END  end) = TRIM(REC_NOS) THEN 'TRUE' ELSE 'FALSE' END MATCH_REC_NOS,     
S1.BR||'-'||S1.DEALNO||'-'||S1.FIXFLOATIND||'-'||TRIM(C.CMNE) ||'-'||S1.NOTCCY||','||S2.NOTCCY||'-'||S1.MATDATE||'-'||S1.STARTDATE||'-'||S1.PRODTYPE||'-'||S1.NOTCCYAMT||'-'||S1.INTRATE_8 OPICS_DATA,
CASE WHEN TRIM(S1.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||S1.DEALNO||'-'||CASE WHEN S1.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END||'-'||TRIM(C.CMNE) ||'-'||S1.NOTCCY||','||
S2.NOTCCY||'-'||S1.MATDATE||'-'||S1.STARTDATE||'-'||CASE WHEN TRIM(S1.PRODTYPE)='IR' THEN 'IRSH' ELSE 'CCIRST' END||'-'||ABS(S1.NOTCCYAMT)||'-'||CASE WHEN S1.FIXFLOATIND='X' THEN (S1.INTRATE_8) ELSE (S2.INTRATE_8) END ||'-'||ABS(S2.NOTCCYAMT) CONV_OPICS_DATA,
FIN_SWAP.SDENT.NAME||'-'||FIN_SWAP.DEAL_IDENTIFIER||'-'||CASH_FLOW_TYPE_1||'-'||SDCP.NAME||'-'||CASE WHEN LENGTH(FIN_SWAP.CCY_CALENDAR_SET)=3 THEN FIN_SWAP.CCY_CALENDAR_SET||','||
FIN_SWAP.CCY_CALENDAR_SET ELSE FIN_SWAP.CCY_CALENDAR_SET END ||'-'||FIN_SWAP.END_DATE||'-'||FIN_SWAP.START_DATE||'-'||SDSBTY.NAME||'-'||ABS(TTSWFL.NOTIONAL_AMOUNT_VALUE_1)||'-'||CASE WHEN S1.FIXFLOATIND='X' THEN (TTSWFL.FIX_RATE_1) ELSE (TTSWFL.FIX_RATE_2) END*100 ||'-'||ABS(TTSWFL.NOTIONAL_AMOUNT_VALUE_2) FIN_DATA,
CASE WHEN CASE WHEN TRIM(S1.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||S1.DEALNO||'-'||CASE WHEN S1.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END||'-'||TRIM(C.CMNE) ||'-'||
S1.NOTCCY||','||S2.NOTCCY||'-'||S1.MATDATE||'-'||S1.STARTDATE||'-'||CASE WHEN TRIM(S1.PRODTYPE)='IR' THEN 'IRSH' ELSE 'CCIRST' END||'-'||ABS(S1.NOTCCYAMT)||'-'||CASE WHEN S1.FIXFLOATIND='X' THEN (S1.INTRATE_8) ELSE (S2.INTRATE_8) END||'-'||ABS(S2.NOTCCYAMT)  =
FIN_SWAP.SDENT.NAME||'-'||FIN_SWAP.DEAL_IDENTIFIER||'-'||CASH_FLOW_TYPE_1||'-'||SDCP.NAME||'-'||CASE WHEN LENGTH(FIN_SWAP.CCY_CALENDAR_SET)=3 THEN FIN_SWAP.CCY_CALENDAR_SET||','||
FIN_SWAP.CCY_CALENDAR_SET ELSE FIN_SWAP.CCY_CALENDAR_SET END||'-'||FIN_SWAP.END_DATE||'-'||FIN_SWAP.START_DATE||'-'||SDSBTY.NAME||'-'||ABS(TTSWFL.NOTIONAL_AMOUNT_VALUE_1)||'-'||CASE WHEN S1.FIXFLOATIND='X' THEN (TTSWFL.FIX_RATE_1) ELSE (TTSWFL.FIX_RATE_2) END*100||'-'||ABS(TTSWFL.NOTIONAL_AMOUNT_VALUE_2)
THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM SWDT S1
INNER JOIN SWDT S2 ON TRIM(S2.DEALNO)=TRIM(S1.DEALNO) AND S2.SEQ='002' 
INNER JOIN SWDH H ON trim(S1.DEALNO)=trim(H.DEALNO) AND TRIM(H.REVDATE) IS NULL
INNER JOIN CUST C ON C.CNO=H.CNO
LEFT JOIN TT_SWAP@FTMIG FIN_SWAP  ON TRIM(S1.DEALNO) = TRIM(FIN_SWAP.DEAL_IDENTIFIER) and DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_SWAP.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_SWAP.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_SWAP.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_SWAP.CPTY_FBO_ID_NUM
LEFT JOIN (SELECT * FROM (
SELECT PARENT_FBO_ID_NUM PARENT_FBO_ID_NUM_1,START_DATE START_DATE_1,END_DATE END_DATE_1,CASH_FLOW_TYPE CASH_FLOW_TYPE_1 ,LONG_OR_SHORT LONG_OR_SHORT_1,NOTIONAL_AMOUNT_CCY NOTIONAL_AMOUNT_CCY_1,
NOTIONAL_AMOUNT_VALUE NOTIONAL_AMOUNT_VALUE_1,FIX_RATE FIX_RATE_1 FROM TT_SWAP_CASH_FLOWS@FTMIG WHERE SIDE_SEQUENCE='1' AND PARENT_FBO_ID_VER='999999' AND SIDE_REFERENCE='1'
) A
LEFT JOIN(
SELECT PARENT_FBO_ID_NUM PARENT_FBO_ID_NUM_2,START_DATE START_DATE_2,END_DATE END_DATE_2,CASH_FLOW_TYPE CASH_FLOW_TYPE_2 ,LONG_OR_SHORT LONG_OR_SHORT_2,NOTIONAL_AMOUNT_CCY NOTIONAL_AMOUNT_CCY_2,
NOTIONAL_AMOUNT_VALUE NOTIONAL_AMOUNT_VALUE_2,FIX_RATE FIX_RATE_2 FROM TT_SWAP_CASH_FLOWS@FTMIG WHERE SIDE_SEQUENCE='1' AND PARENT_FBO_ID_VER='999999' AND SIDE_REFERENCE='2'
) B ON A.PARENT_FBO_ID_NUM_1 = B.PARENT_FBO_ID_NUM_2) TTSWFL ON TTSWFL.PARENT_FBO_ID_NUM_1 = FIN_SWAP.DEAL_NUM
left join (
  SELECT distinct a.PARENT_FBO_ID_NUM,a.PARENT_FBO_ID_TYPE,A.IQ_CURRENCY PAY_CCY,a.NAME pay_nos ,B.IQ_CURRENCY REC_CCY,b.NAME rec_nos  FROM (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT') A
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT') B ON A.PARENT_FBO_ID_TYPE = B.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM
  ) NOS on NOS.PARENT_FBO_ID_NUM = FIN_SWAP.DEAL_NUM AND FIN_SWAP.DEAL_TYPE =  NOS.PARENT_FBO_ID_TYPE
LEFT JOIN (
SELECT * FROM (
SELECT PARENT_FBO_ID_NUM PARENT_FBO_ID_NUM_1,LONG_OR_SHORT LONG_OR_SHORT_1,SETTLEMENT_ACTION SETTLEMENT_ACTION_1,REFERENCE_RATE_FBO_ID_NUM REFERENCE_RATE_FBO_ID_NUM_1
,BASIS_CODE BASIS_CODE_1,START_DATE START_DATE_1,END_DATE END_DATE_1,NOTIONAL_AMOUNT_CCY NOTIONAL_AMOUNT_CCY_1,NOTIONAL_AMOUNT_VALUE NOTIONAL_AMOUNT_VALUE_1,FIX_RATE FIX_RATE_1,CREATION_FREQUENCY CREATION_FREQUENCY_1 FROM TT_CF_SIDES@FTMIG WHERE SETTLEMENT_ACTION='PAY' AND PARENT_FBO_ID_NUM='106139'
)A 
JOIN (  
SELECT PARENT_FBO_ID_NUM PARENT_FBO_ID_NUM_2,LONG_OR_SHORT LONG_OR_SHORT_2,SETTLEMENT_ACTION SETTLEMENT_ACTION_2,REFERENCE_RATE_FBO_ID_NUM REFERENCE_RATE_FBO_ID_NUM_2
,BASIS_CODE BASIS_CODE_2,START_DATE START_DATE_2,END_DATE END_DATE_2,NOTIONAL_AMOUNT_CCY NOTIONAL_AMOUNT_CCY_2,NOTIONAL_AMOUNT_VALUE NOTIONAL_AMOUNT_VALUE_2,FIX_RATE FIX_RATE_2,CREATION_FREQUENCY CREATION_FREQUENCY_2 FROM TT_CF_SIDES@FTMIG WHERE SETTLEMENT_ACTION='REC' AND PARENT_FBO_ID_NUM='106139'
) B ON A.PARENT_FBO_ID_NUM_1 (+)= B.PARENT_FBO_ID_NUM_2) CF_SIDES ON CF_SIDES.PARENT_FBO_ID_NUM_1 =  FIN_SWAP.DEAL_NUM
WHERE S1.SEQ='001' AND S1.MATDATE>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY')




select DISTINCT 
S1.DEALNO ,FIN_SWAP.DEAL_IDENTIFIER,CASE WHEN TRIM(S1.DEALNO) = FIN_SWAP.DEAL_IDENTIFIER THEN 'TRUE' ELSE 'FALSE' END MATCH_DEALNO,
S1.BR OPICS_BR, CASE WHEN TRIM(S1.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END MAPPED_ENTITY, SDENT.NAME FIN_ENTITY, CASE WHEN CASE WHEN TRIM(S2.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END =  SDENT.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_ENTITY,
S1.PRODTYPE OPICS_PRODTYPE, CASE WHEN TRIM(S1.PRODTYPE)='IR' THEN 'IRSH' ELSE 'CCIRST' END MAPPED_SUBTYPE, SDSBTY.NAME ,CASE WHEN CASE WHEN TRIM(S1.PRODTYPE)='IR' THEN 'IRSH' ELSE 'CCIRST' END =  SDSBTY.NAME THEN 'TRUE' ELSE 'FALSE' END MATCH_SUBTYPE,
S1.STARTDATE OPICS_SIDE1_START_DATE ,TTSWFL.START_DATE_1 FIN_SIDE1_START_DATE,CASE WHEN S1.STARTDATE = TTSWFL.START_DATE_1 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_START_DATE,
S1.MATDATE OPICS_SIDE1_END_DATE ,FIN_SWAP.END_DATE FIN_SIDE1_END_DATE,CASE WHEN S1.MATDATE = FIN_SWAP.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_END_DATE,
CASE WHEN S1.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END OPICS_SIDE1_FIXED_FLOAT, TTSWFL.CASH_FLOW_TYPE_1 FIN_SIDE1_FIXED_FLOAT,CASE WHEN CASE WHEN S1.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END = TTSWFL.CASH_FLOW_TYPE_1 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_FIXED_FLOAT,
S1.NOTCCY OPICS_SIDE1_CCY, TTSWFL.NOTIONAL_AMOUNT_CCY_1 FIN_SIDE1_CCY,CASE WHEN S1.NOTCCY = TTSWFL.NOTIONAL_AMOUNT_CCY_1 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_CCY,
S1.NOTCCYAMT OPICS_SIDE1_AMOUNT, TTSWFL.NOTIONAL_AMOUNT_VALUE_1 FIN_SIDE1_AMOUNT,CASE WHEN S1.NOTCCYAMT = TTSWFL.NOTIONAL_AMOUNT_VALUE_1 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_AMOUNT,
S1.INTRATE_8 OPICS_SIDE1_RATE, TTSWFL.FIX_RATE_1*100 FIN_SIDE1_RATE,CASE WHEN S1.INTRATE_8 = TTSWFL.FIX_RATE_1*100 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_FIX_RATE,
S2.STARTDATE OPICS_SIDE1_START_DATE ,TTSWFL.START_DATE_2 FIN_SIDE1_START_DATE,CASE WHEN S2.STARTDATE = TTSWFL.START_DATE_2 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_START_DATE,
S2.MATDATE OPICS_SIDE1_END_DATE ,FIN_SWAP.END_DATE FIN_SIDE1_END_DATE,CASE WHEN S2.MATDATE = FIN_SWAP.END_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_END_DATE,
CASE WHEN S2.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END OPICS_SIDE1_FIXED_FLOAT, TTSWFL.CASH_FLOW_TYPE_2 FIN_SIDE1_FIXED_FLOAT,CASE WHEN CASE WHEN S2.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END = TTSWFL.CASH_FLOW_TYPE_2 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_FIXED_FLOAT,
S2.NOTCCY OPICS_SIDE1_CCY, TTSWFL.NOTIONAL_AMOUNT_CCY_2 FIN_SIDE1_CCY,CASE WHEN S2.NOTCCY = TTSWFL.NOTIONAL_AMOUNT_CCY_2 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_CCY,
S2.NOTCCYAMT OPICS_SIDE1_AMOUNT, TTSWFL.NOTIONAL_AMOUNT_VALUE_2 FIN_SIDE1_AMOUNT,CASE WHEN S2.NOTCCYAMT = TTSWFL.NOTIONAL_AMOUNT_VALUE_2 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_AMOUNT,
S2.INTRATE_8 OPICS_SIDE1_RATE, TTSWFL.FIX_RATE_2*100 FIN_SIDE1_RATE,CASE WHEN S2.INTRATE_8 = TTSWFL.FIX_RATE_2*100 THEN 'TRUE' ELSE 'FALSE' END MATCH_SIDE1_FIX_RATE,
S1.INTPAYCYCLE OPICS_PAY_INTPAYCYCLE,CF_SIDES.CREATION_FREQUENCY_1 FIN_PAY_INTPAYCYCLE, CASE WHEN TRIM(S1.INTPAYCYCLE)=TRIM(CF_SIDES.CREATION_FREQUENCY_1) THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_INTPAYCYCLE,
S2.INTPAYCYCLE OPICS_RECEIVE_INTPAYCYCLE,CF_SIDES.CREATION_FREQUENCY_2 FIN_REC_INTPAYCYCLE ,  CASE WHEN TRIM(S2.INTPAYCYCLE)=TRIM(CF_SIDES.CREATION_FREQUENCY_2) THEN 'TRUE' ELSE 'FALSE' END MATCH_REC_INTPAYCYCLE,
case when s1.PRODTYPE='IR' and s1.INTSMEANS='NOS' then s1.INTSACCT else 'BRIDGE_'||TRIM(s1.NOTCCY)||CASE WHEN TRIM(s1.BR)='51' THEN '_ABKU' ELSE '_ABKK' END  end OPICS_PAY_NOSTRO,PAY_NOS FIN_PAY_NOS, CASE WHEN TRIM(case when s1.PRODTYPE='IR' and s1.INTSMEANS='NOS' then s1.INTSACCT else 'BRIDGE_'||TRIM(s1.NOTCCY)||CASE WHEN TRIM(s1.BR)='51' THEN '_ABKU' ELSE '_ABKK' END  end) =TRIM(PAY_NOS) THEN 'TRUE' ELSE 'FALSE' END MATCH_PAY_NOS,
case when s2.PRODTYPE='IR' and s2.INTSMEANS='NOS' then s2.INTSACCT else 'BRIDGE_'||TRIM(s2.NOTCCY)||CASE WHEN TRIM(s2.BR)='51' THEN '_ABKU' ELSE '_ABKK' END  end OPICS_REC_NOSTRO,REC_NOS FIN_REC_NOS, CASE WHEN TRIM(case when s2.PRODTYPE='IR' and s2.INTSMEANS='NOS' then s2.INTSACCT else 'BRIDGE_'||TRIM(s2.NOTCCY)||CASE WHEN TRIM(s2.BR)='51' THEN '_ABKU' ELSE '_ABKK' END  end) = TRIM(REC_NOS) THEN 'TRUE' ELSE 'FALSE' END MATCH_REC_NOS,     
S1.BR||'-'||S1.DEALNO||'-'||S1.FIXFLOATIND||'-'||TRIM(C.CMNE) ||'-'||S1.NOTCCY||','||S2.NOTCCY||'-'||S1.MATDATE||'-'||S1.STARTDATE||'-'||S1.PRODTYPE||'-'||S1.NOTCCYAMT||'-'||S1.INTRATE_8 OPICS_DATA,
CASE WHEN TRIM(S1.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||S1.DEALNO||'-'||CASE WHEN S1.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END||'-'||TRIM(C.CMNE) ||'-'||S1.NOTCCY||','||
S2.NOTCCY||'-'||S1.MATDATE||'-'||S1.STARTDATE||'-'||CASE WHEN TRIM(S1.PRODTYPE)='IR' THEN 'IRSH' ELSE 'CCIRST' END||'-'||ABS(S1.NOTCCYAMT)||'-'||CASE WHEN S1.FIXFLOATIND='X' THEN (S1.INTRATE_8) ELSE (S2.INTRATE_8) END ||'-'||ABS(S2.NOTCCYAMT) CONV_OPICS_DATA,
FIN_SWAP.SDENT.NAME||'-'||FIN_SWAP.DEAL_IDENTIFIER||'-'||CASH_FLOW_TYPE_1||'-'||SDCP.NAME||'-'||CASE WHEN LENGTH(FIN_SWAP.CCY_CALENDAR_SET)=3 THEN FIN_SWAP.CCY_CALENDAR_SET||','||
FIN_SWAP.CCY_CALENDAR_SET ELSE FIN_SWAP.CCY_CALENDAR_SET END ||'-'||FIN_SWAP.END_DATE||'-'||FIN_SWAP.START_DATE||'-'||SDSBTY.NAME||'-'||ABS(TTSWFL.NOTIONAL_AMOUNT_VALUE_1)||'-'||CASE WHEN S1.FIXFLOATIND='X' THEN (TTSWFL.FIX_RATE_1) ELSE (TTSWFL.FIX_RATE_2) END*100 ||'-'||ABS(TTSWFL.NOTIONAL_AMOUNT_VALUE_2) FIN_DATA,
CASE WHEN CASE WHEN TRIM(S1.BR)='51' THEN 'ABKUAE' ELSE 'ABKKWT' END||'-'||S1.DEALNO||'-'||CASE WHEN S1.FIXFLOATIND='L' THEN 'FLOAT' ELSE 'FIXED' END||'-'||TRIM(C.CMNE) ||'-'||
S1.NOTCCY||','||S2.NOTCCY||'-'||S1.MATDATE||'-'||S1.STARTDATE||'-'||CASE WHEN TRIM(S1.PRODTYPE)='IR' THEN 'IRSH' ELSE 'CCIRST' END||'-'||ABS(S1.NOTCCYAMT)||'-'||CASE WHEN S1.FIXFLOATIND='X' THEN (S1.INTRATE_8) ELSE (S2.INTRATE_8) END||'-'||ABS(S2.NOTCCYAMT)  =
FIN_SWAP.SDENT.NAME||'-'||FIN_SWAP.DEAL_IDENTIFIER||'-'||CASH_FLOW_TYPE_1||'-'||SDCP.NAME||'-'||CASE WHEN LENGTH(FIN_SWAP.CCY_CALENDAR_SET)=3 THEN FIN_SWAP.CCY_CALENDAR_SET||','||
FIN_SWAP.CCY_CALENDAR_SET ELSE FIN_SWAP.CCY_CALENDAR_SET END||'-'||FIN_SWAP.END_DATE||'-'||FIN_SWAP.START_DATE||'-'||SDSBTY.NAME||'-'||ABS(TTSWFL.NOTIONAL_AMOUNT_VALUE_1)||'-'||CASE WHEN S1.FIXFLOATIND='X' THEN (TTSWFL.FIX_RATE_1) ELSE (TTSWFL.FIX_RATE_2) END*100||'-'||ABS(TTSWFL.NOTIONAL_AMOUNT_VALUE_2)
THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA
FROM (select * from SWDT where trim(PAYRECIND)='P') S1 
INNER JOIN (select * from SWDT where trim(PAYRECIND)='R') S2 ON trim(S2.DEALNO)=trim(S1.DEALNO) 
INNER JOIN SWDH H ON trim(S1.DEALNO)=trim(H.DEALNO) AND TRIM(H.REVDATE) IS NULL
INNER JOIN CUST C ON C.CNO=H.CNO
LEFT JOIN TT_SWAP@FTMIG FIN_SWAP  ON TRIM(FIN_SWAP.DEAL_IDENTIFIER) like TRIM(S1.DEALNO)||'%' and DEAL_STATE!='DLTD'
LEFT JOIN SD_TRADING_BOOK@FTMIG SDTRBK ON SDTRBK.FBO_ID_NUM = FIN_SWAP.TRADING_BOOK_FBO_ID_NUM
LEFT JOIN SD_ENTITY@FTMIG SDENT ON SDENT.FBO_ID_NUM = FIN_SWAP.ENTITY_FBO_ID_NUM
LEFT JOIN SD_SUBTYPE@FTMIG SDSBTY ON SDSBTY.FBO_ID_NUM = FIN_SWAP.SUBTYPE_FBO_ID_NUM
LEFT JOIN SD_CPTY@FTMIG SDCP ON SDCP.FBO_ID_NUM= FIN_SWAP.CPTY_FBO_ID_NUM
LEFT JOIN (SELECT * FROM (
SELECT PARENT_FBO_ID_NUM PARENT_FBO_ID_NUM_1,START_DATE START_DATE_1,END_DATE END_DATE_1,CASH_FLOW_TYPE CASH_FLOW_TYPE_1 ,LONG_OR_SHORT LONG_OR_SHORT_1,NOTIONAL_AMOUNT_CCY NOTIONAL_AMOUNT_CCY_1,
NOTIONAL_AMOUNT_VALUE NOTIONAL_AMOUNT_VALUE_1,FIX_RATE FIX_RATE_1 FROM TT_SWAP_CASH_FLOWS@FTMIG WHERE SIDE_SEQUENCE='1' AND PARENT_FBO_ID_VER='999999' AND SIDE_REFERENCE='1'
) A
LEFT JOIN(
SELECT PARENT_FBO_ID_NUM PARENT_FBO_ID_NUM_2,START_DATE START_DATE_2,END_DATE END_DATE_2,CASH_FLOW_TYPE CASH_FLOW_TYPE_2 ,LONG_OR_SHORT LONG_OR_SHORT_2,NOTIONAL_AMOUNT_CCY NOTIONAL_AMOUNT_CCY_2,
NOTIONAL_AMOUNT_VALUE NOTIONAL_AMOUNT_VALUE_2,FIX_RATE FIX_RATE_2 FROM TT_SWAP_CASH_FLOWS@FTMIG WHERE SIDE_SEQUENCE='1' AND PARENT_FBO_ID_VER='999999' AND SIDE_REFERENCE='2'
) B ON A.PARENT_FBO_ID_NUM_1 = B.PARENT_FBO_ID_NUM_2) TTSWFL ON TTSWFL.PARENT_FBO_ID_NUM_1 = FIN_SWAP.DEAL_NUM
left join (
  SELECT distinct a.PARENT_FBO_ID_NUM,a.PARENT_FBO_ID_TYPE,A.IQ_CURRENCY PAY_CCY,a.NAME pay_nos ,B.IQ_CURRENCY REC_CCY,b.NAME rec_nos  FROM (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='P' AND ACTION!='DLT') A
  LEFT JOIN (SELECT * FROM TT_SETT_INS_FLOWS@FTMIG  SIFL
  LEFT JOIN SD_NOSTRO@FTMIG SDNOS  ON SDNOS.FBO_ID_NUM = SIFL.NOSTRO_FBO_ID_NUM WHERE PAY_REC='R' AND ACTION!='DLT') B ON A.PARENT_FBO_ID_TYPE = B.PARENT_FBO_ID_TYPE AND A.PARENT_FBO_ID_NUM = B.PARENT_FBO_ID_NUM
  ) NOS on NOS.PARENT_FBO_ID_NUM = FIN_SWAP.DEAL_NUM AND FIN_SWAP.DEAL_TYPE =  NOS.PARENT_FBO_ID_TYPE
LEFT JOIN (
SELECT * FROM (
SELECT PARENT_FBO_ID_NUM PARENT_FBO_ID_NUM_1,LONG_OR_SHORT LONG_OR_SHORT_1,SETTLEMENT_ACTION SETTLEMENT_ACTION_1,REFERENCE_RATE_FBO_ID_NUM REFERENCE_RATE_FBO_ID_NUM_1
,BASIS_CODE BASIS_CODE_1,START_DATE START_DATE_1,END_DATE END_DATE_1,NOTIONAL_AMOUNT_CCY NOTIONAL_AMOUNT_CCY_1,NOTIONAL_AMOUNT_VALUE NOTIONAL_AMOUNT_VALUE_1,FIX_RATE FIX_RATE_1,CREATION_FREQUENCY CREATION_FREQUENCY_1 FROM TT_CF_SIDES@FTMIG WHERE SETTLEMENT_ACTION='PAY' --AND PARENT_FBO_ID_NUM='106139'
)A 
JOIN (  
SELECT PARENT_FBO_ID_NUM PARENT_FBO_ID_NUM_2,LONG_OR_SHORT LONG_OR_SHORT_2,SETTLEMENT_ACTION SETTLEMENT_ACTION_2,REFERENCE_RATE_FBO_ID_NUM REFERENCE_RATE_FBO_ID_NUM_2
,BASIS_CODE BASIS_CODE_2,START_DATE START_DATE_2,END_DATE END_DATE_2,NOTIONAL_AMOUNT_CCY NOTIONAL_AMOUNT_CCY_2,NOTIONAL_AMOUNT_VALUE NOTIONAL_AMOUNT_VALUE_2,FIX_RATE FIX_RATE_2,CREATION_FREQUENCY CREATION_FREQUENCY_2 FROM TT_CF_SIDES@FTMIG WHERE SETTLEMENT_ACTION='REC' --AND PARENT_FBO_ID_NUM='106139'
) B ON A.PARENT_FBO_ID_NUM_1 (+)= B.PARENT_FBO_ID_NUM_2) CF_SIDES ON CF_SIDES.PARENT_FBO_ID_NUM_1 =  FIN_SWAP.DEAL_NUM
WHERE S1.MATDATE>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
tr_ssi_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
tr_ssi_report.sql 
select 
a.SSI_ID||'-'||a.CPTY_NAME||'-'||a.SSI_SETTLEMENT_ACTION||'-'||TO_DATE(A.EFFECTIVE_DATE,'DD-MON-YYYY')||'-'||
case when a.SSI_TYPE='INT/COUPON' then 'INC' when  a.SSI_TYPE='PRINCIPAL' then 'PRI' end||'-'||a.NOSTRO_ID OPICS_DATA,
b.SSI_ID||'-'||trim(c.name)||'-'||b.SETTLEMENT_ACTION||'-'||b.EFFECTIVE_DATE||'-'||b.SSI_TYPE||'-'||b.NOSTRO_ID FIN_DATA,
CASE WHEN a.SSI_ID||'-'||a.CPTY_NAME||'-'||a.SSI_SETTLEMENT_ACTION||'-'||TO_DATE(A.EFFECTIVE_DATE,'DD-MON-YYYY')||'-'||
case when a.SSI_TYPE='INT/COUPON' then 'INC' when  a.SSI_TYPE='PRINCIPAL' then 'PRI' end||'-'||a.NOSTRO_ID = 
b.SSI_ID||'-'||trim(c.name)||'-'||b.SETTLEMENT_ACTION||'-'||b.EFFECTIVE_DATE||'-'||b.SSI_TYPE||'-'||b.NOSTRO_ID THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA 
from (
select * from TREASURY_REC_SSI_O_TABLE
union
select * from TREASURY_PAY_SSI_O_TABLE
) a
left join sd_cpty_ssi@ftmig b on a.SSI_ID = b.SSI_ID
left join sd_cpty@ftmig c on b.CPTY_FBO_ID_NUM = c.FBO_ID_NUM 



select 
a.SSI_ID MAPPED_SSI_ID,b.SSI_ID FIN_SSI_ID, CASE WHEN a.SSI_ID = b.SSI_ID THEN 'TRUE' ELSE 'FALSE' END MATCH_SSI_ID,
a.CPTY_NAME OPICS_CPTY,trim(c.name) FIN_CPTY,CASE WHEN a.CPTY_NAME= trim(c.name) THEN 'TRUE' ELSE 'FALSE' END MATCH_CPTY,
a.SSI_SETTLEMENT_ACTION MAPPED_SETTLEMENT_ACTION,b.SETTLEMENT_ACTION FIN_SETTLEMENT_ACTION,CASE WHEN a.SSI_SETTLEMENT_ACTION = b.SETTLEMENT_ACTION THEN 'TRUE' ELSE 'FALSE' END MATCH_SETTLEMENT_ACTION,
TO_DATE(A.EFFECTIVE_DATE,'DD-MON-YYYY') MAPPED_EFFECTIVE_DATE,b.EFFECTIVE_DATE FIN_EFFECTIVE_DATE,CASE WHEN TO_DATE(A.EFFECTIVE_DATE,'DD-MON-YYYY') = b.EFFECTIVE_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_EFFECTIVE_DATE,
case when a.SSI_TYPE='INT/COUPON' then 'INC' when  a.SSI_TYPE='PRINCIPAL' then 'PRI' end MAPPED_SSI_TYPE,b.SSI_TYPE FIN_SSI_TYPE,CASE WHEN case when a.SSI_TYPE='INT/COUPON' then 'INC' when  a.SSI_TYPE='PRINCIPAL' then 'PRI' end = b.SSI_TYPE THEN 'TRUE' ELSE 'FALSE' END MATCH_SSI_TYPE,
a.NOSTRO_ID OPICS_NOSTRO_ID,b.NOSTRO_ID FIN_NOSTRO_ID,CASE WHEN a.NOSTRO_ID = b.NOSTRO_ID THEN 'TRUE' ELSE 'FALSE' END MATCH_NOSTRO_ID,
A.ALT_BENEF_BIC OPICS_BENEF_BIC,B.ALT_BENEF_BIC FIN_BENEF_BIC,CASE WHEN NVL(A.ALT_BENEF_BIC,' ') = NVL(B.ALT_BENEF_BIC,' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_BENEF_BIC,
a.SSI_ID||'-'||a.CPTY_NAME||'-'||a.SSI_SETTLEMENT_ACTION||'-'||TO_DATE(A.EFFECTIVE_DATE,'DD-MON-YYYY')||'-'||
case when a.SSI_TYPE='INT/COUPON' then 'INC' when  a.SSI_TYPE='PRINCIPAL' then 'PRI' end||'-'||a.NOSTRO_ID OPICS_DATA,
b.SSI_ID||'-'||trim(c.name)||'-'||b.SETTLEMENT_ACTION||'-'||b.EFFECTIVE_DATE||'-'||b.SSI_TYPE||'-'||b.NOSTRO_ID FIN_DATA,
CASE WHEN a.SSI_ID||'-'||a.CPTY_NAME||'-'||a.SSI_SETTLEMENT_ACTION||'-'||TO_DATE(A.EFFECTIVE_DATE,'DD-MON-YYYY')||'-'||
case when a.SSI_TYPE='INT/COUPON' then 'INC' when  a.SSI_TYPE='PRINCIPAL' then 'PRI' end||'-'||a.NOSTRO_ID = 
b.SSI_ID||'-'||trim(c.name)||'-'||b.SETTLEMENT_ACTION||'-'||b.EFFECTIVE_DATE||'-'||b.SSI_TYPE||'-'||b.NOSTRO_ID THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA 
from (
select * from TREASURY_REC_SSI_O_TABLE
union
select * from TREASURY_PAY_SSI_O_TABLE
) a
left join sd_cpty_ssi@ftmig b on a.SSI_ID = b.SSI_ID
left join sd_cpty@ftmig c on b.CPTY_FBO_ID_NUM = c.FBO_ID_NUM 


select 
a.SSI_ID MAPPED_SSI_ID,b.SSI_ID FIN_SSI_ID, CASE WHEN a.SSI_ID = b.SSI_ID THEN 'TRUE' ELSE 'FALSE' END MATCH_SSI_ID,
a.CPTY_NAME OPICS_CPTY,trim(c.name) FIN_CPTY,CASE WHEN a.CPTY_NAME= trim(c.name) THEN 'TRUE' ELSE 'FALSE' END MATCH_CPTY,
a.SSI_SETTLEMENT_ACTION MAPPED_SETTLEMENT_ACTION,b.SETTLEMENT_ACTION FIN_SETTLEMENT_ACTION,CASE WHEN a.SSI_SETTLEMENT_ACTION = b.SETTLEMENT_ACTION THEN 'TRUE' ELSE 'FALSE' END MATCH_SETTLEMENT_ACTION,
TO_DATE(A.EFFECTIVE_DATE,'DD-MON-YYYY') MAPPED_EFFECTIVE_DATE,b.EFFECTIVE_DATE FIN_EFFECTIVE_DATE,CASE WHEN TO_DATE(A.EFFECTIVE_DATE,'DD-MON-YYYY') = b.EFFECTIVE_DATE THEN 'TRUE' ELSE 'FALSE' END MATCH_EFFECTIVE_DATE,
case when a.SSI_TYPE='INT/COUPON' then 'INC' when  a.SSI_TYPE='PRINCIPAL' then 'PRI' end MAPPED_SSI_TYPE,b.SSI_TYPE FIN_SSI_TYPE,CASE WHEN case when a.SSI_TYPE='INT/COUPON' then 'INC' when  a.SSI_TYPE='PRINCIPAL' then 'PRI' end = b.SSI_TYPE THEN 'TRUE' ELSE 'FALSE' END MATCH_SSI_TYPE,
a.NOSTRO_ID OPICS_NOSTRO_ID,b.NOSTRO_ID FIN_NOSTRO_ID,CASE WHEN a.NOSTRO_ID = b.NOSTRO_ID THEN 'TRUE' ELSE 'FALSE' END MATCH_NOSTRO_ID,
A.ALT_BENEF_BIC OPICS_BENEF_BIC,B.ALT_BENEF_BIC FIN_BENEF_BIC,CASE WHEN NVL(A.ALT_BENEF_BIC,' ') = NVL(B.ALT_BENEF_BIC,' ') THEN 'TRUE' ELSE 'FALSE' END MATCH_BENEF_BIC,
a.SSI_ID||'-'||a.CPTY_NAME||'-'||a.SSI_SETTLEMENT_ACTION||'-'||TO_DATE(A.EFFECTIVE_DATE,'DD-MON-YYYY')||'-'||
case when a.SSI_TYPE='INT/COUPON' then 'INC' when  a.SSI_TYPE='PRINCIPAL' then 'PRI' end||'-'||a.NOSTRO_ID OPICS_DATA,
b.SSI_ID||'-'||trim(c.name)||'-'||b.SETTLEMENT_ACTION||'-'||b.EFFECTIVE_DATE||'-'||b.SSI_TYPE||'-'||b.NOSTRO_ID FIN_DATA,
CASE WHEN a.SSI_ID||'-'||a.CPTY_NAME||'-'||a.SSI_SETTLEMENT_ACTION||'-'||TO_DATE(A.EFFECTIVE_DATE,'DD-MON-YYYY')||'-'||
case when a.SSI_TYPE='INT/COUPON' then 'INC' when  a.SSI_TYPE='PRINCIPAL' then 'PRI' end||'-'||a.NOSTRO_ID = 
b.SSI_ID||'-'||trim(c.name)||'-'||b.SETTLEMENT_ACTION||'-'||b.EFFECTIVE_DATE||'-'||b.SSI_TYPE||'-'||b.NOSTRO_ID THEN 'TRUE' ELSE 'FALSE' END MATCH_DATA 
from (
select * from TREASURY_pay_SSI_O_TABLE
) a
left join sd_cpty_ssi@ftmig b on a.SSI_ID = b.SSI_ID
left join sd_cpty@ftmig c on b.CPTY_FBO_ID_NUM = c.FBO_ID_NUM  
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
ttum4_try_validation.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
ttum4_try_validation.sql 

--BACID
select a.BACID, CCY, amount, b.BACID, ACCT_CRNCY_CODE, CLR_BAL_AMT,case when amount=CLR_BAL_AMT then 'TRUE' else 'FALSE' end match_amount from ( 
select  CR_BACID BACID,CCY,sum(CR_AMOUNT) amount from TREASURY_POSITION group by CR_BACID,CCY having sum(CR_AMOUNT)  <>0
union
select  DR_BACID,CCY,sum(DR_AMOUNT)  from TREASURY_POSITION group by DR_BACID,CCY having sum(DR_AMOUNT)  <>0
) a
join (
select BACID,ACCT_CRNCY_CODE,sum(clr_bal_amt) CLR_BAL_AMT from tbaadm.gam where BACID in(select CR_BACID from TREASURY_POSITION
union
select DR_BACID from TREASURY_POSITION) and clr_bal_amt <>0 and SOL_ID='005' group by BACID,SOL_ID,ACCT_CRNCY_CODE
) b
on a.BACID = b.BACID(+) and a.CCY = b.ACCT_CRNCY_CODE(+)
--------------------------------------------------------------------------------------------------------------

--ACCOUNT
select * from (
SELECT to_char(ACCOUNT_NUMBER) ACCOUNT_NUMBER ,CURRENCY_CODE,case when PART_TRAN_TYPE='D' then '-1' else '1' end*SUM(TRANSACTION_AMOUNT) TRANSACTION_AMOUNT  FROM TTUM4_TRY_O_TABLE GROUP BY  ACCOUNT_NUMBER,CURRENCY_CODE,case when PART_TRAN_TYPE='D' then '-1' else '1' end having SUM(TRANSACTION_AMOUNT) <> 0
) a
left join 
(SELECT to_char(foracid) foracid,ACCT_CRNCY_CODE,SUM(CLR_BAL_AMT) FROM TBAADM.GAM  WHERE foracid IN(SELECT trim(ACCOUNT_NUMBER) FROM TTUM4_TRY_O_TABLE)
GROUP BY  foracid,ACCT_CRNCY_CODE HAVING  SUM(CLR_BAL_AMT) <> 0
) b on trim(a.ACCOUNT_NUMBER) = b.foracid




 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
volume_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
volume_report.sql 
--COM LOAN


SELECT A.DEAL_TYPE,a.currency opics_currency,A.com_loan_deal_count OPICS_DEAL_COUNT,A.total_amt  OPICS_DEAL_AMOUNT,b.currency finacle_currency,B.com_loan_deal_count FINACLE_DEAL_COUNT,B.total_amt FINACLE_DEAL_AMOUNT FROM 
(
select 'COM_LOAN' DEAL_TYPE,d.ccy currency,count(S.DEALNO) com_loan_deal_count,sum(D.CCYAMT) total_amt 
FROM DLDT D
INNER JOIN CUST C ON TRIM(D.CNO)=TRIM(C.CNO)
LEFT JOIN SCHD S ON TRIM(D.DEALNO)=TRIM(S.DEALNO) AND S.SCHDSEQ='001' AND D.BR=S.BR 
left join  FTABKBPD.TT_COM_LOAN@FTFC FIN_COM_LOAN on TRIM(D.DEALNO)=TRIM(FIN_COM_LOAN.DEAL_IDENTIFIER)
WHERE D.MDATE>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND TRIM(D.REVDATE) IS NULL
and D.BR='01'
group by d.ccy
) A
full JOIN 
(
select 'COM_LOAN' DEAL_TYPE ,CURRENCY_LIST currency,count(1) com_loan_deal_count,sum(TTCMFL.NOTIONAL_AMOUNT_VALUE) total_amt 
from  FTABKBPD.TT_COM_LOAN@FTFC FIN_COM_LOAN 
left JOIN FTABKBPD.TT_CMLOAN_CASH_FLOWS@FTFC TTCMFL ON TRIM(TTCMFL.PARENT_FBO_ID_NUM) = TRIM(FIN_COM_LOAN.DEAL_NUM) and TTCMFL.SIDE_SEQUENCE='1'
LEFT JOIN FTABKBPD.SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = FIN_COM_LOAN.ENTITY_FBO_ID_NUM
where FIN_COM_LOAN.SUBTYPE_FBO_ID_NUM NOT IN (SELECT FBO_ID_NUM FROM FTABKBPD.SD_SUBTYPE@FTFC WHERE TRIM(DESCRIPTION) IN ('REPO deal with Banks','REPO deal with Central Banks'))
AND SDENT.NAME='ABKKWT' and DEAL_STATE!='DLTD' 
group by CURRENCY_LIST
)B ON A.DEAL_TYPE = B.DEAL_TYPE and a.currency = b.currency;


----------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------

--REPO
SELECT A.DEAL_TYPE,a.currency opics_currency,A.deal_count OPICS_DEAL_COUNT,A.total_amt  OPICS_DEAL_AMOUNT,b.currency finacle_currency,B.deal_count FINACLE_DEAL_COUNT,B.total_amt FINACLE_DEAL_AMOUNT FROM 
(
SELECT 'REPO' DEAL_TYPE,D.CCY currency,count(*) deal_count,sum(R.PROCEEDAMT) total_amt 
FROM RPRH D
LEFT JOIN CUST C ON TRIM(D.CNO)=TRIM(C.CNO)
LEFT JOIN RPDT R ON TRIM(D.DEALNO)=TRIM(R.DEALNO)
WHERE R.MDATE>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND TRIM(R.REVDATE) IS NULL AND D.BR='01'
group by D.CCY
) A
left JOIN (
SELECT  'REPO' DEAL_TYPE,CURRENCY_LIST currency,count(*) deal_count ,SUM(TTCMFL.NOTIONAL_AMOUNT_VALUE) total_amt
FROM  FTABKBPD.TT_COM_LOAN@FTFC FIN_REPO 
LEFT JOIN FTABKBPD.SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = FIN_REPO.ENTITY_FBO_ID_NUM
LEFT JOIN FTABKBPD.TT_CMLOAN_CASH_FLOWS@FTFC TTCMFL ON TTCMFL.PARENT_FBO_ID_NUM = FIN_REPO.DEAL_NUM and TTCMFL.SIDE_SEQUENCE='1'
WHERE SUBTYPE_FBO_ID_NUM IN (SELECT FBO_ID_NUM FROM FTABKBPD.SD_SUBTYPE@FTFC WHERE TRIM(DESCRIPTION) IN ('REPO deal with Banks','REPO deal with Central Banks'))
AND SDENT.NAME='ABKKWT'
group by CURRENCY_LIST
) B
ON A.DEAL_TYPE = B.DEAL_TYPE;

--------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------

--FX OUTRIGHT ***
SELECT A.DEAL_TYPE,a.currency opics_currency, A.deal_count OPICS_DEAL_COUNT,A.total_amt  OPICS_DEAL_AMOUNT,b.currency finacle_currency,B.deal_count FINACLE_DEAL_COUNT,B.total_amt FINACLE_DEAL_AMOUNT FROM 
(
SELECT 'FX_OUTRIGHT' DEAL_TYPE,(CASE WHEN CCYTERMS='M' THEN TRIM(CCY) ELSE TRIM(CTRCCY) END) currency,count(*) deal_count,sum(
CASE WHEN CCYTERMS='M' THEN (CCYAMT) ELSE (CTRAMT) END) total_amt  FROM
 FXDH F
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(F.CUST)
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND TRIM(PRODCODE)!='CCS' AND TRIM(REVDATE) IS NULL AND TRIM(SWAPDEAL)='0' AND  SPOTFWDIND='F'
AND TRIM(C.CMNE)!='CCIRS' and trim(PORT)!='EQFX' AND F.BR='01'
group by (CASE WHEN CCYTERMS='M' THEN TRIM(CCY) ELSE TRIM(CTRCCY) END)
) A
full JOIN (
SELECT 'FX_OUTRIGHT' DEAL_TYPE,TTFXFL.CCY_ONE_AMOUNT_CCY currency,count(*) deal_count ,SUM(TTFXFL.CCY_ONE_AMOUNT_VALUE) total_amt
from FTABKBPD.TT_FXP_DEAL@FTFC FIN_FX_OUTRIGHT
LEFT JOIN FTABKBPD.SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN FTABKBPD.TT_FXP_FLOW@FTFC TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM 
WHERE FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD' AND SDENT.NAME='ABKKWT' and FIN_FX_OUTRIGHT.deal_num !=FIN_FX_OUTRIGHT.deal_identifier
group by TTFXFL.CCY_ONE_AMOUNT_CCY 
) B ON  A.DEAL_TYPE = B.DEAL_TYPE and a.currency = b.currency;

--------------

SELECT 'FX_OUTRIGHT'  opics_DEAL_TYPE,count(*) opics_deal_count,CCY opics_currency1,sum(
CCYAMT) opics_total_amt1,CTRCCY opics_currency2,sum(
CTRAMT) opics_total_am2  FROM
 FXDH F
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(F.CUST)
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND TRIM(PRODCODE)!='CCS' AND TRIM(REVDATE) IS NULL AND TRIM(SWAPDEAL)='0' AND  SPOTFWDIND='F'
AND TRIM(C.CMNE)!='CCIRS' and trim(PORT)!='EQFX' AND F.BR='01'
group by CCY,CTRCCY;

SELECT 'FX_OUTRIGHT'  finacle_DEAL_TYPE,count(*) finacle_deal_count ,TTFXFL.CCY_ONE_AMOUNT_CCY finacle_currency1,SUM(TTFXFL.CCY_ONE_AMOUNT_VALUE) finacle_total_amt1,TTFXFL.CCY_two_AMOUNT_CCY finacle_currency2,SUM(TTFXFL.CCY_two_AMOUNT_VALUE) finacle_total_amt2
from FTABKBPD.TT_FXP_DEAL@FTFC FIN_FX_OUTRIGHT
LEFT JOIN FTABKBPD.SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = FIN_FX_OUTRIGHT.ENTITY_FBO_ID_NUM
LEFT JOIN FTABKBPD.TT_FXP_FLOW@FTFC TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_OUTRIGHT.DEAL_NUM 
WHERE FIN_FX_OUTRIGHT.DEAL_TYPE='FXPLOU' AND FIN_FX_OUTRIGHT.DEAL_STATE!='DLTD' AND SDENT.NAME='ABKKWT' and FIN_FX_OUTRIGHT.deal_num !=FIN_FX_OUTRIGHT.deal_identifier
group by TTFXFL.CCY_ONE_AMOUNT_CCY ,TTFXFL.CCY_two_AMOUNT_CCY ;


------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------

--FX SPOT   ***

SELECT A.DEAL_TYPE,a.currency opics_currency,A.deal_count OPICS_DEAL_COUNT,A.total_amt  OPICS_DEAL_AMOUNT,b.currency finacle_currency,B.deal_count FINACLE_DEAL_COUNT,B.total_amt FINACLE_DEAL_AMOUNT FROM 
(
SELECT 'FX_SPOT' DEAL_TYPE,CASE WHEN CCYTERMS='M' THEN TRIM(CCY) ELSE TRIM(CTRCCY) END currency,count(*) deal_count,sum(TO_CHAR(CASE WHEN CCYTERMS='M' THEN (CCYAMT) ELSE (CTRAMT) END,'9999999999999999990.99999999')) total_amt 
FROM FXDH F
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(F.CUST)
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND SPOTFWDIND='S' AND TRIM(SWAPDEAL)='0' AND TRIM(REVDATE) IS NULL 
AND TRIM(C.CMNE)!='CCIRS' and trim(port) !='EQFX' AND F.BR='01'
group by CASE WHEN CCYTERMS='M' THEN TRIM(CCY) ELSE TRIM(CTRCCY) END
)A
full JOIN (
SELECT  'FX_SPOT' DEAL_TYPE,TTFXFL.CCY_ONE_AMOUNT_CCY currency,count(*) deal_count ,SUM(TTFXFL.CCY_ONE_AMOUNT_VALUE) total_amt
FROM ftabkbpd.TT_FXP_DEAL@ftfc FIN_FX_SPOT
LEFT JOIN FTABKBPD.SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = FIN_FX_SPOT.ENTITY_FBO_ID_NUM
LEFT JOIN FTABKBPD.TT_FXP_FLOW@FTFC TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_SPOT.DEAL_NUM
WHERE FIN_FX_SPOT.DEAL_TYPE='FXPLSP' AND FIN_FX_SPOT.DEAL_STATE!='DLTD' AND SDENT.NAME='ABKKWT'
group by TTFXFL.CCY_ONE_AMOUNT_CCY
) B  ON  A.DEAL_TYPE = B.DEAL_TYPE and a.currency = b.currency;


----------------------


SELECT 'FX_SPOT' opics_DEAL_TYPE,count(*) opics_deal_count,CCY opics_currency1,sum(CCYAMT) opics_total_amt1 , CTRCCY opics_currency2,sum(CTRAMT) total_amt2 
FROM FXDH F
INNER JOIN CUST C ON TRIM(C.CNO)=TRIM(F.CUST)
WHERE TO_DATE(VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY') AND SPOTFWDIND='S' AND TRIM(SWAPDEAL)='0' AND TRIM(REVDATE) IS NULL 
AND TRIM(C.CMNE)!='CCIRS' and trim(port) !='EQFX' AND F.'51'
group by CCY,CTRCCY;

SELECT  'FX_SPOT' finacle_DEAL_TYPE,count(*) finacle_deal_count,TTFXFL.CCY_ONE_AMOUNT_CCY finacle_currency1 ,SUM(TTFXFL.CCY_ONE_AMOUNT_VALUE) finacle_total_amt1,TTFXFL.CCY_TWO_AMOUNT_CCY finacle_currency2 ,SUM(TTFXFL.CCY_TWO_AMOUNT_VALUE) finacle_total_amt2
FROM ftabkbpd.TT_FXP_DEAL@ftfc FIN_FX_SPOT
LEFT JOIN FTABKBPD.SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = FIN_FX_SPOT.ENTITY_FBO_ID_NUM
LEFT JOIN FTABKBPD.TT_FXP_FLOW@FTFC TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = FIN_FX_SPOT.DEAL_NUM
WHERE FIN_FX_SPOT.DEAL_TYPE='FXPLSP' AND FIN_FX_SPOT.DEAL_STATE!='DLTD' AND SDENT.NAME='ABKKWT'
group by TTFXFL.CCY_ONE_AMOUNT_CCY,TTFXFL.CCY_TWO_AMOUNT_CCY


----------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------

--SWAP

SELECT 'SWAP' DEAL_TYPE,count(*) deal_count,S1.NOTCCY PAY_SIDE_NOTIONAL_AMOUNT_CCY,sum(S1.NOTCCYAMT) PAY_SIDE_NOTIONAL_AMT_VALUE,
S2.NOTCCY RECEIVE_SIDE_NOTIONAL_AMT_CCY,sum(S2.NOTCCYAMT) RECEIV_SIDE_NOTIONAL_AMT_VALUE
FROM SWDT S1 
INNER JOIN SWDT S2 ON S2.DEALNO=S1.DEALNO AND S2.SEQ='002' 
INNER JOIN SWDH H ON trim(S1.DEALNO)=trim(H.DEALNO) AND TRIM(H.REVDATE) IS NULL
INNER JOIN CUST C ON C.CNO=H.CNO
WHERE S1.SEQ='001' AND S1.MATDATE>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY')
AND trim(S1.BR)='01'
group by S1.NOTCCY,S2.NOTCCY;

SELECT 'SWAP' DEAL_TYPE,count(*) deal_count,TTSWFL.PAY_NOTIONAL_AMOUNT_CCY ,SUM(TTSWFL.PAY_NOTIONAL_AMOUNT_VALUE) PAY_NOTIONAL_AMOUNT_VALUE,TTSWFL.REC_NOTIONAL_AMOUNT_CCY ,SUM(TTSWFL.REC_NOTIONAL_AMOUNT_VALUE) REC_NOTIONAL_AMOUNT_VALUE
FROM FTABKBPD.TT_SWAP@FTFC FIN_SWAP
LEFT JOIN FTABKBPD.SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = FIN_SWAP.ENTITY_FBO_ID_NUM
LEFT JOIN (select distinct TTSWFL_PAY.PARENT_FBO_ID_NUM,TTSWFL_PAY.NOTIONAL_AMOUNT_CCY  PAY_NOTIONAL_AMOUNT_CCY,TTSWFL_PAY.NOTIONAL_AMOUNT_VALUE PAY_NOTIONAL_AMOUNT_VALUE,
TTSWFL_REC.NOTIONAL_AMOUNT_CCY REC_NOTIONAL_AMOUNT_CCY,TTSWFL_REC.NOTIONAL_AMOUNT_VALUE REC_NOTIONAL_AMOUNT_VALUE
from (select * from FTABKBPD.TT_SWAP_CASH_FLOWS@FTFC where SETTLEMENT_ACTION='PAY' AND SIDE_SEQUENCE='1'  and PARENT_FBO_ID_VER='999999')TTSWFL_PAY 
left join (select distinct * from FTABKBPD.TT_SWAP_CASH_FLOWS@FTFC where SETTLEMENT_ACTION='REC'  AND SIDE_SEQUENCE='1'  and PARENT_FBO_ID_VER='999999')TTSWFL_REC on  TTSWFL_PAY.PARENT_FBO_ID_NUM = TTSWFL_REC.PARENT_FBO_ID_NUM)  TTSWFL ON TTSWFL.PARENT_FBO_ID_NUM = FIN_SWAP.DEAL_NUM 
WHERE DEAL_STATE!='DLTD' AND  SDENT.NAME='ABKKWT' 
group by TTSWFL.PAY_NOTIONAL_AMOUNT_CCY,TTSWFL.REC_NOTIONAL_AMOUNT_CCY;

SELECT 'SWAP' DEAL_TYPE,count(*) deal_count,
TTFXFL_PAY.NOTIONAL_AMOUNT_CCY ,
SUM(TTFXFL_REC.NOTIONAL_AMOUNT_VALUE) PAY_NOTIONAL_AMOUNT_VALUE,
TTFXFL_REC.NOTIONAL_AMOUNT_CCY ,
SUM(TTFXFL_PAY.NOTIONAL_AMOUNT_VALUE) REC_NOTIONAL_AMOUNT_VALUE
FROM FTABKBPD.TT_SWAP@FTFC FIN_SWAP
LEFT JOIN FTABKBPD.SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = FIN_SWAP.ENTITY_FBO_ID_NUM
LEFT JOIN FTABKBPD.TT_SWAP_CASH_FLOWS@FTFC TTFXFL_PAY ON TTFXFL_PAY.PARENT_FBO_ID_NUM = FIN_SWAP.DEAL_NUM AND TTFXFL_PAY.SETTLEMENT_ACTION='PAY' AND TTFXFL_PAY.SIDE_SEQUENCE='1' AND TTFXFL_PAY.PARENT_FBO_ID_VER='999999'
LEFT JOIN FTABKBPD.TT_SWAP_CASH_FLOWS@FTFC TTFXFL_REC ON TTFXFL_REC.PARENT_FBO_ID_NUM = FIN_SWAP.DEAL_NUM AND TTFXFL_REC.SETTLEMENT_ACTION='REC' AND TTFXFL_REC.SIDE_SEQUENCE='1' AND TTFXFL_REC.PARENT_FBO_ID_VER='999999'
WHERE TRIM(SDENT.NAME)='ABKKWT' AND (TTFXFL_PAY.PARENT_FBO_ID_NUM IS NOT NULL  OR TTFXFL_REC.PARENT_FBO_ID_NUM IS NOT NULL )
--AND FIN_SWAP.DEAL_NUM='100231'
GROUP BY TTFXFL_PAY.NOTIONAL_AMOUNT_CCY,TTFXFL_REC.NOTIONAL_AMOUNT_CCY 


----------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------

--FX SWAP

SELECT 'FX_SWAP' DEAL_TYPE,count(*) deal_count,sum(CASE WHEN A.CCYTERMS='M' THEN ABS(A.CCYAMT) ELSE ABS(A.CTRAMT) END) NEAR_LEG_total_amt,
SUM(CASE WHEN B.CCYTERMS='M' THEN ABS(B.CCYAMT*B.CCYRATE_8) ELSE ABS(B.CTRAMT*B.CCYRATE_8)  END) FAR_LEG_TOTAL_AMT
FROM  FXDH A
INNER JOIN CUST C ON TRIM(A.CUST)=TRIM(C.CNO)
INNER JOIN FXDH B ON A.SWAPDEAL=B.DEALNO AND B.FARNEARIND='F' AND TO_DATE(B.VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY')  AND A.BR=B.BR
WHERE  A.SWAPDEAL>0 AND TRIM(A.REVDATE) IS NULL and A.PRODCODE!='CCS' AND TRIM(C.CMNE)!='CCIRS' AND TRIM(A.PORT)!='EQFX' AND TRIM(B.PORT)!='EQFX'
AND A.'51';


SELECT 'FX_SWAP' DEAL_TYPE,count(*) deal_count
,sum(TTFXFL.CCY_ONE_AMOUNT_VALUE) NEAR_LEG_total_amt,SUM(TTFXFL.CCY_TWO_AMOUNT_VALUE) FAR_LEG_TOTAL_AMT
from FTABKBPD.TT_FXP_DEAL@FTFC fin_fx_swap
LEFT JOIN FTABKBPD.SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = fin_fx_swap.ENTITY_FBO_ID_NUM
LEFT JOIN FTABKBPD.TT_FXP_FLOW@FTFC TTFXFL ON TTFXFL.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM
WHERE   DEAL_TYPE='FXPLSW' AND fin_fx_swap.DEAL_STATE!='DLTD' AND SDENT.NAME='ABKKWT';


------------------

SELECT 'FX_SWAP' DEAL_TYPE,count(*) deal_count,
CASE WHEN A.CCYTERMS='M' THEN TRIM(A.CCY)||'/'||TRIM(A.CTRCCY) ELSE TRIM(A.CTRCCY)||'/'||TRIM(A.CCY) END  NEAR_LEG_CCY_PAIR,
sum(TO_CHAR(CASE WHEN A.CCYTERMS='M' THEN (A.CCYAMT) ELSE (A.CTRAMT) END,'9999999999999999990.99999999')) NEAR_LEG_CCY_ONE_AMOUNT,
sum(TO_CHAR(CASE WHEN A.CCYTERMS='M' THEN (A.CCYAMT*A.CCYRATE_8) ELSE (A.CTRAMT*A.CCYRATE_8) END,'9999999999999999990.99999999')) NEAR_LEG_CCY_TWO_AMOUNT,
CASE WHEN B.CCYTERMS !='M' THEN TRIM(B.CCY)||'/'||TRIM(B.CTRCCY) ELSE TRIM(B.CTRCCY)||'/'||TRIM(B.CCY) END  FAR_LEG_CCY_PAIR,
sum((TO_CHAR(CASE WHEN B.CCYTERMS='M' THEN B.CCYAMT ELSE B.CTRAMT END,'9999999999999999990.99999999'))) FAR_LEG_CCY_ONE_AMOUNT,
sum(TO_CHAR(CASE WHEN B.CCYTERMS='M' THEN (B.CCYAMT*B.CCYRATE_8) ELSE (B.CTRAMT*B.CCYRATE_8)  END ,'9999999999999999990.99999999'))FAR_LEG_CCY_TWO_AMOUNT
FROM  FXDH A
INNER JOIN CUST C ON TRIM(A.CUST)=TRIM(C.CNO)
INNER JOIN FXDH B ON A.SWAPDEAL=B.DEALNO AND B.FARNEARIND='F' AND TO_DATE(B.VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY')  AND A.BR=B.BR
WHERE  A.SWAPDEAL>0 AND TRIM(A.REVDATE) IS NULL and A.PRODCODE!='CCS' AND TRIM(C.CMNE)!='CCIRS' AND TRIM(A.PORT)!='EQFX' AND TRIM(B.PORT)!='EQFX'
AND A.'51'
group by CASE WHEN A.CCYTERMS='M' THEN TRIM(A.CCY)||'/'||TRIM(A.CTRCCY) ELSE TRIM(A.CTRCCY)||'/'||TRIM(A.CCY) END,
CASE WHEN B.CCYTERMS !='M' THEN TRIM(B.CCY)||'/'||TRIM(B.CTRCCY) ELSE TRIM(B.CTRCCY)||'/'||TRIM(B.CCY) END;



SELECT 'FX_SWAP' DEAL_TYPE,count(*) deal_count,
CASE WHEN A.CCYTERMS='M' THEN TRIM(A.CCY) ELSE TRIM(A.CTRCCY) END  NEAR_LEG_CCY1,
sum(TO_CHAR(CASE WHEN A.CCYTERMS='M' THEN (A.CCYAMT) ELSE (A.CTRAMT) END,'9999999999999999990.99999999')) NEAR_LEG_CCY_ONE_AMOUNT,
CASE WHEN A.CCYTERMS='M' THEN TRIM(A.CTRCCY) ELSE TRIM(A.CCY) END  NEAR_LEG_CCY2,
sum(TO_CHAR(CASE WHEN A.CCYTERMS='M' THEN (A.CCYAMT*A.CCYRATE_8) ELSE (A.CTRAMT*A.CCYRATE_8) END,'9999999999999999990.99999999')) NEAR_LEG_CCY_TWO_AMOUNT,
CASE WHEN B.CCYTERMS !='M' THEN TRIM(B.CCY) ELSE TRIM(B.CTRCCY) END  FAR_LEG_CCY1,
sum((TO_CHAR(CASE WHEN B.CCYTERMS='M' THEN B.CCYAMT ELSE B.CTRAMT END,'9999999999999999990.99999999'))) FAR_LEG_CCY_ONE_AMOUNT,
CASE WHEN B.CCYTERMS !='M' THEN TRIM(B.CTRCCY) ELSE TRIM(B.CCY) END  FAR_LEG_CCY2,
sum(TO_CHAR(CASE WHEN B.CCYTERMS='M' THEN (B.CCYAMT*B.CCYRATE_8) ELSE (B.CTRAMT*B.CCYRATE_8)  END ,'9999999999999999990.99999999'))FAR_LEG_CCY_TWO_AMOUNT
FROM  FXDH A
INNER JOIN CUST C ON TRIM(A.CUST)=TRIM(C.CNO)
INNER JOIN FXDH B ON A.SWAPDEAL=B.DEALNO AND B.FARNEARIND='F' AND TO_DATE(B.VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY')  AND A.BR=B.BR
WHERE  A.SWAPDEAL>0 AND TRIM(A.REVDATE) IS NULL and A.PRODCODE!='CCS' AND TRIM(C.CMNE)!='CCIRS' AND TRIM(A.PORT)!='EQFX' AND TRIM(B.PORT)!='EQFX'
AND A.'51'
group by CASE WHEN A.CCYTERMS='M' THEN TRIM(A.CCY) ELSE TRIM(A.CTRCCY) END,CASE WHEN A.CCYTERMS='M' THEN TRIM(A.CTRCCY) ELSE TRIM(A.CCY) END,
CASE WHEN B.CCYTERMS !='M' THEN TRIM(B.CCY) ELSE TRIM(B.CTRCCY) END,CASE WHEN B.CCYTERMS !='M' THEN TRIM(B.CTRCCY) ELSE TRIM(B.CCY) END



SELECT 'FX_SWAP' DEAL_TYPE,count(*) deal_count,
 TTFXFL_NEAR1.CCY_ONE_AMOUNT_CCY,SUM(TTFXFL_NEAR1.CCY_ONE_AMOUNT_VALUE),
TTFXFL_NEAR2.PL_CCY,SUM(TTFXFL_FAR1.CCY_two_AMOUNT_VALUE),
TTFXFL_FAR1.PL_CCY,SUM(TTFXFL_FAR1.CCY_ONE_AMOUNT_VALUE),
TTFXFL_FAR2.CCY_ONE_AMOUNT_CCY, SUM(TTFXFL_NEAR1.CCY_two_AMOUNT_VALUE)
FROM FTABKBPD.TT_FXP_DEAL@FTFC fin_fx_swap
LEFT JOIN FTABKBPD.SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = fin_fx_swap.ENTITY_FBO_ID_NUM
LEFT JOIN FTABKBPD.TT_FXP_FLOW@FTFC TTFXFL_NEAR1 ON TTFXFL_NEAR1.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXFL_NEAR1.PARENT_LEG_IDENTIFIER='NELG' AND TTFXFL_NEAR1.FXP_FLOW_REFERENCE='1'
LEFT JOIN FTABKBPD.TT_FXP_FLOW@FTFC TTFXFL_NEAR2 ON TTFXFL_NEAR2.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXFL_NEAR2.PARENT_LEG_IDENTIFIER='NELG' AND TTFXFL_NEAR2.FXP_FLOW_REFERENCE='2'
LEFT JOIN FTABKBPD.TT_FXP_FLOW@FTFC TTFXFL_FAR1 ON TTFXFL_FAR1.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXFL_FAR1.PARENT_LEG_IDENTIFIER='FALG' AND TTFXFL_FAR1.FXP_FLOW_REFERENCE='1'
LEFT JOIN FTABKBPD.TT_FXP_FLOW@FTFC TTFXFL_FAR2 ON TTFXFL_FAR2.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXFL_FAR2.PARENT_LEG_IDENTIFIER='FALG' AND TTFXFL_FAR2.FXP_FLOW_REFERENCE='2'
WHERE TRIM(SDENT.NAME)='ABKKWT' AND (TTFXFL_NEAR1.PARENT_FBO_ID_NUM IS NOT NULL  OR TTFXFL_NEAR2.PARENT_FBO_ID_NUM IS NOT NULL  OR TTFXFL_FAR1.PARENT_FBO_ID_NUM IS NOT NULL  OR TTFXFL_FAR2.PARENT_FBO_ID_NUM IS NOT NULL)
GROUP BY TTFXFL_NEAR1.CCY_ONE_AMOUNT_CCY,TTFXFL_NEAR2.PL_CCY,TTFXFL_FAR1.PL_CCY,TTFXFL_FAR2.CCY_ONE_AMOUNT_CCY



-----------
----------

SELECT 'FX_SWAP' DEAL_TYPE,count(*) deal_count,
CASE WHEN A.CCYTERMS='M' THEN TRIM(A.CCY) ELSE TRIM(A.CTRCCY) END  NEAR_LEG_CCY1,
sum(TO_CHAR(CASE WHEN A.CCYTERMS='M' THEN (A.CCYAMT) ELSE (A.CTRAMT) END,'9999999999999999990.99999999')) NEAR_LEG_CCY_ONE_AMOUNT,
CASE WHEN B.CCYTERMS !='M' THEN TRIM(B.CCY) ELSE TRIM(B.CTRCCY) END  FAR_LEG_CCY1,
sum((TO_CHAR(CASE WHEN B.CCYTERMS='M' THEN B.CCYAMT ELSE B.CTRAMT END,'9999999999999999990.99999999'))) FAR_LEG_CCY_ONE_AMOUNT
FROM  FXDH A
INNER JOIN CUST C ON TRIM(A.CUST)=TRIM(C.CNO)
INNER JOIN FXDH B ON A.SWAPDEAL=B.DEALNO AND B.FARNEARIND='F' AND TO_DATE(B.VDATE,'YYYY-MM-DD')>TO_DATE(get_param('EOD_DATE'),'DD-MM-YYYY')  AND A.BR=B.BR
WHERE  A.SWAPDEAL>0 AND TRIM(A.REVDATE) IS NULL and A.PRODCODE!='CCS' AND TRIM(C.CMNE)!='CCIRS' AND TRIM(A.PORT)!='EQFX' AND TRIM(B.PORT)!='EQFX'
AND A.BR='01'
group by CASE WHEN A.CCYTERMS='M' THEN TRIM(A.CCY) ELSE TRIM(A.CTRCCY) END,CASE WHEN A.CCYTERMS='M' THEN TRIM(A.CTRCCY) ELSE TRIM(A.CCY) END,
CASE WHEN B.CCYTERMS !='M' THEN TRIM(B.CCY) ELSE TRIM(B.CTRCCY) END,CASE WHEN B.CCYTERMS !='M' THEN TRIM(B.CTRCCY) ELSE TRIM(B.CCY) END


SELECT 'FX_SWAP' DEAL_TYPE1, count(*) deal_count,
TTFXFL_NEAR1.CCY_ONE_AMOUNT_CCY FINACLE_NEAR_LEG_CCY1,
SUM(TTFXFL_NEAR1.CCY_ONE_AMOUNT_VALUE) FIN_NEAR_LEG_CCY_ONE_AMOUNT ,
TTFXFL_FAR1.PL_CCY FINACLE_FAR_LEG_CCY1,
SUM(TTFXFL_FAR1.CCY_ONE_AMOUNT_VALUE) FINACLE_FAR_LEG_CCY_ONE_AMOUNT--,
FROM FTABKBPD.TT_FXP_DEAL@FTFC fin_fx_swap
LEFT JOIN FTABKBPD.SD_ENTITY@FTFC SDENT ON SDENT.FBO_ID_NUM = fin_fx_swap.ENTITY_FBO_ID_NUM
LEFT JOIN FTABKBPD.TT_FXP_FLOW@FTFC TTFXFL_NEAR1 ON TTFXFL_NEAR1.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXFL_NEAR1.PARENT_LEG_IDENTIFIER='NELG' AND TTFXFL_NEAR1.FXP_FLOW_REFERENCE='1' 
LEFT JOIN FTABKBPD.TT_FXP_FLOW@FTFC TTFXFL_FAR1 ON TTFXFL_FAR1.PARENT_FBO_ID_NUM = fin_fx_swap.DEAL_NUM AND TTFXFL_FAR1.PARENT_LEG_IDENTIFIER='FALG' AND TTFXFL_FAR1.FXP_FLOW_REFERENCE='1' 
WHERE TRIM(SDENT.NAME)='ABKKWT' AND (TTFXFL_NEAR1.PARENT_FBO_ID_NUM IS NOT NULL  OR TTFXFL_FAR1.PARENT_FBO_ID_NUM IS NOT NULL  )
AND  DEAL_TYPE='FXPLSW' AND fin_fx_swap.DEAL_STATE!='DLTD' 
GROUP BY TTFXFL_NEAR1.CCY_ONE_AMOUNT_CCY,TTFXFL_NEAR1.PL_CCY,TTFXFL_FAR1.PL_CCY




----------------------------------------------------------------------


select 'COM_LOAN_DEAL' PRODUCT, count(*) OPICS_DEAL_COUNT,count(*) FINACLE_DEAL_COUNT  from COM_LOAN_O_TABLE
UNION 
select 'FX_OUTRIGHT_DEAL',count(*),count(*) from FX_OUTRIGHT_DEALS_O_TABLE
UNION 
select 'REPO_DEAL',count(*),count(*) from REPO_O_TABLE
UNION 
select 'FX_SPOT_DEAL',count(*),count(*) from FX_SPOT_DEALS_O_TABLE
UNION 
select 'FX_SWAP_DEAL',count(*),count(*) from FX_SWAP_O_TABLE
UNION 
select 'SWAP_DEAL',count(*),count(*) from SWAP_O_TABLE
UNION 
select 'SPOT_POSITION_DEAL',count(*),count(*) from SPOT_POSITION_DEALS_O_TABLE
UNION 
select 'EQUITY_DEAL',count(*),count(*) from EQUITY_MF_O_TABLE
UNION 
select 'SECURITY DEAL',count(*),count(*) from SEC_BUY_SELL_O_TABLE
UNION 
select 'INTERNAL DEAL',count(*),count(*) from INTERNAL_DEALS_O_TABLE


select PRODUCT_TYPE,SUBTYPE,INDICATOR,CCY,sum(FCY_AMOUNT) FCY_AMOUNT,sum(KWD_AMOUNT) KWD_AMOUNT from TREASURY_OPEN_DEALS group by PRODUCT_TYPE,SUBTYPE,INDICATOR,CCY;

select INSTRUMENT_CLASS_DATA_NAME,SUBTYPE,BUY_OR_SELL,CCY,sum(FCY_AMOUNT) FCY_AMOUNT ,sum(KWD_AMOUNT) KWD_AMOUNT from TREASURY_OPEN_INV_DEASL group by INSTRUMENT_CLASS_DATA_NAME,SUBTYPE,BUY_OR_SELL,CCY;


select PRODUCT_TYPE,CCY,SUM(FCY_AMOUNT) FCY_AMOUNT ,SUM(KWD_AMOUNT) KWD_AMOUNT  from TREASURY_OPEN_DEALS GROUP BY PRODUCT_TYPE,CCY
UNION ALL
select case when DEAL_IDENTIFIER like '6%' THEN 'SECURITY' ELSE 'EQUITY' END TYPE,TO_CHAR(CCY),SUM(FCY_AMOUNT) FCY_AMOUNT ,SUM(KWD_AMOUNT) KWD_AMOUNT from TREASURY_OPEN_INV_DEASL
GROUP BY case when DEAL_IDENTIFIER like '6%' THEN 'SECURITY' ELSE 'EQUITY' END,CCY 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
yield_curve_report.sql 
========================================================================================================================================================================================== 
****************************************************************************************************************************************************************************************** 
yield_curve_report.sql 
select DISTINCT CONTRIBRATE OPICS_CONTRIBRATE,CCY_CALENDAR_LIST FINACLE_CCY_CALENDAR_LIST,
YC.CCY OPICS_CCY,CURV.CCY FINACLE_CCY, CURV.CCY_CALENDAR_LIST FINACLE_CCY_CALENDAR_LIST from  YCRS YC
LEFT join MRS_CURVES@FTMIG CURV on TRIM(CCY_CALENDAR_LIST) = SUBSTR(TRIM(CONTRIBRATE),1,3) AND TRIM(ID) ='LIBOR'
where BR='01'